# Требования к Markdown файлам

## Обзор

Система автоматически сканирует папку `content/` и генерирует статический сайт из найденных `.md` файлов. Основные типы контента:

- `intro/` — вводная часть курса;
- `course/` — платные разделы курса (1–10);
- `appendix/` — приложения к курсу;
- `recommendations/` — открытые статьи-рекомендации;
- `legal/` — юридические тексты (оферта, политика, реквизиты, cookies).

Markdown-файлы используются **только на этапе сборки**. На боевом сайте работают уже сгенерированные HTML/JS/JSON-файлы — никакого динамического парсинга Markdown в рантайме нет. Для автора это означает: чтобы изменить контент, достаточно отредактировать `.md` файл и запустить сборку.


## Структура проекта

```text
toosmart/
├── content/
│   ├── intro/                      ← Вводная статья (раздел 0)
│   │   └── 00_intro.md
│   ├── course/                     ← Основные разделы платного курса
│   │   ├── 01_basics.md
│   │   ├── 02_tools.md
│   │   ├── 03_chemistry.md
│   │   └── ...
│   ├── appendix/                   ← Приложения (A, B, C…)
│   │   ├── A_prilozhenie_osnovnoe.md
│   │   ├── B_prilozhenie_kuxnya.md
│   │   └── ...
│   ├── recommendations/            ← Открытые статьи/рекомендации
│   │   ├── eco-cleaning.md
│   │   ├── dangerous-mixes.md
│   │   └── ...
│   └── legal/                      ← Юридические тексты для модалок/страницы
│       ├── legal_offer.md
│       ├── legal_privacy.md
│       ├── legal_requisites.md
│       └── legal_cookies.md
├── src/                            ← UI шаблоны (компоненты, стили)
├── scripts/                        ← Скрипты сборки
│   └── build.js
└── dist/                           ← Результат сборки (генерируется автоматически)
    ├── free/                       ← Бесплатная версия с paywall
    └── premium/                    ← Платная версия с полным контентом
```

Авто-генерация меню и страниц устроена так, что при корректной структуре Markdown-файлов **не требуется ручная регистрация разделов** — достаточно положить файл в нужную папку и запустить сборку.


## Правила именования файлов

### Общая идея

Имя файла однозначно задаёт:

- порядок раздела (для курса и приложений),
- «человеческий» ID для URL,
- тип контента (по папке).

Ниже — правила для ключевых типов.

### 1. Разделы курса (`content/course/`)

Формат имени: `NN[-_.]описание.md`

Где:

- **`NN`** — двузначный номер в начале файла, определяет **порядок в меню** (обязательно);
- **`описание`** — человекочитаемый хвост, используется для генерации ID страницы и URL;
- разделитель может быть `-`, `_` или `.` — не принципиально.

Примеры правильных имён:

| Имя файла                 | Порядок | ID страницы        | Результат              |
|---------------------------|---------|--------------------|------------------------|
| `01.md`                   | 1       | `01`               | `/course/01.html`      |
| `02-basics.md`            | 2       | `basics`           | `/course/basics.html`  |
| `03_chemistry.md`         | 3       | `chemistry`        | `/course/chemistry.html` |
| `10.advanced-cleaning.md` | 10      | `advanced-cleaning`| `/course/advanced-cleaning.html` |

Нежелательные имена:

- `intro.md` — нет номера в начале;
- `section-01.md` — номер не в начале;
- `1.md` — однозначное число (лучше `01.md`).

### 2. Приложения (`content/appendix/`)

Формат имени: `X_описание.md`

Где:

- **`X`** — заглавная латинская буква (`A`, `B`, `C`, …), определяет **порядок приложения** в конце платного курса;
- **`описание`** — произвольное описание.

Примеры:

| Имя файла                         | Порядок в меню premium    |
|-----------------------------------|---------------------------|
| `A_prilozhenie_osnovnoe.md`      | Приложение A (первое)     |
| `B_prilozhenie_kuxnya.md`        | Приложение B (второе)     |
| `C_prilozhenie_dop_tablitsy.md`  | Приложение C (третье)     |

В бесплатной версии приложения не рендерятся, имена нужны только для платной структуры курса.

### 3. Вводная (`content/intro/`)

Рекомендуемый формат: `00_intro.md` (один файл).

- Номер `00` логически ставит вводную перед разделами 1–10.
- При генерации может маппиться на `/` или `/intro.html` (в зависимости от конфигурации роутов).

### 4. Рекомендации (`content/recommendations/`)

Для рекомендаций жёсткой нумерации нет — порядок в карусели задаётся полем `order` в YAML-шапке, а не номером в имени файла.

Рекомендуемый формат:

- `slug.md` — короткий латинский идентификатор, например:
  - `eco-cleaning.md`
  - `dangerous-mixes.md`
  - `sofa-upholstery-care.md`

Этот `slug` используется в URL: `/recommendations/eco-cleaning.html` и т.п.

### 5. Юридические тексты (`content/legal/`)

Формат свободный, но рекомендуется использовать понятные префиксы:

- `legal_offer.md`
- `legal_privacy.md`
- `legal_requisites.md`
- `legal_cookies.md`

Эти файлы не попадают в структуру курса, но используются при генерации модалок и/или страницы `/legal`.


## Структура MD файла

### Общие обязательные элементы для разделов курса и приложений

Для файлов в `content/intro/`, `content/course/` и `content/appendix/` действуют общие правила:

1. **Один заголовок H1** (`#`) — название раздела.  
   Используется в меню и заголовке страницы.

2. **Подзаголовки H2** (`##`) — разделы внутри главы.  
   Используются для навигации по странице (якоря, подменю).

3. **Заголовки H3+** (`###`, `####` и т.д.) — только для структурирования внутри текста, в меню не попадают.

4. **Логическое введение** — первые 2–3 смысловых абзаца и/или блок с `H2` «Введение», которые будут видны целиком в бесплатной версии и использоваться поисковыми системами.

Рекомендуемый шаблон для разделов курса:

```markdown
# Название раздела курса

Краткое введение в тему раздела в 1–2 абзацах. Этот блок обязательно должен чётко описывать, о чём раздел, с какими типичными проблемами он помогает и что читатель узнает. Именно эти абзацы (и/или блок «Введение») будут полностью видны в бесплатной версии и индексироваться поисковиками.

## 3.0 Введение: контекст и структура

Здесь можно оформить более формальное введение в формате H2: повторить ключевую мысль, дать структуру, перечислить основные подтемы.

## 3.1 Первый большой блок

Основной текст раздела: теоретические объяснения, примеры, таблицы, списки и т.д.

### Детали (H3 — только для верстки)

H3/H4 используют только для улучшения читаемости внутри страницы, в меню не попадают.

## 3.2 Второй большой блок

Ещё один крупный логический блок.
```

Ключевая идея: **все важные формулировки и ключевые слова по теме должны появиться во вводной части до первого большого H2-блока** — тогда бесплатный фрагмент будет самодостаточным и полезным для читателя и SEO.

### Структура MD файлов рекомендаций

Файлы в `content/recommendations/` имеют структуру:

1. **Опциональная YAML-шапка** (front matter):

```yaml
---
title: "Короткое название для карточки"
teaser: "Краткое описание для карточки (1–3 предложения)."
image: "/static/reco/eco-myths.png"
order: 10
---
```

2. **Один заголовок H1** (`#`) — полное название статьи.
3. Остальной текст — произвольный Markdown (H2/H3, списки, таблицы и т.д.).

Если `title` или `teaser` в YAML не заданы:

- `title` берётся из H1;
- `teaser` автоматически генерируется из первых ~100 символов основного текста (без заголовков).

### Структура MD файлов legal

Для `content/legal/*.md` достаточно:

- одного H1 (например «Публичная оферта»),
- далее — текст документа в Markdown.

Эти файлы не затрагиваются paywall-логикой и отображаются либо в модалках, либо на странице `/legal`.


## Первый подраздел

Это будет создано как отдельная секция с якорем `#первый-подраздел` и появится в подменю.

### Детали (H3 — только для верстки)

Этот заголовок H3 не попадёт в меню, но будет отображаться внутри контента.

#### Еще более детальный уровень (H4)

H4, H5, H6 — используются только для структурирования текста внутри раздела.

## Второй подраздел

Еще одна секция с автоматически сгенерированным ID `#второй-подраздел`.

**Списки:**
- Пункт 1
- Пункт 2
- Пункт 3

**Нумерованные списки:**
1. Шаг первый
2. Шаг второй
3. Шаг третий

**Цитаты:**
> Важная информация в блоке цитаты

**Код:**
```javascript
function example() {
  console.log('Пример кода');
}
```

**Таблицы:**
| Столбец 1 | Столбец 2 | Столбец 3 |
|-----------|-----------|-----------|
| Данные 1  | Данные 2  | Данные 3  |

## Третий подраздел

Изображения автоматически ищутся в `content/images/`:

![Описание изображения](image.jpg)
![Описание](./folder/image.png "Подпись к изображению")

```

---

## Как работает автоматическая генерация

### 1. Сканирование файлов

Скрипт сборки проходит по папке `content/` и обрабатывает:

- `intro/` — один файл вводной;
- `course/` — все файлы разделов курса с числовыми префиксами;
- `appendix/` — все файлы приложений с буквенными префиксами;
- `recommendations/` — все статьи-рекомендации;
- `legal/` — юридические тексты.

Пример для курса:

```bash
content/course/
├── 01-intro.md          ← Порядок: 1, ID: intro, Title: из H1
├── 02-basics.md         ← Порядок: 2, ID: basics, Title: из H1
└── 03-chemistry.md      ← Порядок: 3, ID: chemistry, Title: из H1
```

### 2. Извлечение данных

Для каждого файла курса/приложения система автоматически:

- извлекает номер или букву из имени файла → **порядок в меню**;
- извлекает ID из имени файла → **URL страницы**;
- извлекает H1 → **название раздела в меню**;
- извлекает H2 → **подразделы в подменю (якоря внутри страницы)**.

Для рекомендаций дополнительно:

- парсит YAML-шапку и извлекает `title`, `teaser`, `image`, `order` (если есть);
- формирует JSON для карусели рекомендаций.

### 3. Генерация меню и структуры курса

Меню структуры курса строится на основе:

- вводной (`intro`) — всегда первой;
- разделов `course` — в порядке числовых префиксов;
- приложений `appendix` — в конце, по алфавиту буквенного префикса.

H2 внутри каждого раздела используются для создания якорей и подменю на странице.

### 4. Генерация навигации "Далее"

Кнопка «Далее» автоматически создаётся между разделами в порядке:

- вводная → раздел 1 → раздел 2 → … → раздел 10 → Приложение A → Приложение B → … (в платной версии);
- в бесплатной версии навигация по платным разделам ведёт на их free-превью (введение + blur + paywall).

### 5. Генерация free и premium версий

Детали поведения free/premium описаны ниже в отдельной секции. Важно, что:

- Markdown всегда один и тот же;
- логика «что показывать полностью», «что под blur» и «что не рендерить в free вовсе» регулируется сборкой, а не автором при написании текста.


## Free vs Premium версии

### Free версия (с paywall)

Free-версия (`dist/free/`) предназначена для ознакомления и SEO. Для разных типов контента действует разная логика:

- **Вводная (`intro`)** — показывается полностью.
- **Разделы курса (`course`)**:
  1. Из Markdown-файла извлекается **логическое введение**:
     - либо H2 со словом «Введение» + абзацы до следующего H2/`---`;
     - либо первые 2–3 абзаца после H1 (и возможного `---`) до первого H2.
  2. Этот блок рендерится целиком и индексируется поисковыми системами.
  3. После введения формируется **ограниченный blur-фрагмент**: несколько следующих абзацев суммарной высотой примерно 300 пикселей на десктопе.
  4. Blur-фрагмент рендерится в специальном контейнере с градиентом и эффектом размытия:
     - текст внутри оборачивается в `<!--noindex-->…<!--/noindex-->` для Яндекса;
     - контейнер помечается атрибутом `data-nosnippet` для Google.
  5. Над blur-фрагментом выводится подпись «Осталось N минут чтения», где N — рассчитанное время чтения полного раздела.
  6. Под blur-фрагментом размещается кнопка «Получить полный доступ», открывающая модальное окно оплаты.

  Полный текст раздела (всё, что идёт после blur-фрагмента) в free-HTML **не присутствует вообще** — он есть только в платной версии.

- **Приложения (`appendix`)** — в free-версии не рендерятся (нет страниц и пунктов меню).
- **Рекомендации (`recommendations`)** — отображаются полностью без paywall, используются для SEO и карусели.
- **Юридические тексты (`legal`)** — отображаются при открытии модалок футера и/или на странице `/legal`, логика paywall к ним не применяется.

### Premium версия (полный контент)

Premium-версия (`dist/premium/`) показывает полный курс:

- вводная (`intro`) — полностью;
- все разделы `course` — полный текст из Markdown без blur и ограничений;
- все приложения `appendix` — как полноценные разделы после основных глав;
- рекомендации — полностью;
- те же модалки legal, что и в free.

Защита платного контента реализуется на уровне PHP/авторизации и настроек индексации, а не на уровне Markdown.


## Запуск сборки

```bash
# Полная пересборка free + premium, обновление курса и рекомендаций
npm run build:all

# Только free-версия
npm run build:free

# Только premium-версия
npm run build:premium

# Быстрая пересборка только рекомендаций и JSON для карусели
npm run build:reco
```

Конкретные названия команд могут слегка отличаться (смотрите `package.json` и README проекта), но функционально должны быть доступны:

- команда для полной пересборки обоих сайтов;
- команда для сборки только free;
- команда для сборки только premium;
- команда для пересборки только рекомендаций.


## Пример полного MD файла

**Файл:** `content/course/05-kitchen-chemistry.md`

```markdown
# Химия кухонной уборки

Кухня — это место, где химия проявляется во всей красе. Жир, накипь, органические загрязнения требуют разных подходов и понимания химических процессов. Эти первые абзацы войдут в логическое введение и будут видны полностью в бесплатной версии.

## Удаление жира

Жир — один из самых стойких загрязнений. Почему обычная вода не справляется?

### Молекулярная структура жиров

Молекулы жира гидрофобны — они отталкивают воду.

### ПАВ в действии

Поверхностно-активные вещества имеют гидрофильную "голову" и гидрофобный "хвост".

## Борьба с накипью

Накипь — это карбонат кальция (CaCO₃), который образуется при нагревании жёсткой воды.

### Кислоты против минералов

Карбонат кальция легко растворяется в кислотах:

```
CaCO₃ + 2H⁺ → Ca²⁺ + H₂O + CO₂↑
```

**Практические советы:**
- Уксус 9% — доступно и эффективно
- Лимонная кислота — без запаха
- Специальные средства — для сложных случаев

## Уход за нержавеющей сталью

Нержавейка не ржавеет благодаря пассивирующей плёнке оксида хрома.

> Важно: хлориды (соль) — главный враг нержавейки!

### Как вернуть блеск

1. Жидкое средство для посуды + мягкая губка
2. Вытереть насухо (против разводов)
3. Для глубокой очистки: паста из соды

**Изображение:**
![Структура нержавеющей стали](stainless-steel-structure.jpg "Микроскопическая структура")
```

---

## Поддерживаемые Markdown элементы

### Текстовое форматирование:
- **Жирный** → `**текст**`
- *Курсив* → `*текст*`
- ~~Зачеркнутый~~ → `~~текст~~`
- `Код` → `` `код` ``

### Ссылки:
```markdown
[Текст ссылки](https://example.com)
[Ссылка с подсказкой](https://example.com "Всплывающая подсказка")
```

### Изображения:
```markdown
![Alt текст](image.jpg)
![Alt текст](image.jpg "Подпись к изображению")
```

### Списки:
```markdown
- Маркированный список
- Пункт 2

1. Нумерованный список
2. Пункт 2
```

### Цитаты:
```markdown
> Цитата или важное замечание
```

### Код:
````markdown
```javascript
function example() {
  return true;
}
```
````

### Таблицы:
```markdown
| Заголовок 1 | Заголовок 2 |
|-------------|-------------|
| Ячейка 1    | Ячейка 2    |
```

### Горизонтальная линия:
```markdown
---
```

---

## FAQ

### Можно ли использовать русские буквы в именах файлов?

✅ Можно, но **не рекомендуется**. Используйте латиницу для ID:
- `05-химия.md` → ID будет `химия` (может вызвать проблемы)
- `05-chemistry.md` → ID будет `chemistry` (безопасно)

### Что если забыть H1 заголовок?

Система автоматически создаст название `Раздел N`, где N — номер из имени файла.

### Можно ли пропустить номера?

Да! Можно использовать `01.md`, `05.md`, `10.md` — система отсортирует по номерам.

### Можно ли использовать вложенные папки?

Нет, все MD файлы должны лежать напрямую в `content/course/`. Вложенные папки игнорируются.

### Можно ли изменить порядок разделов?

Да! Просто переименуйте файлы, изменив номера:
```bash
mv 02-basics.md 05-basics.md
mv 03-chemistry.md 02-chemistry.md
npm run build
```

### Как добавить новый раздел в середину?

1. Создайте файл с нужным номером: `03-new-section.md`
2. Переименуйте последующие разделы (увеличьте номера)
3. Запустите сборку: `npm run build`

Или используйте дробные номера: `02.md`, `02.5-extra.md`, `03.md`

---

## Чеклист перед добавлением нового раздела

- [ ] Имя файла начинается с цифры: `NN-name.md`
- [ ] Есть один H1 заголовок (`#`) с названием раздела
- [ ] Есть хотя бы один H2 заголовок (`##`) для подменю
- [ ] Вступительный абзац написан (для free версии)
- [ ] Изображения (если есть) лежат в `content/images/`
- [ ] Запущена сборка: `npm run build`
- [ ] Проверен результат: `npm run preview:free` и `npm run preview:premium`

---

## Примеры готовых файлов

Посмотрите существующие файлы в `content/course/`:
- `01-intro.md` — пример с простой структурой
- `02-basics.md` — пример с несколькими H2 подразделами
- `03-advanced.md` — пример с H3 заголовками для верстки

---

**Вопросы?** Проверьте вывод консоли после `npm run build` — система покажет, какие файлы найдены и как они обработаны.
