# Оценка предложенных решений по виджету прогресса

## Проверка выводов про выравнивание кружка

Исходное предложение: проблема в том, что `updateProgressWidgetFloatingAnchors()` немедленно выходит, если `dock-handle` не участвует в раскладке (`offsetParent === null`), из‑за чего CSS‑переменные остаются дефолтными и кружок залипает слева.

**Оценка.** В функции действительно есть ранний выход при `!handle || handle.offsetParent === null` перед вычислением `--pw-float-left` и `--pw-float-bottom`. Это значит, что если кнопка «Структура курса» скрыта или не в потоке в момент вызова, позиционирование виджета не обновляется и остаётся в состоянии по умолчанию. Аргумент корректен, но нужно помнить, что базовые стили задают `left` через `--pw-float-left`; без обновления переменной кружок оказывается на исходной позиции. Альтернативой может быть fallback по вычисленным координатам меню или по сохранённым значениям: не выходить при `offsetParent === null`, а использовать последнее известное смещение или запасной селектор (`.menu-handle`).

## Проверка вывода про исчезновение кнопки «Далее»

Исходное предложение: кнопка пропадает, потому что виджет лениво инициализируется через `data-lazy="progress-widget"`, а его cleanup удаляет `#pw-root` при выгрузке панели.

**Оценка.** `initProgressWidget()` регистрирует очистку через `registerLifecycleDisposer`, которая удаляет корневой элемент и слоты. Обёртка `activateProgressWidgetFeature()` возвращает disposer, который вызывает этот cleanup при деактивации ленивой фичи. Если наблюдатель решает, что панель вышла из зоны наблюдения (например, после длинного скролла), элемент действительно удаляется. Это объясняет пропажу кнопки и выглядит правдоподобным. Альтернативой может быть переход на «одноразовую» инициализацию без удаления DOM (только отключение слушателей) либо вынесение виджета за пределы ленивого контейнера, чтобы он не зависел от `IntersectionObserver`.

## Вывод

Обе гипотезы соответствуют текущей логике в `src/script.js`. Возможные улучшения: добавлять резервные координаты для позиционирования виджета и менять стратегию ленивой загрузки, чтобы виджет не удалялся после первичной инициализации.
