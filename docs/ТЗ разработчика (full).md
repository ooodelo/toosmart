# Техническое задание для разработчика (full)

## Контекст проекта

Платформа онлайн-курса с freemium-моделью. Markdown файлы автоматически превращаются в две версии сайта через build скрипт. Бесплатная версия - полноценный сайт с ограниченным доступом к контенту, премиум версия - полный доступ с авторизацией.

## Архитектура проекта - две независимые версии сайта

Проект генерирует два полностью разных сайта из одних и тех же исходных markdown файлов. Это не одна версия с ограничениями доступа, а именно две отдельные сборки с разным контентом и разной функциональностью.

**Бесплатная версия** (`dist/free/`) - это публичный сайт для SEO и привлечения клиентов. Пользователь видит структуру всего курса в меню, может переходить по любым разделам, но каждый раздел курса показывает только минимальное preview контента. Цель этой версии - дать понимание о чем курс и мотивировать к покупке. Эта версия размещается на основном домене toosmart.ru и доступна всем без авторизации.

**Платная версия** (`dist/premium/`) - это закрытый полноценный курс с полным контентом всех разделов. Доступ к этой версии получают только те кто купил курс и авторизовался. Эта версия размещается в защищенной папке на сервере (например toosmart.ru/premium/) и защищена PHP скриптами которые проверяют авторизацию перед показом любой страницы.

## Структура исходного контента - три типа файлов

Исходный контент курса и связанных материалов хранится в дереве `content/` в виде Markdown-файлов. Markdown используется **только** на этапе сборки: на боевом сайте работают уже сгенерированные статические HTML-страницы и JSON-структуры, никакого on-the-fly парсинга Markdown в браузере или на сервере нет.

Базовая структура:

```text
content/
├── intro/
│   └── 00_intro.md              # Вводная статья (раздел 0)
├── course/
│   ├── 01_basics.md             # Разделы 1–10 платного курса
│   ├── 02_tools.md
│   ├── 03_chemistry.md
│   └── …                        # остальные разделы
├── appendix/
│   ├── A_prilozhenie_osnovnoe.md   # Приложение A
│   ├── B_prilozhenie_kuxnya.md     # Приложение B
│   └── …                            # Приложения C, D и т.д.
├── recommendations/
│   ├── eco-cleaning.md          # Открытые SEO-статьи/рекомендации
│   ├── dangerous-mixes.md
│   └── …
└── legal/
    ├── legal_offer.md           # Публичная оферта
    ├── legal_privacy.md         # Политика конфиденциальности/ПДн
    ├── legal_requisites.md      # Реквизиты
    └── legal_cookies.md         # Политика по cookies (может объединяться)
```

Каждый тип контента обрабатывается по-своему при генерации:

- `intro/` — вводная статья, в free и premium отображается полностью.
- `course/` — платные разделы курса:
  - в бесплатной версии показываются только логическое введение и ограниченный blur-фрагмент с paywall;
  - в платной версии разделы отображаются целиком.
- `appendix/` — приложения:
  - в бесплатной версии **не рендерятся** (нет страниц и пунктов меню);
  - в платной версии отображаются как отдельные разделы курса, всегда после основных разделов 1–10.
- `recommendations/` — рекомендации/SEO-статьи:
  - в обеих версиях отображаются полностью;
  - используются для формирования карусели рекомендаций и отдельных страниц.
- `legal/` — юридические тексты:
  - встраиваются в модальные окна футера и, при необходимости, в отдельную страницу `/legal`.

Имена файлов в `course/` определяют порядок разделов (по числовому префиксу `01_…`, `02_…` и т.д.). Имена файлов в `appendix/` начинаются с буквы (`A_…`, `B_…`, `C_…` и т.д.) — по этой букве приложения сортируются и попадают в конец меню платной версии.

### Соответствие Markdown-файлов и URL

Для удобства разработки и проверки, соответствие файлов в `content/` и целевых адресов страниц задаётся так:

| Тип             | Папка / пример файла                 | Free URL                               | Premium URL                                   |
|-----------------|--------------------------------------|----------------------------------------|-----------------------------------------------|
| Вводная         | `intro/00_intro.md`                  | `/` или `/intro.html`                  | `/premium/` или `/premium/intro.html`         |
| Раздел курса    | `course/01_basics.md`                | `/course/basics.html`                  | `/premium/course/basics.html`                 |
| Раздел курса    | `course/03_chemistry.md`             | `/course/chemistry.html`               | `/premium/course/chemistry.html`              |
| Приложение      | `appendix/A_prilozhenie_osnovnoe.md` | — (нет в free)                         | `/premium/course/appendix-a.html` (пример)    |
| Рекомендация    | `recommendations/eco-cleaning.md`    | `/recommendations/eco-cleaning.html`   | `/premium/recommendations/eco-cleaning.html`* |
| Юридический текст | `legal/legal_offer.md`             | `/legal#offer` или модальное окно      | `/premium/legal#offer` или модальное окно     |

\* В зависимости от текущей архитектуры premium-сайта, URL для рекомендаций могут быть либо идентичными free (`/recommendations/...` с авторизационным фильтром), либо располагаться под `/premium/`. Важно, чтобы схема была единообразной и явно зафиксированной в конфигурации роутов.

## Логика генерации бесплатной версии

Бесплатная версия (`dist/free/`) предназначена для открытого ознакомления и SEO. Она использует один и тот же набор Markdown-файлов, что и платная, но отображает только часть контента платных разделов.

Для каждой страницы действуют следующие правила:

1. **Вводная статья (intro).**  
   Отображается полностью, без каких-либо ограничений и paywall. Весь текст из Markdown попадает в HTML и индексируется поисковыми системами.

2. **Платные разделы курса (course).**  
   Для каждого раздела выполняются шаги:

   - из Markdown извлекается логическое введение по алгоритму, описанному в блоке «Платные разделы курса (course)» (H2 «Введение» или первые абзацы после H1);
   - этот блок выводится в HTML как обычный читаемый текст и является основным SEO-контентом страницы;
   - после введения формируется ограниченный blur-фрагмент (несколько абзацев, суммарно ≈300 px высоты), который помещается в контейнер с градиентом и CSS blur;
   - над blur-фрагментом отображается подпись «Осталось N минут чтения», где N — рассчитанное время чтения полного раздела;
   - под blur-фрагментом отображается кнопка «Получить полный доступ», открывающая модальное окно оплаты.

   Полный текст раздела (всё, что идёт после blur-фрагмента) в бесплатной сборке **не рендерится**: его нет в HTML-коде free-страницы.

   Для blur-фрагмента дополнительно:

   - содержимое оборачивается в `<!--noindex-->…<!--/noindex-->` для Яндекса;
   - контейнер снабжается атрибутом `data-nosnippet` для Google.

   Это позволяет использовать blur как честный визуальный тизер без риска клоакинга: поисковые системы видят только логическое введение, а платный контент не доступен ни визуально, ни технически.

3. **Рекомендации (recommendations).**  
   Статьи рекомендаций в бесплатной версии отображаются **полностью**, без paywall. По ним строится карусель рекомендаций и отдельные страницы. Они индексируются как обычные Article-страницы.

4. **Приложения (appendix).**  
   В бесплатной сборке приложения не рендерятся: для них не создаются страницы и пункты меню.

Во всех случаях для бесплатной версии страницы помечаются как `index, follow`. Управление индексацией платной версии и её страниц описано отдельно в архитектурном документе и разделе про SEO.
## Логика генерации платной версии

Платная версия это полноценный обучающий курс где пользователь последовательно изучает материал раздел за разделом. Здесь нет никаких ограничений контента и есть удобная навигация для последовательного прохождения.

**Вводная статья (intro):**

Отображается точно так же как и в бесплатной версии - полностью без ограничений. Но вместо кнопки "Войти в полную версию" в конце статьи показывается кнопка "Далее" которая ведет на первый раздел курса (раздел 1 basics). Это логично потому что пользователь уже оплатил доступ и готов приступить к обучению.

**Платные разделы курса (course):**

Каждый раздел отображается полностью со всем текстом, изображениями, таблицами, примерами кода - всем контентом который есть в исходном markdown файле. В конце каждого раздела размещается кнопка "Далее" которая автоматически определяет следующий раздел по порядку номеров в именах файлов и делает переход на него.

Например если пользователь читает раздел 03_chemistry.md, кнопка "Далее" автоматически ведет на раздел 04_practice.md. Для последнего раздела курса кнопка "Далее" либо не показывается вообще, либо показывается текст "Вы завершили курс" с кнопкой возврата на главную.



**Приложения (appendix):**

Все файлы из `content/appendix/` в платной версии отображаются как отдельные разделы курса:

- для каждого приложения создаётся своя страница;
- отображение аналогично разделам `course` — весь текст Markdown-файла, без paywall;
- в меню структуры курса приложения всегда идут после разделов 1–10, в алфавитном порядке по букве в имени файла (`A_…`, `B_…`, `C_…` и т.д.);
- в навигации «Далее/Назад» приложения тоже следуют за последним числовым разделом.

В бесплатной версии приложения не рендерятся (для них не создаётся ни страниц, ни пунктов меню).

**Статьи рекомендаций (recommendations):**

В платной версии эти статьи идентичны бесплатной - показываются полностью. В конце статьи кнопка "Войти в полную версию" заменяется на кнопку "Вернуться к курсу" которая ведет обратно на главную страницу или на раздел с которого пользователь перешел на рекомендацию.

## Автоматическая генерация карусели рекомендаций

Карусель рекомендаций — это визуальный элемент на боковой панели (и/или внизу страницы на мобильных), который показывает карточки рекомендованных статей и ведёт на соответствующие страницы с рекомендациями.

Карусель должна генерироваться **автоматически** на основе файлов в `content/recommendations/`. Для остальных типов контента (`intro`, `course`, `appendix`, `legal`) эта логика не применяется.

### Источник данных

Каждый файл в `content/recommendations/` — отдельная статья-рекомендация. Для него используется следующая схема:

- `H1` в Markdown — заголовок статьи (и fallback для названия карточки).
- YAML front matter (если присутствует) может содержать:
  - `title` — явное название для карточки (если не задано, берём H1);
  - `teaser` — краткое описание для карточки (1–3 предложения);
  - `image` — путь к иллюстрации;
  - `order` — опциональный номер для сортировки в карусели.

Пример YAML-шапки:

```yaml
---
title: "Почему сода и уксус не панацея"
teaser: "Разбираем, когда бытовые лайфхаки работают, а когда лучше взять правильное средство."
image: "/static/reco/soda-vinegar.png"
order: 20
---
```

Тело статьи после шапки — обычный Markdown-текст.

### Формирование JSON для карусели

При сборке (в рамках `build:all`, `build:free`, `build:premium` или отдельной команды `build:reco`) скрипт:

1. Сканирует папку `content/recommendations/`.
2. Для каждого файла:
   - парсит YAML front matter (если есть);
   - получает:
     - `title` — либо из `title`, либо из H1;
     - `teaser` — либо из поля `teaser`, либо, если поле отсутствует, из первых ~100 символов основного текста (без заголовков), с добавлением многоточия;
     - `image` — из поля `image` (можно оставить пустым, тогда карточка будет без картинки или с заглушкой по умолчанию);
     - `url` — по имени файла (например, `eco-cleaning.md` → `/recommendations/eco-cleaning.html`);
     - `order` — если есть в шапке, иначе null.
3. Собранные данные записываются в JSON-файл (например, `recommendations.json`) или JS-модуль, который подключается на все страницы с каруселью.

Сортировка карточек в карусели:

- сначала по `order` (если задан);
- затем по имени файла (или по заголовку) как стабильный fallback.

Важно: логика `title/teaser/image/order` и генерация `recommendations.json` распространяется **только** на файловую ветку `content/recommendations/` и никак не влияет на обработку основных разделов курса и приложений.

### Build-команда для обновления рекомендаций

В `package.json` должна быть отдельная команда (например, `npm run build:reco`), которая:

- пересобирает только статьи в `content/recommendations/`;
- обновляет JSON для карусели;
- не трогает основную сборку курса.

Это позволяет быстро добавлять и править рекомендации без полной пересборки всего проекта.

## Время чтения в меню структуры курса

Боковое меню показывает структуру всего курса со списком разделов. Рядом с названием каждого раздела должно показываться примерное время которое потребуется на чтение этого раздела. Это помогает пользователю планировать свое время и понимать объем материала.

Build скрипт при обработке каждого markdown файла подсчитывает общее количество слов в тексте. При подсчете исключаются заголовки всех уровней, блоки кода, таблицы - считаются только слова в обычных параграфах текста. Средняя скорость чтения русского текста составляет примерно двести слов в минуту. Делим количество слов на двести и получаем время в минутах.

Результат округляется до целых минут. Если получается меньше одной минуты, показываем "меньше 1 мин". Если от одной до девяти минут, показываем просто число и слово "мин". Если десять минут и больше, можно показывать "10+ мин" чтобы не пугать пользователя большими числами.

В HTML меню время вставляется как span элемент с классом reading-time сразу после названия раздела. Например: "1. Основы работы ~ 5 мин". Стилизация делает время менее заметным чем название раздела - меньший размер шрифта, серый цвет, возможно курсив. Но при этом оно должно быть легко читаемым а не теряться в дизайне.

Это время показывается и в бесплатной и в платной версии сайта, потому что помогает пользователю оценить объем курса еще на этапе принятия решения о покупке.


Дополнительно: рассчитанное время чтения используется в paywall-блоке платных разделов в бесплатной версии. Над blur-фрагментом на странице раздела выводится подпись вида «Осталось N минут чтения», где N — то же самое значение, что отображается в меню структуры курса для этого раздела.

## Модальное окно оплаты

Кнопка "Войти в полную версию" открывает модальное окно прямо поверх текущей страницы без перехода на другой URL. Это важно для пользовательского опыта и для SEO - человек остается на той странице где нашел интересную информацию, а покупка оформляется быстро и удобно.

Модальное окно состоит из нескольких слоев. Нижний слой это overlay - полупрозрачный темный фон который покрывает весь экран и делает неактивным контент под ним. К overlay применяется backdrop-filter blur четыре пикселя что создает эффект размытия фона. Поверх overlay по центру экрана располагается белый контейнер с закруглением шестнадцать пикселей и тенью.

В правом верхнем углу контейнера крестик для закрытия. Клик по крестику, клик по overlay вне контейнера, или нажатие клавиши Escape - все эти действия закрывают модальное окно и возвращают пользователя к чтению.

Внутри контейнера размещается контент оплаты. Заголовок крупным шрифтом "Получите полный доступ к курсу". Ниже маркированный список преимуществ покупки: все десять разделов с подробными объяснениями, практические алгоритмы и чек-листы, таблицы совместимости средств и материалов, пожизненный доступ ко всем материалам, бесплатные обновления курса в будущем.

После списка блок с ценой где старая цена одна тысяча девятьсот девяносто рублей показывается зачеркнутой более мелким шрифтом, а новая актуальная цена девятьсот девяносто рублей показывается крупным жирным шрифтом с акцентным цветом.

Далее форма с одним полем - ввод email адреса. Плейсхолдер в поле "Введите ваш email". После поля крупная кнопка "Оплатить 990 рублей". При нажатии на кнопку происходит валидация email и если он корректен, происходит submit формы с переходом на страницу Robokassa. Email передается в параметрах чтобы после успешной оплаты система знала на какой адрес отправить данные для входа.

Под кнопкой мелким серым текстом примечание "Безопасная оплата через Robokassa" с иконкой замочка для доверия.

Анимация появления модального окна делает UX более плавным. Overlay появляется с fade-in эффектом от нуля до единицы opacity за сто шестьдесят миллисекунд. Контейнер появляется с небольшим scale эффектом - стартует с девяноста процентов размера и увеличивается до ста процентов за двести сорок миллисекунд. Используется easing cubic-bezier для более естественного движения. Исчезновение окна использует те же анимации но в обратном направлении и с немного меньшей длительностью.

## Миграция базы пользователей на SQLite

Текущая система хранит данные пользователей в JSON файле. Это простое решение но оно имеет критические проблемы с конкурентностью и масштабируемостью. При одновременных покупках возможна потеря данных. При росте базы до нескольких тысяч пользователей замедляется авторизация. Нужно мигрировать на proper базу данных.

SQLite это файловая база данных которая не требует установки отдельного сервера и отлично подходит для проектов малого и среднего размера. Для работы с SQLite в Node.js использовать библиотеку better-sqlite3. Это нативная библиотека написанная на C++ которая дает максимальную производительность. Она синхронная что упрощает код и делает его более читаемым без callback hell. Это стандартное и проверенное решение в Node экосистеме.

Создать таблицу users со следующими полями. Поле id типа integer с автоинкрементом как первичный ключ. Поле email типа text с ограничением unique чтобы нельзя было зарегистрировать один email дважды. Поле password_hash типа text для хранения хешированного пароля. Поле created_at типа datetime с дефолтным значением текущей даты времени. Опциональные поля invoice_id и amount типа text и integer для хранения данных о покупке.

Критически важно создать индекс на поле email потому что при каждой авторизации будет происходить поиск пользователя по email. Без индекса это будет полное сканирование таблицы что медленно. С индексом это O(log n) операция которая работает мгновенно даже на десятках тысяч записей.

В PHP скриптах для работы с SQLite использовать PDO (PHP Data Objects) которая встроена в PHP и не требует установки дополнительных расширений. В robokassa-callback.php заменить код который читает JSON файл на подключение к базе SQLite. Использовать prepared statements для вставки нового пользователя - это защищает от SQL инъекций. Обернуть операцию в транзакцию чтобы гарантировать атомарность - либо пользователь создается полностью либо не создается вообще.

В auth.php заменить перебор массива пользователей на SQL запрос SELECT с условием WHERE email равен введенному. Также использовать prepared statement для безопасности. База вернет либо одну запись если пользователь найден, либо пустой результат если не найден.

Файл базы данных users.db должен храниться вне публичной директории сайта чтобы его нельзя было скачать через браузер. Например если корень сайта находится в /home/username/public_html, то база должна лежать в /home/username/private/users.db. Путь к базе прописывается в конфигурационном файле config.php который также лежит вне public_html и содержит все чувствительные настройки.

Если на момент обновления в старом JSON файле уже есть пользователи, нужен миграционный скрипт. Это простой PHP или Node скрипт который читает users.json, создает SQLite базу с нужной схемой, и переносит всех пользователей из JSON в SQLite сохраняя все их данные. Этот скрипт запускается один раз вручную при первом деплое обновленной версии.

## SEO оптимизация для правильной индексации

Поисковые системы должны понимать что бесплатная версия сайта показывает честный preview контента а не пытается манипулировать выдачей. Для этого используется микроразметка Schema.org которая явно декларирует структуру контента и правила доступа.

Для главной страницы (вводная статья) используется тип Course из Schema.org. Это сообщает поисковикам что это образовательный курс. В JSON-LD блоке указываются название курса, описание, провайдер (организация которая предоставляет курс), тип обучения (онлайн), примерная длительность курса. Эта разметка встраивается в секцию head страницы.

Для платных разделов с preview используется специальная комбинация типов Article и WebPageElement. Тип Article описывает статью с указанием заголовка и body который содержит только тот текст что реально показывается пользователю (первый абзац плюс второй в размытом виде). Важное свойство isAccessibleForFree устанавливается в false что явно говорит поисковику - эта статья платная. Дополнительно используется hasPart которое описывает что часть контента (премиум контент) недоступна бесплатно и для доступа к ней нужна оплата.

Для статей рекомендаций используется простой тип Article с isAccessibleForFree установленным в true. Это сигнализирует что статья полностью открыта и бесплатна для всех. Указывается полный текст статьи в articleBody, автор, дата публикации если есть.

Все мета-теги для SEO должны генерироваться автоматически при сборке. Title каждой страницы формируется из заголовка H1 плюс название сайта через вертикальную черту. Например "Раздел 3: Химия средств | Clean by TooSmart". Длина title не должна превышать шестьдесят символов иначе будет обрезан в выдаче.

Meta description это первые сто пятьдесят - сто шестьдесят символов текста из статьи без заголовков и форматирования. Это то что показывается в сниппете поисковой выдачи под заголовком. Description должен быть информативным и мотивировать кликнуть на ссылку.

Canonical URL это абсолютный путь к текущей странице. Он нужен чтобы избежать проблем с дублированием контента если к одной странице можно попасть по разным URL. Например если страницу можно открыть и через toosmart.ru/chemistry и через toosmart.ru/course/chemistry, canonical укажет какой из этих URL основной.

Open Graph теги нужны для красивых превью когда ссылку на сайт шарят в социальных сетях. Генерируются og:title, og:description, og:type (article для статей), og:url, og:image (если в статье есть изображение, первое из них становится превью). Twitter Cards это аналог Open Graph специально для Twitter.

Alt теги для изображений критически важны для SEO и доступности. При парсинге markdown синтаксиса изображений извлекается alt текст из квадратных скобок. Если alt пустой, используется title из кавычек. Если и title пустой, берется имя файла без расширения и преобразуется в читаемый текст (дефисы заменяются на пробелы).

Файл robots.txt размещается в корне бесплатной версии сайта и содержит директивы для поисковых роботов. Разрешается индексация корня, страниц курса (с preview), рекомендаций. Запрещается индексация премиум версии целиком, PHP скриптов, служебных папок. В конце указывается путь к sitemap.

Файл sitemap.xml генерируется автоматически и содержит список всех страниц бесплатной версии которые должны индексироваться. Для каждой страницы указывается URL, приоритет (от нуля до единицы), частота обновления. Главная страница имеет наивысший приоритет единица и частоту weekly. Рекомендации имеют приоритет ноль целых восемь десятых и частоту monthly. Preview платных разделов имеют приоритет ноль целых шесть десятых. Премиум версия в sitemap не включается потому что закрыта robots.txt.

## Интеграция систем аналитики

Для отслеживания трафика источников посетителей и их поведения на сайте нужно интегрировать счетчики Яндекс Метрики и Google Analytics. Код счетчиков вставляется в HTML шаблон в секцию head перед закрывающим тегом.

Яндекс Метрика предоставляет подробную статистику по российской аудитории. В настройках счетчика включаются опции clickmap (карта кликов показывает куда люди чаще всего кликают на странице), trackLinks (отслеживание кликов по внешним ссылкам), accurateTrackClick (более точное определение кликов), webvisor (запись сессий пользователей для анализа их поведения). ID счетчика подставляется из конфига.

Для подтверждения владения сайтом в Яндекс Вебмастере в head добавляется мета-тег с кодом верификации. Этот код выдается в интерфейсе Вебмастера при добавлении сайта.

Google Analytics дает более детальную статистику и лучше работает с международной аудиторией. Используется новая версия GA4. Код счетчика загружается асинхронно чтобы не блокировать рендеринг страницы. Measurement ID подставляется из конфига.

Чтобы не хардкодить ID счетчиков в шаблоне, создается конфигурационный файл config/analytics.json со структурой простого объекта содержащего три поля: yandex_metrika_id, yandex_verification, google_analytics_id. Build скрипт читает этот файл и подставляет значения в HTML шаблоны при генерации. Файл config/analytics.json добавляется в gitignore чтобы реальные ID счетчиков не попадали в репозиторий. В репозитории хранится только example файл config/analytics.example.json с плейсхолдерами.

## Юридические требования и футер

Российское законодательство требует от сайтов которые продают товары или услуги и собирают персональные данные наличия определенных документов и информации. Все эти документы размещаются на сайте и ссылки на них выносятся в футер который показывается на всех страницах.

В HTML шаблон перед закрывающим тегом body добавляется секция footer с классом site-footer. Футер делится на несколько колонок. Первая колонка содержит полное юридическое название организации (ООО "ТуСмарт" или ИП Иванов Иван Иванович), ИНН, ОГРН для ООО или ОГРНИП для ИП, юридический адрес полностью. Эта информация обязательна по закону.

Вторая колонка содержит список ссылок на юридические документы. Политика конфиденциальности объясняет какие данные собираются и как используются. Согласие на обработку персональных данных это юридический документ соответствующий закону сто пятьдесят второй ФЗ. Публичная оферта описывает условия договора между продавцом и покупателем. Порядок возврата объясняет как вернуть товар и получить деньги обратно в соответствии с законом о защите прав потребителей.

Третья колонка содержит контактную информацию - email службы поддержки, возможно телефон и адрес офиса если есть.

В самом низу футера копирайт с текущим годом и названием компании.

Сами юридические документы создаются как markdown файлы в папке content/legal/. Build скрипт обрабатывает их так же как обычный контент но размещает в отдельной папке /legal/ и не включает в навигацию курса. Каждый документ это полноценная HTML страница с тем же дизайном что и остальной сайт.

Политика конфиденциальности должна раскрывать какие данные собираются (email при покупке, cookies для аналитики и работы сайта), для каких целей используются (предоставление доступа к оплаченному контенту, улучшение пользовательского опыта, статистика посещаемости), как хранятся (шифрование паролей, защищенное хранилище базы данных), кому передаются (Robokassa для обработки платежей), какие права есть у пользователя (доступ к своим данным, их изменение, удаление аккаунта).

Публичная оферта это договор который заключается в момент оплаты. Описывается предмет договора (предоставление доступа к онлайн-курсу Clean), стоимость и способы оплаты (девятьсот девяносто рублей через платежную систему Robokassa), порядок оформления заказа (выбор курса, ввод email, переход на оплату), момент заключения договора (успешная оплата счета), порядок предоставления доступа (отправка пароля на email в течение одного часа после подтверждения оплаты), срок действия доступа (бессрочный).

Порядок возврата описывает права покупателя согласно закону о защите прав потребителей. Покупатель имеет право отказаться от услуги в течение четырнадцати дней с момента покупки если доступ к материалам курса не был использован. Процедура возврата через письменное заявление на email с указанием причины. Срок возврата денежных средств десять рабочих дней. Случаи когда возврат невозможен - если пользователь уже авторизовался в премиум версии и получил доступ к материалам курса.

Футер стилизуется отдельно от основного контента. Фон темнее чем у страницы, текст светлый для контраста. Ссылки хорошо видны и меняют цвет при наведении. На мобильных устройствах колонки располагаются вертикально одна под другой для удобства чтения. Футер показывается на всех страницах обеих версий сайта без исключения.

## Дополнительные элементы интерфейса

Хлебные крошки это навигационная цепочка которая показывает путь от главной страницы до текущей. Размещаются над основным контентом. Каждый элемент цепочки это ссылка кроме последнего который показывает текущую страницу. Между элементами разделитель (обычно символ больше или слэш).

Для хлебных крошек обязательна микроразметка BreadcrumbList из Schema.org. Это помогает поисковым системам понимать структуру сайта и может показываться в расширенном сниппете поисковой выдачи что увеличивает кликабельность.

Кастомная страница 404 создается для случаев когда пользователь попадает на несуществующий URL. Вместо стандартной ошибки сервера показывается дружелюбная страница в дизайне сайта с сообщением что страница не найдена, ссылками на главную страницу и структуру курса, возможно простым поиском по заголовкам разделов. Это снижает процент отказов когда люди попадают на битые ссылки.

## Технические требования и стандарты

Проект должен собираться только на Node.js версии восемнадцать или выше. Это жесткое требование потому что код использует современный синтаксис JavaScript (optional chaining, nullish coalescing) который не поддерживается в Node двенадцать. В package.json добавить поле engines с указанием минимальной версии Node чтобы npm выдавал ошибку при попытке установки на старой версии.

Все существующие markdown файлы курса должны работать без изменений после обновления. Обратная совместимость критична. Файлы с номерами в начале имени должны обрабатываться корректно независимо от разделителя (дефис, подчеркивание, точка).

Команды сборки остаются теми же плюс добавляются новые. Команда npm run build собирает обе версии полностью. Команда npm run build:free собирает только бесплатную версию. Команда npm run build:premium собирает только премиум версию. Новая команда npm run build:recommendations пересобирает только рекомендации и обновляет JSON файл.

Для production сборки добавить минификацию CSS и JavaScript файлов. Использовать стандартные инструменты типа cssnano для CSS и terser для JS. Это уменьшает размер файлов и ускоряет загрузку страниц.

После каждой сборки автоматически проверять наличие битых ссылок внутри сайта. Если в каком-то разделе есть ссылка на другой раздел которого не существует, build должен выдать warning с указанием файла и строки где найдена битая ссылка.

Все пути в сгенерированных HTML файлах должны быть относительными а не абсолютными. Никаких hardcoded доменов типа https://toosmart.ru в коде. Это позволяет разворачивать сайт на тестовом домене или локально без правок кода.

В README.md обновить документацию с описанием новой структуры папок, объяснением что такое intro course и recommendations, примерами команд сборки, инструкцией по настройке аналитики через config файл, инструкцией по миграции с JSON на SQLite для тех у кого уже есть пользователи в старом формате.

## Приоритеты реализации

Блокирует запуск в продакшен:

1. Трехуровневая структура контента (intro, course, recommendations) с правильной обработкой каждого типа
2. Корректная генерация бесплатной версии (первый абзац открыт, второй заблюрен высотой двести пикселей, кнопка "Войти в полную версию" везде)
3. Корректная генерация платной версии (полный контент, кнопка "Далее" переходит на следующий раздел)
4. Модальное окно оплаты с формой и переходом на Robokassa
5. Микроразметка Schema.org для всех типов контента
6. Миграция на SQLite с prepared statements
7. Юридические документы и футер на всех страницах

Важно сделать до запуска: 8. Автоматическая генерация карусели из recommendations.json 9. Время чтения рядом с названием раздела в меню 10. Генерация sitemap.xml и robots.txt 11. Интеграция счетчиков через config файл

Можно добавить после запуска: 12. Хлебные крошки с микроразметкой 13. Кастомная страница 404 14. Проверка битых ссылок при сборке