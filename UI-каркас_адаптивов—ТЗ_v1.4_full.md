# UI‑каркас адаптивов — архитектура и UX‑ТЗ (полная версия v1.4)

## 0) Назначение и границы
Сформировать стабильный, предсказуемый каркас страницы курса с едиными режимами (desktop / tablet‑wide / handheld), синхронным поведением левой рельсы (меню), хедера (логотип+«рука»), основной колонки чтения и правой колонки «Рекомендации». ТЗ описывает **структуру DOM**, **состояния**, **раскладки**, **жесты/клики**, **поведение скролла**, **правила доступности**, **токены и слоями (z‑порядок)**, а также **наполнение тестовым контентом** для визуальной валидации. Дизайн‑темы, шрифты и подробный CSS/JS‑код — вне данного ТЗ.

---

## 1) Термины (UI)
- **Меню** — левая рельса с оглавлением структуры курса; overlay (всегда вне Grid).
- **Текстовый блок** — основная колонка с материалом статьи/раздела.
- **Рекомендации** — правая колонка со ссылками на дополнительные материалы/статьи.
- **Хэдер** — верхняя полоска (логотип + «рука» + 1‑2 ссылки); на десктопе съезжает синхронно с меню.
- **«Точки»** — боковой индикатор разделов/якорей текущей статьи (скролл‑меню).
- **Кнопка «Далее»** — переход к следующему разделу/материалу в рамках курса.
- **Плашка‑док (handheld)** — нижняя полоса с ярлыком меню, всегда видима на экране.
- **Бэкдроп** — затемнение/подложка для overlay‑состояний (кликабельно для закрытия).

---

## 2) Режимы и переключение
### 2.1. Режимы
- **Desktop** — `vw ≥ 1280` и `pointer:fine` (или `vw ≥ 1440` без проверки указателя).
- **Tablet‑Wide** — `1024 ≤ vw ≤ 1366` и устройство c тач (iPadOS учитывается; iPad mini сюда **не** относится).
- **Handheld** — `vw < 1024` или любая тач‑портретная ориентация.

### 2.2. Фоллбэк при неопределённом режиме
- 1024–1366 → считать **tablet‑wide**.
- <1024 → считать **handheld**.
- ≥1440 → считать **desktop**.

### 2.3. Спорные устройства
- **iPad с трекпадом** (репортит `pointer:fine`): при `1024–1366` и iPadOS трактовать как **tablet‑wide**.
- **Внешние мониторы**: решение по «режиму» принимает окно, в котором открыт документ.

### 2.4. Точки режима
- Режим отражается атрибутом `body[data-mode="desktop|tablet-wide|handheld"]`.
- Пересчёт на `resize` и `orientationchange` обязателен; состояние `menu-open` на non‑desktop при смене ориентации снимается.

---

## 3) Структура DOM (скелет)
- `body[data-mode]` — контейнер состояний.
  - `.header` — верхняя полоса (логотип, «рука», ссылки).
  - `.menu-rail` — левая рельса меню (overlay).
    - `.site-menu` — прокручиваемая область пунктов меню.
  - `.main` — центральная область раскладки (Grid‑контейнер режимов).
    - `.panel`
      - `.text-box` — колонка чтения (контент статьи).
      - `.dots-rail` — «точки» (desktop‑только).
      - `.btn-next` — кнопка «Далее» (в конце текстового блока).
    - `.stack`
      - `.stack-list` — карточки рекомендаций (6–10 фиктивных пунктов для наглядности).
  - `.backdrop main` — кликабельная подложка для overlay‑состояний (скрыта по умолчанию).
  - `.dock` (handheld‑только)
    - `.dock-handle` — ярлык меню (надпись), по тапу/свайпу открывает меню снизу.

Примечание: overlay‑элементы (`.menu-rail`, `.backdrop`, модальные окна) **всегда вне Grid**.

---

## 4) Токены (переменные) и слои (z‑порядок)
### 4.1. Токены
- Геометрия: `--content-width:540px; --gap-page:32px; --stack-gap:16–24px;`
- Меню: `--rail-closed:70px; --rail-open:320px;`
- Sticky‑рамки: `--stack-top:16px; --stack-bottom:16px;`
- Анимации: `--t-rail:220ms; --t-backdrop:160ms;` (easing опционально).
- Viewport: использовать `min(100svh,100dvh)` для высот overlay.

### 4.2. Z‑порядок
Контент (0) → sticky‑stack (100) → `.menu-rail` (1201) → `.backdrop` (1400) → модальные (1600).

---

## 5) Раскладка (Grid и позиции)
### 5.1. Desktop
- Сетка `.main`: `1fr | 540px | clamp(320px, 28–30vw, 420px) | 1fr`.
- `.panel` — колонка чтения (вторая колонка).
- `.stack` — правая колонка (третья колонка).
- `.menu-rail` — overlay (fixed), **не** участвует в Grid.
- `.dots-rail` — слева от `.text-box`, на линии левой кромки текста; по вертикали центр экрана.

### 5.2. Tablet‑Wide
- Сетка `.main`: `1fr | 540px | clamp(280px, 30vw, 360px) | 1fr`.
- `.panel` — колонка чтения (вторая колонка).
- `.stack` — правая колонка (третья колонка); **не переносится вниз**.
- `.menu-rail` — overlay (fixed), **не** участвует в Grid.
- `.dots-rail` — скрыта.

### 5.3. Handheld
- `.main` — одна колонка (потоковая раскладка).
- Порядок: `.panel` → `.btn-next` → `.stack`.
- `.dock` фиксируется снизу, страница имеет нижний `padding` = высота дока + safe‑area.

---

## 6) Поведение правой колонки «Рекомендации»
- Desktop/Tablet‑Wide: `.stack` **всегда справа и в кадре**.
  - `position: sticky; top: var(--stack-top); align-self:start;`
  - Высота: `calc(min(100svh,100dvh) - var(--stack-top) - var(--stack-bottom))`.
  - Внутренний скролл включается, когда карточек больше высоты колонны.
  - Логика движения: 
    1) Пока колонка не достигла sticky‑позиции — двигается вместе со страницей.  
    2) Достигнув sticky‑позиции — «останавливается», текст продолжает прокручиваться.  
    3) При избытке карточек — прокрутка **внутри** `.stack`, страница не «дёргается`.
- Handheld: `.stack` идёт **под** текстом; обычный поток без sticky.

---

## 7) Меню (левая рельса) и хэдер
### 7.1. Общие правила
- `.menu-rail` всегда `position:fixed; left:0; top:0; bottom:0;`.
- Два состояния по ширине: закрыто (`--rail-closed`), открыто (`--rail-open`).
- Состояние фиксируется классом: `body.menu-open`.
- Внутри `.site-menu` скролл независим от страницы (если указатель внутри).

### 7.2. Синхронный сдвиг хедера и «руки» (desktop + tablet‑wide)
- При выезде меню хэдер (вместе с логотипом и «рукой») **съезжает синхронно** со скоростью и величиной, равной смещению меню.
- Сдвиг не изменяет Grid‑геометрию контента; это чистый overlay‑эффект.

### 7.3. Триггеры открытия/закрытия
- **Desktop**: 
  - `hover` по вертикальному ярлыку слева → временный выезд (`body.is-slid`).  
  - Наведение на `.panel` → снимает `is-slid`.  
  - Клик по ярлыку/бэкдропу/`Esc` → жёстко открыть/закрыть `menu-open`.
- **Tablet‑Wide (горизонтальные планшеты)**:
  - Тап/клик по ярлыку (узкая полоса) → открыть.  
  - **Edge‑свайп** от левого края (старт `clientX ≤ 24px`, `dx ≥ 28px`, `|dy|<80px`) → открыть.  
  - Тап по бэкдропу/`Esc` → закрыть.  
  - Hover‑слайд отключён.
- **Handheld (вертикальные планшеты и телефоны)**:
  - Ярлык переносится в **плашку‑док** снизу (всегда видим).  
  - Тап по ярлыку или свайп **вверх** из плашки → открыть.  
  - Свайп **вниз** по открытому меню, тап по верхней пустой области меню или `Esc` → закрыть.  
  - При открытом меню страница получает блокировку фонового скролла.

### 7.4. Принципы скролла
- Когда курсор/тач‑фокус **внутри** `.site-menu` — прокручивается только содержимое меню.  
- Во всех остальных случаях прокручивается текстовый блок/страница.

---

## 8) «Точки» (скролл‑навигация по разделам)
- Источник данных — заголовки разделов (например, `h2` с `data-section` в рамках текущей статьи).  
- Отображаются **только на desktop**.  
- Позиция: «прилипают» к левой кромке `.text-box`; по вертикали — центр вьюпорта.  
- Количество и активное состояние динамически соответствуют количеству и позиции секций (5 тестовых разделов ниже).
- На tablet‑wide и handheld блок скрывается, чтобы исключить дубли навигации.

---

## 9) Кнопка «Далее»
- Расположение: в конце текстового блока (перед «Рекомендациями» на handheld).  
- Действие: прокрутка к следующей секции в текущей статье **или** переход к следующему материалу курса (в зависимости от интеграции курса). Логика выбирается проектно, UI остаётся одинаковым.

---

## 10) Состояния и классы
- `body[data-mode="desktop|tablet-wide|handheld"]` — режим.
- `body.menu-open` — меню раскрыто.
- `body.is-slid` — временный выезд при hover (desktop‑только).
- `html/body[data-lock="scroll"]` — блокировка фонового скролла (handheld при `menu-open`).

---

## 11) Жесты/клики: матрица взаимодействий
| Действие | Desktop | Tablet‑Wide | Handheld |
|---|---|---|---|
| Открыть меню | Hover по ярлыку (временно), клик по ярлыку | Тап/клик по ярлыку, edge‑свайп слева | Тап по ярлыку в плашке, свайп вверх из плашки |
| Закрыть меню | Клик по бэкдропу, `Esc`, наведение на `.panel` (для `is-slid`) | Клик по бэкдропу, `Esc` | Свайп вниз по меню, тап по верхней пустой области меню, клик по бэкдропу, `Esc` |
| Скролл меню | Только когда указатель/фокус внутри меню | То же | То же (при `menu-open`) |
| Скролл текста | Всегда вне меню | Всегда вне меню | Заблокирован при `menu-open`, активен после закрытия |
| «Точки» | Видимы, кликабельны | Скрыты | Скрыты |
| «Рекомендации» | Sticky справа | Sticky справа | Ниже текста |

---

## 12) Доступность (A11y) и фокус
- Меню: при открытии — `role="dialog" aria-modal="true"`, фокус‑трап внутри; при закрытии — возврат фокуса на инициатор (ярлык/плашка).  
- Ярлык меню (в плашке/на рельсе): `aria-controls` на меню; `aria-expanded=true|false` согласно состоянию.  
- `Esc` везде закрывает overlay‑состояние.  
- Бэкдроп помечается как «декоративный» (можно `aria-hidden="true"`) и кликабелен для закрытия.

---

## 13) Нефункциональные требования
- **Без горизонтальной прокрутки** во всех режимах.  
- **Без CLS**: открытие/закрытие меню не меняет размеры Grid‑областей; overlay‑элементы вне потока.  
- **Производительность**: анимации (если есть) только translate/opacity; без дорогостоящих reflow.  
- **Safe‑area**: учесть `env(safe-area-inset-*)` для нижней плашки и sticky‑высоты.  
- **Viewport‑единицы**: для высот overlay использовать `min(100svh,100dvh)`.

---

## 14) Наполнение тестовым контентом (обязательно)
### 14.1. Короткие описания назначений блоков (по 1 абзацу внутри каждого блока)
- **Меню (оглавление):** Этот блок показывает, как пользователь просматривает разделы курса и перемещается по материалу. Проверьте отдельный скролл внутри меню и реакции на hover/тап/свайп в зависимости от режима.  
- **Текстовый блок:** Здесь расположен основной материал. Тестовое содержание имитирует структуру урока и помогает оценить ширину колонки, переносы строк, якоря разделов и взаимодействие с «точками».  
- **Рекомендации:** Правая колонка отражает связанные материалы. Наблюдаем поведение sticky и независимый скролл при избытке карточек; колонка остаётся видимой и не влияет на ширину текста.  
- **Хэдер:** Верхняя полоса с логотипом и «рукой». На десктопе хэдер синхронно съезжает с меню; на планшетах — более узкий, но с тем же принципом движения; на телефонах — статичен относительно плашки.

### 14.2. Пять тестовых разделов (≈1000 символов каждый, в 3 абзаца)
**Раздел 1**  
Этот текст моделирует короткий фрагмент урока: одно центральное утверждение, один конкретный пример и небольшой итог. Нужен для проверки читаемости строки и визуального ритма.

Второй абзац короче: оцениваем межабзацные интервалы, переносы и совпадение якорей с «точками».

Третий абзац завершает раздел и подготавливает мягкий переход к кнопке «Далее» и блоку «Рекомендации».

**Раздел 2**  
Материал имитирует теоретический блок: определение, краткий вывод и бытовой пример применения. Нейтральный тон не отвлекает от UX‑наблюдений.

Во втором абзаце смотрим взаимодействие прокрутки, позиционирование якорей и активное состояние «точек».

Завершающий абзац призван проверить видимость кнопки «Далее» и корректность перехода к следующему разделу.

**Раздел 3**  
Эта секция предназначена для испытания стабильности каркаса: длина строк, «прилипание» правой колонки и синхронность прокрутки с текстом.

Во втором абзаце наблюдаем поведение при изменении ширины: исчезновение «точек» и сжатие карточек рекомендаций.

Третий абзац завершается подготовкой к кнопке «Далее» и проверке последовательности переходов по статье.

**Раздел 4**  
Контент сфокусирован на визуальной верификации: видимые рамки, скругления и серые оттенки. Это помогает различать зоны и не смешивать роли блоков.

Второй абзац убеждается в отсутствии горизонтальной прокрутки и корректном центрировании колонки чтения.

Третий абзац моделирует длинные заголовки и проверяет, что навигация остаётся предсказуемой.

**Раздел 5**  
Заключительный блок проверяет совместную работу с «Рекомендациями»: достаточную высоту sticky и независимый внутренний скролл карточек при избытке контента.

Во втором абзаце оцениваем плавность перехода к блоку рекомендаций после нажатия «Далее».

Третий абзац завершает последовательность и готовит возвращение к оглавлению через меню.

### 14.3. Карточки рекомендаций (наполнение)
- Подготовить 6–10 фиктивных карточек с короткими заголовками и 1‑2 строками аннотаций, чтобы гарантированно включался внутренний скролл в `.stack` на desktop/tablet‑wide.

### 14.4. Визуальное оформление заглушек
- Все блоки визуально различить **оттенками серого**, с **рамкой 1px** и **скруглениями**; без акцентных цветов и декоративных эффектов.

---

## 15) Нейминг, состояния, роли
- Режимы/состояния: `body[data-mode]`, `menu-open`, `is-slid`, `data-lock="scroll"`.
- Блоки: `.header`, `.menu-rail > .site-menu`, `.main`, `.panel > .text-box`, `.dots-rail`, `.btn-next`, `.stack > .stack-list`, `.backdrop.main`, `.dock > .dock-handle`.
- Роли: меню при открытии — `role="dialog" aria-modal="true"`; ярлык/ручка — `aria-controls` + `aria-expanded`.

---

## 16) Ограничения и договорённости
- **Меню** и все overlay‑элементы — вне Grid, не влияют на размеры колонок/строк.  
- **Рекомендации** на desktop/tablet‑wide — всегда справа; на handheld — всегда под текстом.  
- **«Точки»** существуют только на desktop.  
- Никаких дополнительных «малых» кнопок «Меню» вне рельсы/плашки.  
- Анимации (если будут) не должны вызывать H‑scroll или изменять Grid‑геометрию.  
- Все числовые параметры управляются **токенами**; правки — в одном месте.

