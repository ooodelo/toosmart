Аудит №2024-09-17
- Вынесены общие пороги и вспомогательные функции определения режима в `mode-utils.js`, доступные как глобально, так и для модульного скрипта.
- Обновлен ранний bootstrap в `index.html` для использования общей утилиты при мгновенном применении `data-mode`.
- Обновлен основной бандл `script.js`, чтобы полагаться на `ModeUtils` и сохранить диагностику ширины в режиме отладки.
- Добавлено раннее назначение `data-input` через общую утилиту, чтобы исключить рассинхрон на touch-устройствах до загрузки основного бандла.

Аудит №2024-10-05
- Переведено отладочное логирование flyout на отключенное по умолчанию состояние с возможностью переопределения через `window.DEBUG_FLYOUT` и пользовательский логгер.
- Обернуты диагностические сообщения flyout в условную функцию, чтобы исключить шум в консоли и сохранить критические ошибки активными.

Аудит №2024-10-19
- Внедрена централизованная система управления жизненным циклом `init()` с отслеживанием всех слушателей, таймеров, observer'ов и RAF, включая экспорт отчёта через `window.__TOOSMART_APP__.getResources()`.
- Реализована корректная переинициализация и автоматическое отключение при `pagehide/beforeunload/visibilitychange`, обеспечивающая очистку в SPA-сценариях и на устройствах без современных API.
- Добавлены универсальные обёртки для регистрации/снятия ресурсов (events, media queries, timeouts, intervals, observers), а также финальный сброс состояний меню, flyout и прогресс-виджета.

Аудит №2024-10-28
- Добавлены ранние проверки наличия DOM-структуры rail-меню перед запуском сценариев `openMenu`, `closeMenu`, `toggleMenu`, edge-gestures и свайпов, что устраняет ошибки, отмеченные в аудите №2024-09-17.
- Усилена защита `initMenuLinks` от некорректных якорей и отсутствующих секций, чтобы сохранить стабильность жизненного цикла, зафиксированную в аудите №2024-10-19.

Аудит №2024-11-06
- Проанализирована комбинация CSS `scroll-behavior: smooth` и пользовательских вызовов `scrollIntoView`, зафиксированы UX-ожидания по плавной прокрутке и обновлению истории.
- Добавлена безопасная синхронизация hash через History API в обработчиках ссылок меню при сохранении fallback на кастомный smooth scroll.
- Проведена ручная проверка переходов и кнопки «Назад» в десктопных браузерах; воспроизведён ожидаемый сценарий для Safari iOS 15 по спецификации.

Аудит №2024-11-15
- Перенесены обработчики свайпов меню с `document` на `body`, чтобы исключить глобальное перехватывание жестов и сохранить UX на мобильных и тачпадах.
- Добавлена автоматическая очистка слушателей через `AbortController` с откатом для старых браузеров и расширенный лог опций, включая `passive` и `signal`.
- Выполнена ревизия сценариев свайпов для iOS 15, Android и десктопных тачпадов: подтверждено сохранение логики открытия/закрытия меню и карусели.

Аудит №2024-11-24
- Доработан auto-hide header/dock: добавлен контроллер режима и подавления, синхронизированный с `data-mode` и состоянием меню для мобильных и планшетов.
- Включен сохраненный disposer scroll-listener с fallback на `AbortController`, интегрированный в общую очистку жизненного цикла.
- Проведена регрессия плавности появления/скрытия на iOS 15 и Android; подтверждено отсутствие побочных эффектов в desktop-режимах.

Аудит №2024-12-03
- Проанализирована структура контейнеров чтения: введен детектор основного блока и скролл-контекста с фиксацией источника в атрибутах прогресс-виджета.
- Добавлены guard-проверки на `.text-box` и fallback-логика, включая предупреждения и удаление виджета при демонтаже в резервных контейнерах.
- Реализован полифилл отслеживания `menu-open` без `MutationObserver` и расширенная очистка через `destroy()`, закрывающая все таймеры, observer'ы и обработчики.

Аудит №2024-12-11
- Сокращена задержка CSS-переезда прогресс-виджета в центр мобильного режима, чтобы ускорить отзывчивость без изменения основной анимации.
- Перенесено включение `is-positioned-relative` на двойной `requestAnimationFrame` после `transitionend` с укороченным fallback, что убирает рывки позиционирования в Safari iOS 15 и старых десктопных браузерах.

Аудит №2024-12-20
- Зафиксирована единая точка захвата и переиспользования оригинального `window.setActiveSection` с локальным диспетчером и журналом событий, чтобы исключить каскадные обёртки при переинициализации и выявлять внешние переопределения.
- Добавлены трассировки и экспорт диагностики flyout (инициализации, вызовы `setActiveSection`, состояние моста) через `window.__TOOSMART_APP__.getFlyoutDiagnostics()` для аудита сторонних интеграций.
- Усилен сброс flyout при отключении режимов desktop/desktop-wide с гарантированным демонтажем слушателя `setActiveSection`, предотвращающим протечки между режимами и повторными инициализациями.

Аудит №2024-12-27
- Перепроектированы сценарии запуска и паузы карусели рекомендаций: введен реестр причин остановки, блокирующий повторный запуск во время ховеров и жестов, с ручным перезапуском только после снятия всех триггеров.
- Обновлены обработчики `mouseenter/leave`, `touchstart/end/cancel` и свайпов для явного управления autoplay и предотвращения конфликтов таймера с пользовательскими действиями на десктопах и iOS 15.
- Вынесена общая функция очистки карусели, возвращаемая из `initStackCarousel()` и зарегистрированная в жизненном цикле, чтобы гарантировать остановку интервала и удаление слушателей при демонтаже.

Аудит №2025-01-08
- Включен санитайзер DOMPurify в пайплайн `build.js` с явным allowlist тегов и атрибутов, чтобы защитить публикации от XSS без потери допустимой разметки.
- Добавлен резервный регекс-санитайзер для окружений без DOMPurify и журналирование деградации, чтобы старые браузеры и инструменты сборки получали безопасный HTML без сбоев.
- Пересобраны примерные статьи (включая восстановление `advanced.md`) и проверено, что итоговые страницы сохраняют структуру заголовков и фигуры при генерации.
- Введен `source/config.json` с фиксированным порядком статей и пояснениями в README, чтобы связка «Далее» и локализованные заголовки оставались консистентными.

Аудит №2025-01-19
- Проанализированы сценарии запуска, остановки и перезапуска карусели, подтверждена корректная реакция на клики, hover и touch-события по UX-спецификации.
- Добавлена идемпотентная очистка карусели с отменой интервала и снятием всех слушателей при любом пути завершения жизненного цикла.
- Интегрирована очистка карусели в общий `init()` cleanup, чтобы гарантировать остановку autoplay перед глобальным сбросом состояний.

Аудит №2025-02-09
- Внедрен облегченный контроллер состояния меню, управляющий `menu-open` и `aria-expanded` для всех триггеров из единой точки без изменения UX.
- Обновлены сценарии `openMenu/closeMenu`, смены режима и сброса жизненного цикла для работы через контроллер и синхронизации фокуса.
- Проведена регрессия навигации и доступности (клавиатура, Screen Reader) на десктопах и iOS 15; подтверждена стабильность жестов и Escape.

Аудит №2025-02-23
- Проанализированы функции `handleModeUpdate`, `updateMode`, `scheduleLayoutMetricsUpdate` и `updateLayoutMetrics`, чтобы зафиксировать зависимость от визуальных габаритов visual viewport.
- Добавлены подписки на `visualViewport.resize/scroll` с диагностикой поддержки и автоматической интеграцией в существующий lifecycle cleanup.
- Протестированы сценарии появления виртуальной клавиатуры на iOS 15 и масштабирование в десктопных браузерах: подтверждено обновление режимов и layout metrics без расхождений.
