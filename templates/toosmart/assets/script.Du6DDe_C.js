import{i as Nn}from"./legal-modals.B2Gw208J.js";const ke=typeof document<"u"?document:null,ft=ke?ke.documentElement:null,Xe={MOBILE_MAX:767,TABLET_MIN:768,TABLET_MAX:899,DESKTOP_MIN:900,DESKTOP_MAX:1279,DESKTOP_WIDE_MIN:1280};function Ee(e){return typeof e=="number"&&isFinite(e)}function dn(e,t){if(!e||typeof e.matchMedia!="function")return!1;try{return e.matchMedia(t).matches}catch{return!1}}function fn(e){const t=e||window,n=dn(t,"(any-pointer: coarse)"),i=t&&t.navigator?t.navigator:null,o=(i&&typeof i.maxTouchPoints=="number"?i.maxTouchPoints:0)>0;return n||o?"touch":"pointer"}function Jt(e,t){return t==="touch"?e<Xe.TABLET_MIN?"mobile":e<Xe.DESKTOP_MIN?"tablet":"desktop":e<Xe.TABLET_MIN?"mobile":e<Xe.DESKTOP_MIN?"tablet":e<Xe.DESKTOP_WIDE_MIN?"desktop":"desktop-wide"}function pn(e,t){const n=e||window,i=t||ft;return[{source:"visualViewportWidth",value:n&&n.visualViewport&&Ee(n.visualViewport.width)&&n.visualViewport.width>0?n.visualViewport.width:null},{source:"rootClientWidth",value:i&&Ee(i.clientWidth)&&i.clientWidth>0?i.clientWidth:null},{source:"innerWidth",value:n&&Ee(n.innerWidth)&&n.innerWidth>0?n.innerWidth:null},{source:"outerWidth",value:n&&Ee(n.outerWidth)&&n.outerWidth>0?n.outerWidth:null},{source:"screenWidth",value:n&&n.screen&&Ee(n.screen.width)&&n.screen.width>0?n.screen.width:null}]}function mn(e,t,n){const i=e||window,o=pn(i,t||ft);for(let a=0;a<o.length;a+=1){const c=o[a],u=c?c.value:null;if(Ee(u)&&u>0)return Jt(u,n)}const l=[["mobile","(max-width: 767px)"],["tablet","(min-width: 768px) and (max-width: 899px)"],["desktop","(min-width: 900px) and (max-width: 1279px)"],["desktop-wide","(min-width: 1280px)"]];for(let a=0;a<l.length;a+=1){const c=l[a];if(dn(i,c[1]))return c[0]}return"desktop"}function Pn(e,t){const n=e||window,i=t||ke,r=i&&i.documentElement?i.documentElement:ft;let o=null;n&&Ee(n.innerWidth)&&n.innerWidth>0?o=n.innerWidth:r&&Ee(r.clientWidth)&&r.clientWidth>0&&(o=r.clientWidth);const l=fn(n);let a="desktop";return Ee(o)&&o>0?a=Jt(o,l):a=mn(n,r,l),{mode:a,input:l}}function Un(e,t){const n=e||ke;return!n||!n.body?!1:(n.body.dataset.mode=t,!0)}function Hn(e,t){const n=e||ke;if(!n||!n.body||!t)return!1;const i=n.body;return t.mode&&(i.dataset.mode=t.mode),t.input&&(i.dataset.input=t.input),!0}const hn={BREAKPOINTS:Xe,classifyMode:(e,t)=>Jt(e,t),detectInput:e=>fn(e||window),detectMode:(e,t,n)=>mn(e||window,t||ft,n),getWidthSources:(e,t)=>pn(e||window,t||ft),detectInitialState:(e,t)=>Pn(e||window,t||ke),applyModeToBody:(e,t)=>Un(e||ke,t),applyStateToBody:(e,t)=>Hn(e||ke,t)};typeof window<"u"&&(window.ModeUtils=hn);(function(){const e=window.location.pathname;(e==="/"||e==="/index.html")&&document.cookie.split(";").some(t=>t.trim().startsWith("premium_access=1"))&&window.location.replace("/premium/")})();const pt=window.ModeUtils||hn;if(!pt)throw new Error("ModeUtils module is required for responsive mode detection.");const X=document.documentElement,h=document.body,zn=typeof window.__INITIAL_MODE__=="string",Rn=typeof window.__INITIAL_INPUT__=="string",gn=qn(h),Yn=gn.mode,Gt=gn.input;zn&&delete window.__INITIAL_MODE__;Rn&&delete window.__INITIAL_INPUT__;let R=null,de=null,K=null,$=null,rt=null,J=null,je=null,rn=null,N=null,T=null,q=[],st=null,ce=null,Ve=!1,E=h.dataset.mode||Yn||"desktop",ae=h.dataset.input||Gt||"pointer";!h.dataset.input&&typeof Gt=="string"&&(h.dataset.input=Gt);var un;let Ct=((un=q[0])==null?void 0:un.id)??null,me=null,at=null,Tt=null,xt=()=>{},Vt=null,V=null,ye=[],j=null,Oe=[],lt=null,Pe={suppress:()=>{},setMode:()=>{},detach:()=>{}},Be=!1,mt=!1,we=null,ve=null,he=!1;const Ue=$n({body:h,handles:[K,J]});function xe(e){if(e)for(;e.firstChild;)e.removeChild(e.firstChild)}function Ze(){return!!(R||$)}function qn(e){const{body:t}=document,n=e||t,i=typeof window.__INITIAL_MODE__=="string"?window.__INITIAL_MODE__:n==null?void 0:n.dataset.mode,r=typeof window.__INITIAL_INPUT__=="string"?window.__INITIAL_INPUT__:n==null?void 0:n.dataset.input;if(!(!i||!r))return{mode:i,input:r};const l=pt.detectInitialState(window,document),a=i||l.mode,c=r||l.input;return n&&(n.dataset.mode||(n.dataset.mode=a),n.dataset.input||(n.dataset.input=c)),{mode:a,input:c}}function $n({body:e,handles:t=[]}={}){const n=t.filter(d=>d instanceof HTMLElement),i=new Set;let r=!!(e!=null&&e.classList.contains("menu-open"));function o(d){return d?!!(d.offsetWidth||d.offsetHeight||d.getClientRects().length):!1}function l(){const d=String(r);for(const y of n)y&&(o(y)?y.setAttribute("aria-expanded",d):y.removeAttribute("aria-expanded"))}function a(){e&&e.classList.toggle("menu-open",r),l()}function c(){for(const d of i)try{d(r)}catch(y){console.error("[MenuState] Listener failed",y)}}function u(d,{silent:y=!1}={}){const F=!!d;return r!==F?(r=F,a(),y||c()):a(),r}function w(d){return typeof d!="function"?()=>{}:(i.add(d),()=>{i.delete(d)})}function g({silent:d=!1}={}){const y=!!(e!=null&&e.classList.contains("menu-open")),F=y!==r;return r=y,a(),F&&!d&&c(),r}return a(),{isOpen:()=>r,setOpen:u,open:d=>u(!0,d),close:d=>u(!1,d),toggle:d=>u(!r,d),subscribe:w,sync:g,refreshHandles:l}}const Xt=window.DEBUG_MODE_DETECTION||!1,Gn=typeof window.DEBUG_FLYOUT=="boolean"?window.DEBUG_FLYOUT:!1,St=typeof window.DEBUG_FLYOUT_LOGGER=="object"&&window.DEBUG_FLYOUT_LOGGER?window.DEBUG_FLYOUT_LOGGER:console,Vn=25,yn=[],wn=[];let te=null,jt=!1,ct=null,Ft=null;const Ae=new Map;let Xn=0,Yt=0;function re(...e){Gn&&typeof(St==null?void 0:St.log)=="function"&&St.log(...e)}function vn(e=5){try{throw new Error("stack-capture")}catch(t){return t!=null&&t.stack?t.stack.split(`
`).slice(2,2+e).map(n=>n.trim()):void 0}}function bn(e,t){for(e.push(t);e.length>Vn;)e.shift();return t}function jn(e={}){const t=bn(yn,{timestamp:Date.now(),mode:E,sections:q.length,...e,stack:vn(6)});return re("[FLYOUT] init trace",t),t}function se(e,t={}){const n=bn(wn,{type:e,timestamp:Date.now(),...t,stack:vn(6)});return re("[FLYOUT] setActiveSection event",n),n}function Kn(e){const t=typeof window.setActiveSection=="function"?window.setActiveSection:null;jt||(jt=!0,ct=t,se("capture-original",{reason:e,hasOriginal:!!t,name:(t==null?void 0:t.name)||null})),t&&t!==te&&t!==ct&&(Ft=t,se("external-override-detected",{reason:e,name:(t==null?void 0:t.name)||null}));const n=Ft||ct||Nt;if(te||(te=function(r){if(typeof te.base=="function")try{te.base(r)}catch(o){console.error("[FLYOUT] base setActiveSection invocation failed",o)}se("invoke",{id:r});for(const o of Ae.values())try{o.callback(r),se("listener-invoke",{label:o.label,id:r})}catch(l){console.error("[FLYOUT] setActiveSection listener failed",{label:o.label,error:l})}}),te.base=n,window.setActiveSection!==te)try{window.setActiveSection=te,se("bridge-apply",{reason:e,baseName:(n==null?void 0:n.name)||null})}catch(i){console.error("[FLYOUT] Failed to apply setActiveSection bridge",i),se("bridge-apply-error",{reason:e,error:(i==null?void 0:i.message)||String(i)})}else se("bridge-refresh",{reason:e,baseName:(n==null?void 0:n.name)||null});return n}function en(e){if(te){if(Ae.size>0){se("bridge-retained",{reason:e,listeners:Ae.size});return}if(window.setActiveSection===te){const t=Ft||ct;if(t)window.setActiveSection=t;else try{delete window.setActiveSection}catch{window.setActiveSection=void 0}se("bridge-release",{reason:e,restored:!!t})}else se("bridge-release-skipped",{reason:e,replaced:!0});Ae.size===0&&(te=null)}}function Zn(e,t){if(typeof t!="function")return()=>{};Kn(`listener:${e}`);const n=++Xn;return Ae.set(n,{label:e,callback:t}),se("listener-register",{label:e,id:n}),()=>{Ae.has(n)&&(Ae.delete(n),se("listener-unregister",{label:e,id:n}),en(`listener:${e}:dispose`))}}function Qn(){return{hasBridge:!!te,listeners:Array.from(Ae.values()).map(e=>e.label),capturedOriginal:jt,hasOriginal:!!ct,hasExternal:!!Ft}}let Se=null,be=null,_t=null,Dt=null,Lt=!1;function Jn(){const e=[".text-box",".article__content","main article","article",".article",".content","#content","main"];for(const t of e){const n=document.querySelector(t);if(n)return{element:n,selector:t,matchedTextBox:t===".text-box"}}return{element:document.body,selector:"body",matchedTextBox:!1}}function eo(e){if(!e)return"visible";try{const t=getComputedStyle(e);return t.overflowY||t.overflow||"visible"}catch(t){return console.warn("[ProgressWidget] Failed to read overflowY",{error:t,element:e}),"visible"}}function to(e){let t=e;for(;t&&t!==document.body&&t!==document.documentElement;){const i=eo(t);if((i==="auto"||i==="scroll")&&t.scrollHeight>t.clientHeight+1)return{element:t,mode:"element"};t=t.parentElement}return{element:document.scrollingElement||document.documentElement||window,mode:"document"}}const ut="__TOOSMART_APP__";function no(){const e=new Map,t=[];let n=0;const i=()=>typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now();function r(a={}){const c=++n,u={id:c,createdAt:i(),disposedAt:null,meta:{...a}};e.set(c,u);let w=!1;function g(y){w||(w=!0,y&&typeof y=="object"&&(u.meta={...u.meta,...y}),u.disposedAt=i(),e.delete(c),t.push({...u}),t.length>40&&t.shift())}function d(y){!y||typeof y!="object"||(u.meta={...u.meta,...y})}return{id:c,release:g,updateMeta:d,get meta(){return u.meta}}}function o(){const a=Array.from(e.values()).map(u=>({id:u.id,createdAt:u.createdAt,meta:{...u.meta}})),c=a.reduce((u,w)=>{var d;const g=((d=w.meta)==null?void 0:d.kind)||"unknown";return u[g]=(u[g]||0)+1,u},{});return{total:a.length,byKind:c,resources:a,recentDisposals:t.slice(-10),timestamp:i()}}function l(a="Active resources"){const c=o(),u=i();if(console.groupCollapsed(`[Diagnostics] ${a}: ${c.total}`),c.resources.length){const w=c.resources.map(g=>{const d=g.meta||{};return{id:g.id,kind:d.kind??"unknown",label:d.label??d.event??d.target??"-",lifecycle:d.lifecycle??"n/a",ageMs:Math.round(u-g.createdAt)}});console.table(w)}else console.log("No active resources.");if(console.log("[Diagnostics] Count by kind",c.byKind),c.recentDisposals.length){const w=c.recentDisposals.map(g=>{var d,y;return{id:g.id,kind:((d=g.meta)==null?void 0:d.kind)??"unknown",lifecycle:((y=g.meta)==null?void 0:y.lifecycle)??"n/a",releasedAgoMs:g.disposedAt?Math.round(u-g.disposedAt):null}});console.log("[Diagnostics] Recent disposals",w)}return console.groupEnd(),c}return{register:r,snapshot:o,logSnapshot:l,getActiveCount(){return e.size}}}const He=no();function oo(e){const t=[];function n(o,l={}){if(typeof o!="function")return()=>{};const a={meta:{label:e,...l},active:!0,dispose:null};return a.dispose=()=>{if(a.active){a.active=!1;try{o()}catch(c){console.error("[Lifecycle] Failed to dispose resource",{label:e,meta:a.meta,error:c})}}},t.push(a),()=>a.dispose()}function i(){for(let o=t.length-1;o>=0;o-=1)t[o].dispose()}function r(){return t.map(o=>({...o.meta,active:o.active}))}return{track:n,disposeAll:i,report:r,label:e}}let En=null;function io(){return En}function Sn(e){En=e}function C(e){return e?e===window?"window":e===document?"document":e===document.documentElement?"documentElement":e===document.body?"body":e instanceof Element?e.id?`#${e.id}`:e.classList&&e.classList.length?`${e.tagName.toLowerCase()}.${Array.from(e.classList).join(".")}`:e.tagName?e.tagName.toLowerCase():"element":String(e):"unknown"}function ro(e){if(e!==void 0){if(e===null)return null;if(typeof e=="boolean")return{capture:e};if(typeof e=="object"){const t={};return"capture"in e&&(t.capture=!!e.capture),"once"in e&&(t.once=!!e.once),"passive"in e&&(t.passive=!!e.passive),"signal"in e&&(t.signal=!0),t}return e}}function G(e,t){if(typeof e!="function")return()=>{};const n=io(),i=t&&typeof t=="object"?t:{},r=He.register({...i,lifecycle:(n==null?void 0:n.label)??"detached"});function o(l){try{e==null||e()}catch(a){console.error(`[Lifecycle] Disposer failed${l?` (${l})`:""}`,{meta:t,error:a})}finally{r.release()}}return n?n.track(()=>o(),{...i,resourceId:r.id}):()=>o("outside lifecycle")}function S(e,t,n,i,r={}){if(!e||typeof e.addEventListener!="function")return()=>{};let o=null,l=i,a=!1;if(typeof AbortController=="function"){o=new AbortController,l=so(i,o.signal);try{e.addEventListener(t,n,l),a=!0}catch{o=null,l=i}}return a||e.addEventListener(t,n,i),G(()=>{if(o){o.abort(),o=null;return}e&&typeof e.removeEventListener=="function"&&e.removeEventListener(t,n,i)},{kind:"event",event:t,target:C(e),options:ro(l??i),...r})}function so(e,t){return t?e===void 0?{signal:t}:typeof e=="boolean"?{capture:e,signal:t}:e&&typeof e=="object"?"signal"in e?e:{...e,signal:t}:e:e}function qt(e,t,n={}){if(!e||typeof t!="function")return()=>{};let i=null;return typeof e.addEventListener=="function"?(e.addEventListener("change",t),i=()=>{typeof e.removeEventListener=="function"&&e.removeEventListener("change",t)}):typeof e.addListener=="function"&&(e.addListener(t),i=()=>{typeof e.removeListener=="function"&&e.removeListener(t)}),i?G(()=>{i(),i=null},{kind:"media-query",target:"(media query)",...n}):()=>{}}function ao(e,t,n={}){let i=!1;const r=()=>{i||(i=!0,e())},o=window.setTimeout(r,t);return G(()=>{i||(i=!0,window.clearTimeout(o))},{kind:"timeout",delay:t,...n})}function Ln(e,t,n={}){const i=window.setInterval(e,t);let r=!1;return G(()=>{r||(r=!0,window.clearInterval(i))},{kind:"interval",delay:t,...n})}function kn(e,t={}){return!e||typeof e.disconnect!="function"?()=>{}:G(()=>{e.disconnect()},{kind:"observer",...t})}function lo(e={}){const t=new Map,n=new Map;let i=new WeakSet,r=null;const o=typeof window<"u"&&typeof window.IntersectionObserver=="function";let l=!1;const a=Array.isArray(e.threshold)||typeof e.threshold=="number"?e.threshold:.2,c=typeof e.rootMargin=="string"?e.rootMargin:"0px 0px -10% 0px";function u(L){return typeof L!="string"||!L.trim()?[]:L.split(/[\s,]+/).map(M=>M.trim()).filter(Boolean)}function w(){return o?r||(r=new IntersectionObserver(g,{threshold:a,rootMargin:c}),r):null}function g(L){var M,B,x;for(const k of L){const H=u((B=(M=k.target)==null?void 0:M.dataset)==null?void 0:B.lazy);if(H.length===0)continue;let z=n.get(k.target);z||(z=new Map,n.set(k.target,z));for(const I of H){const P=t.get(I);if(!P)continue;let _=z.get(I);if(_||(_={active:!1,cleanup:null},z.set(I,_)),k.isIntersecting){if(_.active)continue;_.active=!0;let Y=null;try{Y=(x=P.onEnter)==null?void 0:x.call(P,{id:I,element:k.target,entry:k})}catch(U){console.error("[LazyFeatures] Activation failed",{id:I,error:U})}_.cleanup=typeof Y=="function"?Y:null}else if(_.active){if(P!=null&&P.sticky)continue;if(_.active=!1,typeof P.onExit=="function")try{P.onExit({id:I,element:k.target,entry:k,cleanup:_.cleanup})}catch(Y){console.error("[LazyFeatures] onExit handler failed",{id:I,error:Y})}if(typeof _.cleanup=="function")try{_.cleanup()}catch(Y){console.error("[LazyFeatures] Cleanup failed",{id:I,error:Y})}z.delete(I),z.size===0&&n.delete(k.target),_.cleanup=null}}}}function d(L){var x,k;const M=u((x=L==null?void 0:L.dataset)==null?void 0:x.lazy);if(M.length===0)return;l||(l=!0,console.warn("[LazyFeatures] IntersectionObserver is not supported ‚Äî activating features immediately"));let B=n.get(L);B||(B=new Map,n.set(L,B));for(const H of M){const z=t.get(H);if(!z)continue;const I=B.get(H);if(I!=null&&I.active)continue;let P=null;try{P=(k=z.onEnter)==null?void 0:k.call(z,{id:H,element:L,entry:null})}catch(_){console.error("[LazyFeatures] Activation failed (fallback)",{id:H,error:_})}B.set(H,{active:!0,cleanup:typeof P=="function"?P:null})}}function y(L){if(!(L instanceof Element)||i.has(L))return;i.add(L);const M=w();if(M){M.observe(L);return}d(L)}function F(L,M={}){var B;if(!L)return()=>{};if(t.set(L,M),!o)for(const x of n.keys())u((B=x==null?void 0:x.dataset)==null?void 0:B.lazy).includes(L)&&d(x);return()=>{t.delete(L)}}function O(L=document){!L||typeof L.querySelectorAll!="function"||L.querySelectorAll("[data-lazy]").forEach(M=>y(M))}function Z(){r&&r.disconnect();for(const[L,M]of n.entries())for(const[B,x]of M.entries())if(x.active&&typeof x.cleanup=="function")try{x.cleanup()}catch(k){console.error("[LazyFeatures] Cleanup during disconnect failed",{id:B,error:k})}n.clear(),i=new WeakSet,r=null}return{register:F,observeAll:O,observeElement:y,disconnect:Z}}const ht=lo({threshold:[0,.2],rootMargin:"0px 0px -10% 0px"});function co(e){const t=document.createElement("div");t.dataset.devOverlay="resource-metrics",Object.assign(t.style,{position:"fixed",top:"16px",right:"16px",zIndex:"9999",background:"rgba(0, 0, 0, 0.75)",color:"#fff",padding:"8px 12px",borderRadius:"8px",fontFamily:'SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace',fontSize:"12px",lineHeight:"1.4",pointerEvents:"none",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.35)",minWidth:"160px",whiteSpace:"nowrap",opacity:"0",transition:"opacity 120ms ease-in-out"}),t.hidden=!0;const n=document.createElement("div"),i=document.createElement("div"),r=document.createElement("div");t.appendChild(n),t.appendChild(i),t.appendChild(r);let o=!1,l=!1,a=null;const c=()=>typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now();let u=c(),w=u,g=0,d=0,y=0;const F=1e3/60;function O(){if(o)return;const k=()=>{!document.body||o||(document.body.appendChild(t),o=!0)};document.body?k():document.addEventListener("DOMContentLoaded",k,{once:!0})}function Z(k){const H=k-u;u=k,g+=1,y=y?y*.85+H*.15:H,k-w>=500&&(d=Math.round(g*1e3/(k-w)),g=0,w=k);const z=Math.min(100,Math.max(0,y/F*100)),I=e==null?void 0:e.snapshot(),P=(I==null?void 0:I.total)??0;if(n.textContent=`FPS: ${String(d).padStart(2,"0")}`,i.textContent=`Frame: ${y.toFixed(1)}ms (${z.toFixed(0)}% load)`,I){const _=Object.entries(I.byKind||{}).map(([Y,U])=>`${Y}:${U}`).join(" ");r.textContent=`Resources: ${P}${_?` [${_}]`:""}`}else r.textContent="Resources: n/a"}function L(k){Z(k),l&&(a=requestAnimationFrame(L))}function M(){l||(O(),l=!0,t.hidden=!1,t.style.opacity="1",u=c(),w=u,g=0,a=requestAnimationFrame(L))}function B(){l&&(l=!1,a!==null&&(cancelAnimationFrame(a),a=null),t.style.opacity="0",t.hidden=!0)}function x(){return l?B():M(),l}return{start:M,stop:B,toggle:x,isActive:()=>l,element:t}}function Ie(e){const t=Number.parseFloat(e);return Number.isFinite(t)?t:0}function An(){const e=pt.detectInput(window);return window.DEBUG_MODE_DETECTION&&console.log("[DEBUG] detectInput():",{result:e}),e}function Tn(e){const t=pt.getWidthSources(window,X),n=pt.detectMode(window,X,e);if(window.DEBUG_MODE_DETECTION){let i=null;if(Array.isArray(t)){for(const o of t)if(o&&typeof o.value=="number"&&Number.isFinite(o.value)&&o.value>0){i=o;break}}const r={inputType:e,result:n};i&&(r.width=i.value,r.widthSource=i.source),console.log("[DEBUG] detectMode():",r)}return n}function sn(e=ce){const t=(de==null?void 0:de.offsetHeight)??0,n=Math.max(0,t+16);X.style.setProperty("--stack-top",`${n}px`);const i=Math.max(0,t+24);X.style.setProperty("--section-scroll-margin",`${i}px`);const r=e instanceof HTMLElement?e:ce;if(!(r instanceof HTMLElement)){ce=null;return}ce=r;const o=window.getComputedStyle(r);let l=r.offsetHeight;o.position==="sticky"?l+=Ie(o.bottom):l+=Ie(o.marginBottom),h.dataset.mode==="mobile"?xn(r):(r.style.removeProperty("--pw-float-left"),r.style.removeProperty("--pw-float-bottom")),l=Math.max(0,Math.round(l)),X.style.setProperty("--pw-footprint",`${l}px`),uo()}let $t=!1,an=null;function uo(){clearTimeout(an),an=setTimeout(()=>{fo()},100)}function fo(){const e=document.querySelector(".stack");if(!e||$t)return;if(!(E==="desktop"||E==="desktop-wide")){Ve&&(e.classList.remove("stack--inline"),Ve=!1);return}const n=document.querySelector(".text-box");if(!n)return;const i=document.documentElement.clientWidth,r=n.getBoundingClientRect(),o=i-r.right,l=window.getComputedStyle(e),a=Ie(l.minWidth)||220,c=20,u=10,w=80,g=a+c+u,d=Ve?g+w:g,y=o<d;console.log("[StackDebug]",{viewportWidth:i,textBoxRight:r.right,availableRight:o,minStackWidth:a,requiredSpace:g,threshold:d,shouldInline:y,lastStackInline:Ve}),y!==Ve&&(e.classList.toggle("stack--inline",y),Ve=y,$t=!0,setTimeout(()=>{$t=!1},250))}let kt=null;function xn(e){var a,c;if(!(e instanceof HTMLElement)||h.dataset.mode!=="mobile")return;const n=[J,K].filter(u=>u instanceof HTMLElement).find(u=>u.getClientRects().length>0&&u.offsetWidth>0);if(!n&&kt){e.style.setProperty("--pw-float-left",`${kt.left}px`),e.style.setProperty("--pw-float-bottom",`${kt.bottom}px`);return}if(!n)return;const i=window.innerWidth||((a=document.documentElement)==null?void 0:a.clientWidth)||0,r=window.innerHeight||((c=document.documentElement)==null?void 0:c.clientHeight)||0,o=n.getBoundingClientRect(),l=window.getComputedStyle(e);if(i>0&&o.width>0){const u=Math.max(e.offsetWidth||0,Ie(l.width)),w=Math.max(0,Math.min(o.left,i-u));e.style.setProperty("--pw-float-left",`${Math.round(w)}px`)}if(r>0){const w=o.top>0?Math.max(10,Math.round(r-o.top+10)):Math.max(10,Math.round(Ie(l.bottom))||10);e.style.setProperty("--pw-float-bottom",`${w}px`)}kt={left:Ie(e.style.getPropertyValue("--pw-float-left")),bottom:Ie(e.style.getPropertyValue("--pw-float-bottom"))}}function le({force:e=!1,modeChanged:t=!1,viewportChanged:n=!1,elementChanged:i=!1}={}){return!e&&!t&&!n&&!i?!1:(po(),!0)}function po(){if(!Be){sn(ce),Be=!0;return}Se===null&&(Se=requestAnimationFrame(()=>{Se=null,sn(ce)}))}function ln(e){return typeof e!="number"||!Number.isFinite(e)?null:Math.round(e*1e3)}function mo(e){if(!e)return!1;const t=ln(e.width),n=ln(e.height);return t===_t&&n===Dt?!1:(_t=t,Dt=n,!0)}function nt(e){const t=mo(e);return t&&(mt=!0),t}function ho(){if(typeof Pe.setMode=="function"){const e=E==="mobile"||E==="tablet";Pe.setMode(e)}}function Mn(){var l,a;const e=An(),t=Tn(e),n=E,i=ae,r=n!==t,o=i!==e;return!r&&!o?{modeChanged:r,inputChanged:o}:(E=t,ae=e,h.dataset.mode=t,h.dataset.input=e,ho(),window.DEBUG_MODE_DETECTION&&(r||o)&&console.log("[MODE CHANGE] üîÑ",{mode:{from:n,to:t},input:{from:i,to:e},viewport:{visualViewportWidth:(l=window.visualViewport)==null?void 0:l.width,rootClientWidth:X==null?void 0:X.clientWidth,innerWidth:window.innerWidth,outerWidth:window.outerWidth,screenWidth:(a=window.screen)==null?void 0:a.width}}),r&&(h.classList.remove("is-slid"),Ue.setOpen(!1,{silent:!0}),$&&($.removeAttribute("role"),$.removeAttribute("aria-modal")),Ot(),me&&document.body.contains(me)&&(me.focus({preventScroll:!0}),me=null),he&&(Cn(),Wt()),Kt(),In(),h.offsetHeight),Ue.refreshHandles(),tn(),{modeChanged:r,inputChanged:o})}function ze(){if(typeof xt=="function")try{xt()}catch(e){console.error("[Observer] Failed to dispose section observer",e)}xt=()=>{},Tt=null,Se!==null&&(cancelAnimationFrame(Se),Se=null)}function Cn(){if(!he){ze(),N&&(xe(N),N.hidden=!0);return}if(!N)return;xe(N);const e=(E==="desktop"||E==="desktop-wide")&&q.length>=1;if(N.hidden=!e,!e){ze();return}q.forEach(t=>{const n=document.createElement("button");n.type="button",n.className="dots-rail__dot",n.setAttribute("aria-label",t.dataset.section||t.id),n.addEventListener("click",()=>{t.scrollIntoView({behavior:"smooth",block:"start"})}),N.appendChild(n)}),Fn(),_n()}function Fn(){if(ze(),!("IntersectionObserver"in window)){console.warn("IntersectionObserver not supported, dots navigation may not update automatically");return}if(E!=="desktop"&&E!=="desktop-wide"||q.length<2)return;const e=(de==null?void 0:de.offsetHeight)??0;Tt=new IntersectionObserver(()=>{const t=go(),n=q[t];n&&Nt(n.id)},{root:null,threshold:[0,.25,.5,.75,1],rootMargin:`-${e}px 0px -35% 0px`}),xt=kn(Tt,{label:"section-progress",target:".text-section"}),q.forEach(t=>Tt.observe(t))}function Nt(e){!e||e===Ct||(Ct=e,_n())}function _n(){if(E!=="desktop"&&E!=="desktop-wide"||!N)return;N.querySelectorAll(".dots-rail__dot").forEach((t,n)=>{const i=q[n];if(!i)return;const r=i.id===Ct;t.setAttribute("aria-current",r?"true":"false")})}function go(){let e=0,t=Number.POSITIVE_INFINITY;const n=window.innerHeight||X.clientHeight,i=(de==null?void 0:de.offsetHeight)??0,r=Math.max(0,n-i),o=i+r*.35;return q.forEach((l,a)=>{const c=l.getBoundingClientRect();if(c.top<=o&&c.bottom>=o){e=a,t=-1;return}const u=c.top>o?c.top-o:o-c.bottom;u<t&&(t=u,e=a)}),e}function Dn(e){return e?Array.from(e.querySelectorAll('a[href], button:not([disabled]), textarea, input, select, [tabindex]:not([tabindex="-1"])')):[]}function yo(e){if(!(E!=="desktop"&&h.classList.contains("menu-open"))||e.key!=="Tab")return;const n=Dn(R);if(n.length===0){e.preventDefault();return}const i=n[0],r=n[n.length-1];e.shiftKey?document.activeElement===i&&(e.preventDefault(),r.focus()):document.activeElement===r&&(e.preventDefault(),i.focus())}function wo(){at||(at=S(document,"keydown",yo,void 0,{module:"menu.focusTrap"}))}function Ot(){typeof at=="function"&&(at(),at=null)}function It({focusOrigin:e=K}={}){if(!Ze())return!1;if((E==="mobile"||E==="tablet")&&(h.removeAttribute("data-scroll"),Pe.suppress(!0)),h.classList.remove("is-slid"),Ue.setOpen(!0),(E==="mobile"||E==="tablet")&&requestAnimationFrame(()=>{h.removeAttribute("data-scroll")}),me=document.activeElement instanceof HTMLElement?document.activeElement:null,E!=="desktop"){$&&($.setAttribute("role","dialog"),$.setAttribute("aria-modal","true"));let n=Dn(R).find(i=>i!==e);!n&&$ instanceof HTMLElement&&(n=$),n&&typeof n.focus=="function"&&requestAnimationFrame(()=>n.focus({preventScroll:!0})),wo()}return tn(),!0}function Ne({focusOrigin:e=K}={}){return Ze()?(Ue.setOpen(!1),h.classList.remove("is-slid"),$&&($.removeAttribute("role"),$.removeAttribute("aria-modal")),Ot(),tn(),(E==="mobile"||E==="tablet")&&Pe.suppress(!1),me?(me.focus({preventScroll:!0}),me=null):e&&e instanceof HTMLElement&&e.focus({preventScroll:!0}),!0):!1}function cn(e){return Ze()?Ue.isOpen()?Ne({focusOrigin:e}):It({focusOrigin:e}):!1}function tn(){const e=h.classList.contains("menu-open"),t=h.dataset.lock==="scroll";e&&!t?(Yt=window.scrollY||X.scrollTop||0,h.dataset.lock="scroll",X.dataset.lock="scroll",h.style.position="fixed",h.style.inset="0",h.style.width="100%",h.style.top=`-${Yt}px`):!e&&t&&(delete h.dataset.lock,delete X.dataset.lock,h.style.position="",h.style.inset="",h.style.width="",h.style.top="",typeof window.scrollTo=="function"&&window.scrollTo(0,Yt))}function vo(){he&&Cn()}function On(e){if(!e)return;if("scrollBehavior"in document.documentElement.style){e.scrollIntoView({behavior:"smooth",block:"start"});return}const t=e.getBoundingClientRect().top+window.pageYOffset,n=window.pageYOffset,i=t-n,r=600;let o=null;function l(a){o===null&&(o=a);const c=a-o,u=Math.min(c/r,1),w=u<.5?2*u*u:1-Math.pow(-2*u+2,2)/2;window.scrollTo(0,n+i*w),c<r&&requestAnimationFrame(l)}requestAnimationFrame(l)}function bo(e){if(typeof e!="string")return;const t=e.trim();if(!t||t==="#")return;const n=t.startsWith("#")?t:`#${t}`;if(window.location.hash!==n){try{if(typeof history.pushState=="function"){history.pushState(null,"",n);return}}catch(i){console.warn("[MenuLinks] Failed to pushState for hash update",i)}window.location.hash=n}}function We(){if(ye.length!==0){for(const e of ye)try{e()}catch(t){console.error("[FLYOUT] Failed to dispose listener",t)}ye=[],typeof V=="function"&&(V(),V=null)}}function Wt(){if(!he){if(typeof j=="function")try{j()}catch(a){console.error("[FLYOUT] Failed to dispose setActiveSection listener during idle state",a)}j=null,We(),T&&(xe(T),T.setAttribute("hidden",""),T.classList.add("is-hidden")),en("dotsFlyout.lazy-inactive");return}if(re("[FLYOUT] initDotsFlyout START",{dotsRail:!!N,dotFlyout:!!T,currentMode:E,sectionsLength:q.length}),jn({mode:E,sections:q.length}),q.length=0,q.push(...Array.from(document.querySelectorAll(".text-section"))),!N||!T){console.error("[FLYOUT] ERROR: dotsRail or dotFlyout not found!",{dotsRail:!!N,dotFlyout:!!T});return}const e=(E==="desktop"||E==="desktop-wide")&&q.length>=1;if(re("[FLYOUT] Should enable?",{currentMode:E,shouldEnable:e,sectionsCount:q.length,isDesktopOrWide:E==="desktop"||E==="desktop-wide",hasEnoughSections:q.length>=2}),!e){if(re("[FLYOUT] Disabled - hiding"),T.setAttribute("hidden",""),T.classList.add("is-hidden"),We(),typeof j=="function"){try{j()}catch(a){console.error("[FLYOUT] Failed to detach setActiveSection listener while disabling",a)}j=null}return}function t(){xe(T);let a=0;q.forEach((c,u)=>{var y;const w=c.querySelector("h2"),g=w&&((y=w.textContent)==null?void 0:y.trim())||"";if(!g)return;c.id||(c.id=`section-${u+1}`);const d=document.createElement("button");d.type="button",d.className="dot-flyout__item",d.dataset.index=String(a),d.dataset.sectionId=c.id,d.textContent=g,d.setAttribute("aria-controls",c.id),T.appendChild(d),a+=1}),re("[FLYOUT] Built menu with",a,"items")}function n(){re("[FLYOUT] ‚≠ê showFlyout called!"),typeof V=="function"&&(V(),V=null),T.removeAttribute("hidden"),T.classList.remove("is-hidden"),re("[FLYOUT] hidden attribute removed and is-hidden class removed")}function i(){re("[FLYOUT] hideFlyout called"),typeof V=="function"&&(V(),V=null),V=ao(()=>{T.setAttribute("hidden",""),T.classList.add("is-hidden"),V=null,re("[FLYOUT] hidden attribute set and is-hidden class added")},120,{module:"dotsFlyout",detail:"hide delay"})}function r(a){const c=a.target.closest(".dot-flyout__item");if(!c)return;const u=c.dataset.sectionId,w=document.getElementById(u);w&&(On(w),Nt(u))}function o(a){if(T.hasAttribute("hidden")||T.classList.contains("is-hidden"))return;const c=Array.from(T.querySelectorAll(".dot-flyout__item"));if(c.length===0)return;const u=document.activeElement,w=c.indexOf(u);if(a.key==="ArrowDown"){a.preventDefault();const g=w<c.length-1?w+1:0;c[g].focus()}else if(a.key==="ArrowUp"){a.preventDefault();const g=w>0?w-1:c.length-1;c[g].focus()}else if(a.key==="Escape"&&(a.preventDefault(),i(),N)){const g=N.querySelector(".dots-rail__dot");g&&g.focus()}}function l(){if(T.hasAttribute("hidden")||T.classList.contains("is-hidden"))return;T.querySelectorAll(".dot-flyout__item").forEach(c=>{const u=c.dataset.sectionId===Ct;c.classList.toggle("is-active",u),c.setAttribute("aria-current",u?"true":"false")})}We(),t(),ye.push(S(N,"mouseenter",n,void 0,{module:"dotsFlyout",target:C(N)})),ye.push(S(N,"mouseleave",i,void 0,{module:"dotsFlyout",target:C(N)})),ye.push(S(T,"mouseenter",n,void 0,{module:"dotsFlyout",target:C(T)})),ye.push(S(T,"mouseleave",i,void 0,{module:"dotsFlyout",target:C(T)})),ye.push(S(T,"click",r,void 0,{module:"dotsFlyout",target:C(T)})),ye.push(S(document,"keydown",o,void 0,{module:"dotsFlyout",target:"document"})),re("[FLYOUT] ‚úÖ Event listeners attached successfully!"),re("[FLYOUT] Try hovering over dots now..."),typeof j=="function"&&j(),j=Zn("dotsFlyout.active-sync",l),G(()=>{try{typeof j=="function"&&j()}catch(a){console.error("[FLYOUT] Failed to dispose setActiveSection listener",a)}j=null},{module:"dotsFlyout",kind:"global",detail:"setActiveSection listener"}),l(),G(()=>{We(),T&&(T.setAttribute("hidden",""),T.classList.add("is-hidden"))},{module:"dotsFlyout",kind:"cleanup"})}function Eo(){const e=document.createElement("div");e.style.cssText="backdrop-filter: blur(1px); -webkit-backdrop-filter: blur(1px);";const t=!!e.style.backdropFilter||!!e.style.webkitBackdropFilter;return t?Xt&&console.log("[FEATURE] backdrop-filter supported ‚úì"):(X.classList.add("no-backdrop-filter"),Xt&&console.log("[FEATURE] backdrop-filter not supported, using fallback")),t}function So(){be=null;const{modeChanged:e}=Mn();e&&(he&&(E==="desktop"||E==="desktop-wide")?(Fn(),Wt()):(ze(),T&&(T.setAttribute("hidden",""),T.classList.add("is-hidden")),he&&Wt())),le({force:!Be,modeChanged:e,viewportChanged:mt}),mt=!1}function At(){be===null&&(be=requestAnimationFrame(So))}function Lo(){if(K&&S(K,"click",()=>cn(K),void 0,{module:"menu.interactions"}),R&&(S(R,"wheel",t=>{if((t==null?void 0:t.target)instanceof HTMLElement&&R.contains(t.target)){if($&&typeof t.deltaY=="number"){const n=Math.max(0,$.scrollHeight-$.clientHeight);if(n>0){const i=Math.min(n,Math.max(0,$.scrollTop+t.deltaY));$.scrollTop=i}}t.preventDefault(),t.stopPropagation()}},{passive:!1},{module:"menu.interactions",target:C(R),detail:"scrollIsolation"}),S(R,"mouseenter",()=>{ae==="pointer"&&h.classList.add("is-slid")},void 0,{module:"menu.interactions",target:C(R)}),S(R,"mouseleave",()=>{ae==="pointer"&&h.classList.remove("is-slid")},void 0,{module:"menu.interactions",target:C(R)}),S(R,"focusin",()=>{ae==="pointer"&&h.classList.add("is-slid")},void 0,{module:"menu.interactions",target:C(R)}),S(R,"focusout",t=>{if(ae!=="pointer"||h.classList.contains("menu-open"))return;const n=t.relatedTarget;n&&R.contains(n)||h.classList.remove("is-slid")},void 0,{module:"menu.interactions",target:C(R)})),je){const e=C(je);S(je,"mouseenter",()=>{ae==="pointer"&&h.classList.remove("is-slid")},void 0,{module:"menu.interactions",target:e}),S(je,"focusin",()=>{ae==="pointer"&&h.classList.remove("is-slid")},void 0,{module:"menu.interactions",target:e})}J&&S(J,"click",()=>{E==="mobile"&&cn(J)},void 0,{module:"menu.interactions",target:C(J)}),rt&&S(rt,"click",()=>{if(!h.classList.contains("menu-open"))return;Ne({focusOrigin:E==="mobile"?J:K})},void 0,{module:"menu.interactions",target:C(rt)}),st&&S(st,"click",()=>{E==="mobile"&&h.classList.contains("menu-open")&&Ne({focusOrigin:J})},void 0,{module:"menu.interactions",target:C(st)}),S(document,"keydown",e=>{e.key==="Escape"&&h.classList.contains("menu-open")&&(e.preventDefault(),Ne({focusOrigin:E==="mobile"?J:K}))},void 0,{module:"menu.interactions",target:"document"}),G(()=>{h.classList.remove("is-slid")},{module:"menu.interactions",kind:"state-reset"})}function In(){if(E!=="tablet"||!Ze()||lt)return;const e=30;Vt=t=>{E==="tablet"&&t.clientX<=e&&!h.classList.contains("menu-open")&&It({focusOrigin:K})},lt=S(document,"click",Vt,void 0,{module:"menu.edgeGesture",target:"document"})}function Kt(){typeof lt=="function"&&(lt(),lt=null),Vt=null}function ko(){if(ae!=="touch"||!Ze()||Oe.length>0)return;let e=0,t=0,n=0,i=0,r=!1,o=null,l=!1,a=!1;const c=60,u=80,w=80,g=50,d=120,y=15;function F(x){e=x.changedTouches[0].clientX,t=x.changedTouches[0].clientY,r=!1,o=null,l=!1;const k=x.target;a=k&&(k.classList.contains("menu-rail__cap")||k.closest(".menu-rail__cap"))}function O(x){if(!r){const k=Math.abs(x.changedTouches[0].clientX-e),H=Math.abs(x.changedTouches[0].clientY-t);if(k>y||H>y){r=!0,o=k>H?"horizontal":"vertical";const z=x.changedTouches[0].clientX,I=x.changedTouches[0].clientY,P=z-e,_=I-t,Y=window.innerHeight;if(E==="mobile"&&o==="vertical"){const U=_<0&&t>Y-w&&!h.classList.contains("menu-open"),Me=_>0&&h.classList.contains("menu-open")&&(a||t<d);l=U||Me}if(E==="tablet"&&o==="horizontal"){const U=P>0&&e<=g&&!h.classList.contains("menu-open"),Me=P<0&&h.classList.contains("menu-open");l=U||Me}}}l&&x.preventDefault()}function Z(x){n=x.changedTouches[0].clientX,i=x.changedTouches[0].clientY,l&&L(),r=!1,o=null,l=!1,a=!1}function L(){const x=n-e,k=i-t,H=window.innerHeight;if(E==="mobile"){if(k<-c&&t>H-w&&!h.classList.contains("menu-open")){It({focusOrigin:J});return}if(k>u&&h.classList.contains("menu-open")&&(a||t<d)){Ne({focusOrigin:J});return}}if(E==="tablet"){if(x>c&&e<=g&&!h.classList.contains("menu-open")){It({focusOrigin:K});return}if(x<-u&&h.classList.contains("menu-open")){Ne({focusOrigin:K});return}}}const M=h||document.documentElement||document,B=C(M)||"body";Oe.push(S(M,"touchstart",F,{passive:!0},{module:"menu.swipes",target:B})),Oe.push(S(M,"touchmove",O,{passive:!1},{module:"menu.swipes",target:B})),Oe.push(S(M,"touchend",Z,{passive:!0},{module:"menu.swipes",target:B})),G(()=>{Zt()},{module:"menu.swipes",kind:"cleanup"})}function Zt(){if(Oe.length!==0){for(const e of Oe)try{e()}catch(t){console.error("[MenuSwipes] Failed to dispose listener",t)}Oe=[]}}function Ao(){if(!R||!Ze())return;const e=R.querySelectorAll('a[href^="#"]');if(e.length===0)return;const t=[];e.forEach(n=>{const i=r=>{if(r.defaultPrevented||r.button!==0||r.metaKey||r.ctrlKey||r.shiftKey||r.altKey)return;r.preventDefault();const o=n.getAttribute("href");if(!o||o==="#")return;const l=document.querySelector(o);l instanceof HTMLElement&&(On(l),bo(o),l.id&&Nt(l.id)),(E==="mobile"||E==="tablet")&&Ne({focusOrigin:E==="mobile"?J:K})};t.push(S(n,"click",i,void 0,{module:"menu.links",target:C(n)}))}),G(()=>{for(;t.length;){const n=t.pop();try{n()}catch(i){console.error("[MenuLinks] Failed to dispose listener",i)}}},{module:"menu.links",kind:"cleanup"})}function To(){const e=document.querySelector(".stack");if(!e)return;const t=e.querySelector("[data-stack-deck]");if(!t)return;const n=e.querySelector("[data-stack-mobile-hint]"),i=Array.from(e.querySelectorAll("[data-stack-prev], [data-stack-next]")),r="/shared/recommendations.json",o=4e3;let l=[],a=[],c=0,u=!1,w=null,g=null;const d=new Set,y=[],F=[];let O=!1;const Z=B(t);k(Z),fetch(r).then(s=>{if(!s.ok)throw new Error(`HTTP ${s.status}`);return s.json()}).then(s=>{const f=Array.isArray(s)?s.map((v,b)=>M(v,b)):[];f.length>0?k(f):le({elementChanged:!0})}).catch(s=>{console.warn("[StackCarousel] –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:",s),Re(),le({elementChanged:!0})});function L(s){return typeof s!="string"?"":s.trim()}function M(s,f){if(!s)return null;const v=(s.title||s.name||"").trim(),b=(s.description||s.excerpt||"").trim(),A=typeof s.slug=="string"?s.slug.trim():"",W=typeof s.url=="string"&&s.url?s.url:A?`/recommendations/${A}.html`:"",ee=L(s.cover||s.image||""),ie=A||s.id||`card-${f}`;return{id:ie,slug:A,title:v||A||ie||"–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è",description:b||"",cover:ee,url:W}}function B(s){if(!s)return[];const f=Array.from(s.querySelectorAll("[data-stack-card]"));return f.length?f.map((v,b)=>{var A,W,ee;return M({id:v.dataset.cardId||v.dataset.slug,slug:v.dataset.slug,title:v.dataset.title||((A=v.querySelector(".stack-card__title"))==null?void 0:A.textContent),description:v.dataset.description||((W=v.querySelector(".stack-card__description"))==null?void 0:W.textContent),cover:v.dataset.cover||((ee=v.querySelector(".stack-card__emoji"))==null?void 0:ee.textContent),url:v.dataset.url||(v instanceof HTMLAnchorElement?v.getAttribute("href"):"")},b)}).filter(Boolean):[]}function x(){for(;F.length;){const s=F.pop();try{s==null||s()}catch(f){console.error("[StackCarousel] Failed to dispose card listener",f)}}}function k(s){if(x(),xe(t),l=Array.isArray(s)?s.map((v,b)=>M(v,b)).filter(Boolean):[],a=[],!l.length){e.classList.add("stack--empty"),e.style.display="none",Ce();return}e.classList.remove("stack--empty"),e.style.display="",l.forEach((v,b)=>{const A=z(v,b);a.push(A),t.appendChild(A)}),c=0,w=null,u=!1,U(),Re(),le({elementChanged:!0})}function H(s){const f=document.createElement("div");f.className="stack-card__cover";const v=L(s.cover);if(!v){const W=document.createElement("span");return W.className="stack-card__emoji",W.textContent="‚ú®",f.appendChild(W),f}if(/^https?:\/\//i.test(v)||v.startsWith("/")){const W=document.createElement("img");return W.src=v,W.alt=s.title||"–ò–ª–ª—é—Å—Ç—Ä–∞—Ü–∏—è",W.loading="lazy",f.classList.add("stack-card__cover--image"),f.appendChild(W),f}const A=document.createElement("span");return A.className="stack-card__emoji",A.textContent=v,f.appendChild(A),f}function z(s,f){const v=!!s.url,b=document.createElement(v?"a":"div");b.className="stack-card",v&&(b.href=s.url),b.dataset.cardId=s.id||`card-${f}`,b.setAttribute("data-analytics","recommendation-card");const A=document.createElement("div");A.className="stack-card__inner";const W=H(s);A.appendChild(W);const ee=document.createElement("h3");ee.className="stack-card__title",ee.textContent=s.title||"–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è",A.appendChild(ee);const ie=document.createElement("p");return ie.className="stack-card__description",ie.textContent=s.description||"",A.appendChild(ie),b.appendChild(A),I(b,f),b}function I(s,f){F.push(S(s,"mouseenter",()=>{var v;!fe()||ne()||(w=((v=l[f])==null?void 0:v.id)||s.dataset.cardId||"",U())},void 0,{module:"stackCarousel",target:C(s)})),F.push(S(s,"mouseleave",()=>{!fe()||ne()||(w=null,U())},void 0,{module:"stackCarousel",target:C(s)})),F.push(S(s,"click",v=>{P(v,f,s)},void 0,{module:"stackCarousel",target:C(s)}))}function P(s,f,v){!a.length||v instanceof HTMLAnchorElement&&typeof v.href=="string"&&v.href.length>0||(s.preventDefault(),_(f))}function _(s,f={}){const{fromAutoplay:v=!1}=f;if(!a.length)return;const b=a.length;if(b<=1){c=0,U(),Ce();return}const A=(s%b+b)%b;if(A===c&&v){c=(A+1)%b,U();return}c=A,U(),v||Re()}function Y(s){const f=a.length;return f?(s-c+f)%f:0}function U(){e.classList.toggle("stack--inline",E!=="desktop-wide");const s=ne(),f=fe();(!f||s)&&(u=!1,w=null),e.classList.toggle("stack--mobile",s),e.classList.toggle("stack--hover",u&&f&&!s),e.classList.toggle("stack--expanded",u&&f&&!s),n&&(n.hidden=!s);const v=a.length;pe(v<=1),a.forEach((b,A)=>{const W=Me(A,s);Ut(b,W),b.dataset.active=W.offset===0?"true":"false"})}function Me(s,f){var D;const v=a.length;if(!v)return{pointerEvents:"none",offset:0};const b=Y(s),A=f?0:14,W=f?24:0,ee=.05,ie=b*A,et=b*W,Ht=1-b*ee,zt=f?0:Math.max(0,(b-1)*A),vt=f?Math.max(0,(b-1)*W):0,bt=Math.min(1,1-(b-1)*ee),tt=u&&((D=l[s])==null?void 0:D.id)===w,p={"--x-from":`${et}px`,"--y-from":`${ie}px`,"--x-to":`${vt}px`,"--y-to":`${zt}px`,"--s-from":`${Ht}`,"--s-to":`${bt}`,"--z-start":`-${b}px`,"--z-end":`-${Math.max(0,b-1)}px`};let m={offset:b,vars:p,zIndex:tt?100:50-b,pointerEvents:b===0||u&&!f?"auto":"none",opacity:"",transform:"",transition:"",animation:"",boxShadow:"",border:""};if(f)if(b===0)m.transform="translate3d(0, 0, 0) scale(1)",m.opacity=1,m.animation="none";else if(b===v-1)m.zIndex=60,m.animation="flyOutMobile 800ms cubic-bezier(0.32, 0.72, 0, 1) forwards";else{const Q=c%2===0?"stackApproachEven":"stackApproachOdd";m.zIndex=40-b,m.animation=`${Q} var(--stack-animation-duration) linear forwards`}else if(u){const Q=`calc(-${b} * 250px)`;m.transform=`translate3d(${Q}, 0, 0) scale(1)`,m.opacity=1,m.boxShadow=tt?"0 30px 60px -12px rgba(0,0,0,0.4)":"0 30px 60px -12px rgba(0,0,0,0.25)",m.border="none",m.transition=`transform 1.0s cubic-bezier(0.2, 0.8, 0.2, 1) ${b*.1}s, box-shadow 0.5s ease`}else{const Q=b*-15,Ge=-Math.max(0,b-1),_e=1-b*.05;m.transform=`translate3d(0, ${Q}px, ${Ge}px) scale(${_e})`,m.opacity=1,m.animation="none",m.transition="transform 1.0s cubic-bezier(0.2, 0.8, 0.2, 1), box-shadow 0.5s ease",m.boxShadow="0 15px 50px -10px rgba(0, 0, 0, 0.25)"}return m}function Ut(s,f){f.vars&&Object.entries(f.vars).forEach(([b,A])=>{s.style.setProperty(b,A)}),s.style.zIndex=f.zIndex!=null?String(f.zIndex):"",s.style.pointerEvents=f.pointerEvents||"auto",s.style.opacity=f.opacity!==""?String(f.opacity):"",s.style.transform=f.transform||"",s.style.transition=f.transition||"",s.style.boxShadow=f.boxShadow||"",s.style.border=f.border||"";const v=f.animation&&f.animation!=="none";s.style.animation="none",v&&(s.offsetWidth,s.style.animation=f.animation)}function Qe(){Ce(),!(d.size>0||a.length<=1)&&(g=Ln(()=>{_(c+1,{fromAutoplay:!0})},o,{module:"stackCarousel",detail:"autoplay"}))}function Re(){Qe()}function Ce(){g&&(g(),g=null)}function Fe(s){!s||d.has(s)||(d.add(s),Ce())}function ge(s){!s||!d.has(s)||(d.delete(s),Qe())}function ne(){return E==="mobile"||E==="tablet"||(e==null?void 0:e.classList.contains("stack--inline"))}function fe(){return ae==="pointer"}function pe(s){i.forEach(f=>{f instanceof HTMLButtonElement&&(f.disabled=s,f.setAttribute("aria-disabled",s?"true":"false"))})}const ue=()=>{requestAnimationFrame(()=>U())};y.push(S(e,"mouseenter",()=>{!fe()||ne()||(u=!0,Fe("hover"),U())},void 0,{module:"stackCarousel",target:C(t)})),y.push(S(e,"mouseleave",()=>{!fe()||ne()||(u=!1,w=null,ge("hover"),U())},void 0,{module:"stackCarousel",target:C(t)}));let Le=0,Ye=0,oe=null;const qe=50,Je=10;y.push(S(t,"touchstart",s=>{!s.changedTouches||!s.changedTouches.length||(Le=s.changedTouches[0].clientX,Ye=s.changedTouches[0].clientY,oe=null,Fe("touch"))},{passive:!0},{module:"stackCarousel",target:C(t)})),y.push(S(t,"touchmove",s=>{if(ne()){if(!oe){const f=Math.abs(s.changedTouches[0].clientX-Le),v=Math.abs(s.changedTouches[0].clientY-Ye);(f>Je||v>Je)&&(oe=f>v?"horizontal":"vertical")}oe==="horizontal"&&s.preventDefault()}},{passive:!1},{module:"stackCarousel",target:C(t)})),y.push(S(t,"touchend",s=>{if(!s.changedTouches||!s.changedTouches.length){ge("touch");return}if(ne()&&oe==="horizontal"){const f=s.changedTouches[0].clientX,v=Le-f;Math.abs(v)>=qe&&_(v>0?c+1:c-1)}oe=null,ge("touch")},{passive:!0},{module:"stackCarousel",target:C(t)})),y.push(S(t,"touchcancel",()=>{oe=null,ge("touch")},{passive:!0},{module:"stackCarousel",target:C(t)})),i.forEach(s=>{const f=s.hasAttribute("data-stack-next");y.push(S(s,"click",v=>{v.preventDefault(),!s.disabled&&_(f?c+1:c-1)},void 0,{module:"stackCarousel",target:C(s)}))}),y.push(S(window,"resize",ue,void 0,{module:"stackCarousel",target:"window"})),y.push(S(window,"orientationchange",ue,void 0,{module:"stackCarousel",target:"window"})),U(),Re();const wt=()=>{if(!O)for(O=!0,Ce(),d.clear(),x();y.length;){const s=y.pop();try{s()}catch(f){console.error("[StackCarousel] Failed to dispose listener",f)}}},$e=G(()=>{wt()},{module:"stackCarousel",kind:"cleanup"});return()=>{wt();try{$e==null||$e()}catch(s){console.error("[StackCarousel] Failed to deregister lifecycle cleanup",s)}}}function xo(){let e=window.pageYOffset||document.documentElement.scrollTop,t=!1;const n=10,i=100;let r=E==="mobile"||E==="tablet",o=!1,l=null;const a=()=>{e=window.pageYOffset||document.documentElement.scrollTop},c=()=>{h.hasAttribute("data-scroll")&&h.removeAttribute("data-scroll")};function u(){if(!r){c(),t=!1,a();return}if(o||h.classList.contains("menu-open")){c(),t=!1,a();return}const F=window.pageYOffset||document.documentElement.scrollTop,O=F-e;if(Math.abs(O)<n){t=!1;return}O>0&&F>i?h.dataset.scroll!=="down"&&(h.dataset.scroll="down"):O<0&&h.dataset.scroll!=="up"&&(h.dataset.scroll="up"),F<=i&&h.removeAttribute("data-scroll"),e=F,t=!1}function w(){t||(requestAnimationFrame(u),t=!0)}function g(F){const O=!!F;if(r===O){O||(c(),a());return}r=O,c(),a(),r||(o=!1)}function d(F){const O=!!F;if(o===O){O&&(c(),a());return}o=O,c(),a()}function y(){typeof l=="function"&&(l(),l=null),c(),t=!1}l=S(window,"scroll",w,{passive:!0},{module:"scroll.hideHeader",target:"window"}),Pe={suppress:d,setMode:g,detach:y},g(r),G(()=>{y(),Pe={suppress:()=>{},setMode:()=>{},detach:()=>{}}},{module:"scroll.hideHeader",kind:"cleanup"})}function Mo(){const e=Jn(),t=to(e.element),n=e.element,i=t.element,r=t.mode==="document"||i===window;e.matchedTextBox||console.warn("[ProgressWidget] .text-box not found, using fallback container",{selector:e.selector,scrollMode:t.mode});let o=ce instanceof HTMLElement?ce:document.getElementById("pw-root");o||(o=document.createElement("aside"),o.id="pw-root",o.setAttribute("role","button"),o.setAttribute("tabindex","0"),o.setAttribute("aria-disabled","true"),o.setAttribute("aria-label","–ü—Ä–æ–≥—Ä–µ—Å—Å —á—Ç–µ–Ω–∏—è: 0%")),ce=o;let l=n.querySelector(".pw-slot"),a=!1;l||(l=document.createElement("div"),l.className="pw-slot",n.appendChild(l),a=!0);const c=document.body.contains(l)?l:document.body.contains(n)?n:document.body;o.parentElement!==c?c.appendChild(o):c.contains(o)||c.appendChild(o),o.dataset.pwContainer=e.selector,o.dataset.pwScrollMode=t.mode;const u=(l==null?void 0:l.dataset.buttonText)||(n==null?void 0:n.dataset.buttonText)||"–î–∞–ª–µ–µ";xe(o);const w=document.createElement("div");w.className="pw-visual";const g=document.createElement("div");g.className="pw-dot";const d=document.createElement("div");d.className="pw-pill";const y=document.createElement("div");y.className="pw-pct";const F=document.createElement("span");F.id="pwPct",F.textContent="0%",y.appendChild(F);const O=document.createElement("div");O.className="pw-next",O.textContent=u,w.appendChild(g),w.appendChild(d),w.appendChild(y),w.appendChild(O),o.appendChild(w);const Z=y,L=O,M=typeof window.matchMedia=="function"?window.matchMedia("(prefers-reduced-motion: reduce)").matches:!1,B=95;function x(p){return p<0?0:p>1?1:p}function k(){const p=n.getBoundingClientRect(),m=window.innerHeight,D=Math.max(n.scrollHeight,p.height)-m;if(D<=0)return 1;const Q=Math.min(Math.max(-p.top,0),D);return x(Q/D)}function H(){const p=Math.max(i.scrollHeight,n.scrollHeight)-i.clientHeight;if(p<=0)return 1;const m=i.scrollTop;return x(m/p)}function z(){return r?k():H()}function I(){const p=document.querySelector(".text-box"),m=(p==null?void 0:p.dataset.nextPage)||document.body.dataset.nextPage||o.getAttribute("data-next-url");if(m&&m!=="#")return m;const D=document.querySelector("link[rel=next][href]");if(D)return D.getAttribute("href");const Q=document.querySelector("a[rel=next][href], a.next[href], nav .next a[href]");if(Q)return Q.getAttribute("href");const Ge=Array.from(document.querySelectorAll("a[href]")),_e=["–¥–∞–ª–µ–µ","—Å–ª–µ–¥—É—é—â–∞—è","—Å–ª–µ–¥—É—é—â–∏–π","next","more"];for(const De of Ge){const Et=(De.textContent||"").trim().toLowerCase();if(Et&&_e.some(Rt=>Et.includes(Rt)))return De.getAttribute("href")}return"#"}const P=I(),_=document.querySelector("article[data-page-type]"),Y=(_==null?void 0:_.dataset.pageType)||"unknown",U=Y==="free"||Y==="intro-free",Me=Y==="recommendation",Ut=Y==="premium"||Y==="intro-premium";U&&o.setAttribute("data-free-version","true");const Qe="toosmart_last_premium_position";function Re(){if(Ut&&typeof localStorage<"u")try{localStorage.setItem(Qe,window.location.pathname)}catch(p){console.warn("[ProgressWidget] –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–æ–∑–∏—Ü–∏—é:",p)}}function Ce(){if(Me&&typeof localStorage<"u")try{const p=localStorage.getItem(Qe);if(p&&p.includes("/premium/"))return p}catch(p){console.warn("[ProgressWidget] –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –ø–æ–∑–∏—Ü–∏—é:",p)}return P}let Fe=null,ge=null,ne=null,fe=null,pe=!1,ue=!1,Le=null,Ye=!1;const oe="cubic-bezier(0.25, 0.6, 0.4, 1)",qe="cubic-bezier(0.7, 0, 0.25, 1)";function Je(p){return typeof p!="string"?[]:p.split(",").map(m=>m.trim()).map(m=>{if(m.endsWith("ms"))return parseFloat(m);if(m.endsWith("s"))return parseFloat(m)*1e3;const D=parseFloat(m);return Number.isFinite(D)?D:0}).filter(m=>Number.isFinite(m)&&m>=0)}function wt(p){if(!(p instanceof HTMLElement))return null;const m=window.getComputedStyle(p),D=Je(m.transitionDuration),Q=Je(m.transitionDelay),Ge=Math.max(D.length,Q.length);if(!Ge)return null;let _e=0;for(let De=0;De<Ge;De+=1){const Et=D[De%D.length]??0,Rt=Q[De%Q.length]??0;_e=Math.max(_e,Et+Rt)}return _e}function $e(){return h.dataset.mode==="mobile"}function s(){$e()?o.classList.add("is-floating"):o.classList.remove("is-floating")}s();function f(){h.classList.contains("menu-open")?o.classList.add("is-menu-covered"):o.classList.remove("is-menu-covered")}f();let v=()=>{};if(typeof MutationObserver=="function"){const p=new MutationObserver(m=>{for(const D of m)if(D.attributeName==="class"){f();break}});p.observe(h,{attributes:!0,attributeFilter:["class"]}),v=kn(p,{module:"progressWidget",target:"body[class] mutation"})}else{let p=h.classList.contains("menu-open");v=Ln(()=>{const D=h.classList.contains("menu-open");D!==p&&(p=D,f())},250,{module:"progressWidget",target:"body[class] poll"})}function b(){for(const p of[Fe,ge,ne,fe])try{p&&p.cancel()}catch{}Fe=ge=ne=fe=null}function A(p){const m=!!p;Z.style.opacity=m?"0":"1",L.style.opacity=m?"1":"0"}function W(){const p="translate(var(--pw-dot-translate-x), -50%)",m="translate(var(--pw-dot-translate-x), -50%)",D="translate(var(--pw-dot-translate-x), calc(-50% + 8px))";if(M){g.style.opacity="0",d.style.opacity="1",d.style.transform="translate(-50%,-50%) scaleX(1)",A(!0),Z.style.transform=D,L.style.transform="translateY(0)",L.style.letterSpacing="0px";return}b(),Fe=g.animate([{transform:`${p} scale(1)`,opacity:1},{transform:`${p} scale(1.08)`,opacity:.85,offset:.18},{transform:`${p} scale(0.82)`,opacity:.45,offset:.48},{transform:`${p} scale(0.6)`,opacity:0}],{duration:500,easing:oe,fill:"forwards"}),ge=d.animate([{transform:"translate(-50%,-50%) scaleX(0.001)",opacity:0},{transform:"translate(-50%,-50%) scaleX(0.72)",opacity:1,offset:.42},{transform:"translate(-50%,-50%) scaleX(1.08)",opacity:1,offset:.72},{transform:"translate(-50%,-50%) scaleX(1)",opacity:1}],{duration:500,easing:oe,fill:"forwards"}),ne=Z.animate([{transform:m,offset:0},{transform:D,offset:.45}],{duration:500,easing:oe,fill:"forwards"}),fe=L.animate([{transform:"translateY(8px)",letterSpacing:"0.4px",offset:.55},{transform:"translateY(0)",letterSpacing:"0px",offset:1}],{duration:500,easing:oe,fill:"forwards"})}function ee(){const p="translate(var(--pw-dot-translate-x), -50%)",m="translate(var(--pw-dot-translate-x), -50%)",D="translate(var(--pw-dot-translate-x), calc(-50% - 6px))";if(M){g.style.opacity="1",g.style.transform=`${p} scale(1)`,d.style.opacity="0",d.style.transform="translate(-50%,-50%) scaleX(0.001)",Z.style.opacity="1",Z.style.transform=m,L.style.opacity="0",L.style.transform="translateY(6px)",L.style.letterSpacing="0.4px";return}b(),Fe=g.animate([{transform:`${p} scale(0.62)`,opacity:0},{transform:`${p} scale(0.92)`,opacity:.55,offset:.28},{transform:`${p} scale(1.04)`,opacity:.85,offset:.58},{transform:`${p} scale(1)`,opacity:1}],{duration:500,easing:qe,fill:"forwards"}),ge=d.animate([{transform:"translate(-50%,-50%) scaleX(1)",opacity:1},{transform:"translate(-50%,-50%) scaleX(0.66)",opacity:1,offset:.32},{transform:"translate(-50%,-50%) scaleX(0.001)",opacity:0}],{duration:500,easing:qe,fill:"forwards"}),ne=Z.animate([{transform:D,offset:.35},{transform:m,offset:.8}],{duration:500,easing:qe,fill:"forwards"}),fe=L.animate([{transform:"translateY(0)",letterSpacing:"0px",offset:0},{transform:"translateY(6px)",letterSpacing:"0.4px",offset:.3}],{duration:500,easing:qe,fill:"forwards"})}function ie(){Le!==null&&(clearTimeout(Le),Le=null)}function et(){pe||(ue=!1,ie(),pe=!0,A(!0),o.classList.remove("is-centering"),o.classList.add("is-done"),o.setAttribute("aria-disabled","false"),o.setAttribute("aria-label","–ö–Ω–æ–ø–∫–∞: –î–∞–ª–µ–µ"),W(),le({elementChanged:!0}))}function Ht(p){if(pe){o.setAttribute("aria-disabled","false"),o.setAttribute("aria-label","–ö–Ω–æ–ø–∫–∞: –î–∞–ª–µ–µ");return}if($e()){if(ue)return;ue=!0,o.classList.add("is-centering"),o.classList.remove("is-done"),o.setAttribute("aria-disabled","true"),o.setAttribute("aria-label","–ü—Ä–æ–≥—Ä–µ—Å—Å —á—Ç–µ–Ω–∏—è: "+p+"%"),le({elementChanged:!0}),ie();const m=M?0:wt(o)??500;m===0?requestAnimationFrame(()=>et()):Le=window.setTimeout(()=>{ue&&et()},Math.max(0,Math.round(m+40)));return}pe=!0,A(!0),o.classList.remove("is-centering"),o.classList.add("is-done"),o.setAttribute("aria-disabled","false"),o.setAttribute("aria-label","–ö–Ω–æ–ø–∫–∞: –î–∞–ª–µ–µ"),W(),le({elementChanged:!0})}function zt(p){if(!pe&&!ue&&!o.classList.contains("is-centering")){o.setAttribute("aria-disabled","true"),o.setAttribute("aria-label","–ü—Ä–æ–≥—Ä–µ—Å—Å —á—Ç–µ–Ω–∏—è: "+p+"%");return}const m=pe||ue||o.classList.contains("is-centering");ue=!1,ie(),pe=!1,A(!1),o.classList.remove("is-done","is-centering"),o.setAttribute("aria-disabled","true"),o.setAttribute("aria-label","–ü—Ä–æ–≥—Ä–µ—Å—Å —á—Ç–µ–Ω–∏—è: "+p+"%"),m&&(ee(),le({elementChanged:!0}))}S(o,"transitionend",p=>{ue&&p.target===o&&(p.propertyName!=="left"&&p.propertyName!=="transform"||et())},void 0,{module:"progressWidget",target:C(o)});function vt(){Ye||(Ye=!0,requestAnimationFrame(bt))}function bt(){Ye=!1,s();const p=z(),m=Math.round(p*100);if(F.textContent=m+"%",m>=B){Ht(m);return}zt(m)}S(o,"click",p=>{if(pe)if(U&&typeof window.openPaymentModal=="function")p.preventDefault(),window.openPaymentModal();else{const m=Ce();m&&m!=="#"?(Re(),window.location.href=m):console.warn("Progress Widget: —Å–ª–µ–¥—É—é—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞")}else if(r){const m=n.getBoundingClientRect(),D=window.scrollY+(m.bottom-window.innerHeight+1);window.scrollTo({top:D,behavior:"smooth"})}else{const m=Math.max(i.scrollHeight-i.clientHeight,0);typeof i.scrollTo=="function"?i.scrollTo({top:m,behavior:"smooth"}):i.scrollTop=m}},{passive:!1},{module:"progressWidget",target:C(o)}),S(o,"keydown",p=>{(p.key==="Enter"||p.key===" ")&&(p.preventDefault(),o.click())},void 0,{module:"progressWidget",target:C(o)}),S(window,"scroll",vt,{passive:!0},{module:"progressWidget",target:"window"}),!r&&i&&i!==window&&S(i,"scroll",vt,{passive:!0},{module:"progressWidget",target:C(i)}),g.style.opacity="1",d.style.opacity="0",d.style.transform="translate(-50%,-50%) scaleX(0.001)",A(!1),xn(o),bt(),le({elementChanged:!0});const tt=G(()=>{b();try{v()}catch(p){console.error("[ProgressWidget] Failed to disconnect menu observer",p)}if(o.classList.remove("is-done","is-menu-covered","is-floating","is-centering"),o.isConnected&&typeof o.remove=="function"?o.remove():o.parentElement&&o.parentElement.removeChild(o),ce=null,a&&l&&l.parentElement)try{l.remove()}catch{l.parentElement.removeChild(l)}},{module:"progressWidget",kind:"cleanup"});return()=>{if(typeof tt=="function")try{tt()}catch(p){console.error("[ProgressWidget] Failed to dispose via lazy cleanup",p)}}}function Co(){if(he)return()=>{};nn(),he=!0;try{vo(),Wt()}catch(e){console.error("[LazyFeatures] Failed to initialize dots navigation",e)}return()=>{he=!1;try{ze()}catch(e){console.error("[LazyFeatures] Failed to teardown section observer",e)}if(typeof j=="function")try{j()}catch(e){console.error("[LazyFeatures] Failed to dispose flyout listener",e)}j=null,We(),T&&(xe(T),T.setAttribute("hidden",""),T.classList.add("is-hidden")),N&&(xe(N),N.hidden=!0),en("dotsFlyout.lazy-cleanup")}}function Fo(){if(typeof we=="function")return()=>{};let e=null;try{e=To()}catch(t){console.error("[LazyFeatures] Failed to initialize stack carousel",t),e=null}return typeof e=="function"?(we=e,()=>{if(typeof we=="function")try{we()}catch(t){console.error("[LazyFeatures] Failed to cleanup stack carousel",t)}we=null}):(we=null,()=>{})}function _o(){if(typeof ve=="function")return()=>{};const e=document.querySelector("article[data-page-type]"),t=(e==null?void 0:e.dataset.pageType)||"unknown",n=!!document.querySelector("[data-paywall-root]")||!!document.querySelector(".premium-teaser");if(t==="free"||t==="paywall"||n)return()=>{};nn();let r=null;try{r=Mo()}catch(o){console.error("[LazyFeatures] Failed to initialize progress widget",o),r=null}return typeof r=="function"?(ve=r,()=>{if(typeof ve=="function")try{ve()}catch(o){console.error("[LazyFeatures] Failed to cleanup progress widget",o)}ve=null}):(ve=null,()=>{})}ht.register("dots-nav",{onEnter:()=>Co()});ht.register("stack-carousel",{sticky:!0,onEnter:()=>Fo()});ht.register("progress-widget",{sticky:!0,onEnter:()=>_o()});function nn(){R||(R=document.querySelector(".menu-rail")),de||(de=document.querySelector(".header")),K||(K=document.querySelector(".menu-handle")),$||($=document.querySelector(".site-menu")),rt||(rt=document.querySelector(".backdrop")),J||(J=document.querySelector(".dock-handle")),je||(je=document.querySelector(".panel")),rn||(rn=document.querySelector(".main")),N||(N=document.querySelector(".dots-rail")),T||(T=document.querySelector(".dot-flyout")),st||(st=document.querySelector(".menu-rail__cap")),ce||(ce=document.getElementById("pw-root")),q.length===0&&q.push(...Array.from(document.querySelectorAll(".text-section")))}function Do(){nn(),Eo();const e=Mn();if(Lo(),In(),ko(),xo(),Ao(),ht.observeAll(),le({force:!Be,modeChanged:e==null?void 0:e.modeChanged}),S(window,"resize",()=>{nt(window.visualViewport),At()},void 0,{module:"layout.mode",target:"window"}),(()=>{if(Lt)return window.DEBUG_MODE_DETECTION&&console.log("[layout.mode] visualViewport listeners already bound, skipping duplicate subscription"),!0;const r=window.visualViewport;return!r||typeof r.addEventListener!="function"?(window.DEBUG_MODE_DETECTION&&console.log("[layout.mode] visualViewport unsupported, relying on window resize/orientation listeners"),!1):(Lt=!0,nt(r),S(r,"resize",()=>{nt(r)&&At()},void 0,{module:"layout.mode",target:"visualViewport"}),window.DEBUG_MODE_DETECTION&&console.log("[layout.mode] visualViewport listeners attached"),!0)})(),S(window,"orientationchange",()=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{nt(window.visualViewport),At()})})},void 0,{module:"layout.mode",target:"window"}),window.matchMedia){const r=window.matchMedia("(min-width: 1024px)"),o=window.matchMedia("(min-width: 1280px)"),l=window.matchMedia("(min-width: 1440px)"),a=()=>{requestAnimationFrame(()=>{nt(window.visualViewport),At()})};qt(r,a,{module:"layout.mode",query:"(min-width: 1024px)"}),qt(o,a,{module:"layout.mode",query:"(min-width: 1280px)"}),qt(l,a,{module:"layout.mode",query:"(min-width: 1440px)"})}return G(ze,{module:"sections.observer"}),G(()=>{typeof V=="function"&&(V(),V=null)},{module:"dotsFlyout",detail:"cancel hide timeout"}),G(()=>{Kt(),Zt(),Ot(),We()},{module:"menu.lifecycle",kind:"detach"}),G(()=>{me=null,Ue.setOpen(!1,{silent:!0}),h.classList.remove("is-slid"),h.removeAttribute("data-scroll"),delete h.dataset.lock,delete X.dataset.lock,Ue.refreshHandles()},{module:"menu.lifecycle",kind:"state-reset"}),G(()=>{Se!==null&&(cancelAnimationFrame(Se),Se=null),be!==null&&(cancelAnimationFrame(be),be=null),_t=null,Dt=null,Lt=!1,mt=!1,Be=!1},{module:"layout.metrics",kind:"raf"}),r=>{if(ht.disconnect(),Kt(),Zt(),Ot(),We(),be!==null&&(cancelAnimationFrame(be),be=null),_t=null,Dt=null,Lt=!1,mt=!1,Be=!1,typeof we=="function")try{we()}catch(o){console.error("[Lifecycle] Failed to cleanup stack carousel",{error:o,reason:r})}if(we=null,typeof ve=="function")try{ve()}catch(o){console.error("[Lifecycle] Failed to cleanup progress widget",{error:o,reason:r})}ve=null,he=!1,ze(),Pe.detach(),typeof V=="function"&&(V(),V=null),me=null,r&&Xt&&console.log("[Lifecycle] init() cleanup invoked",r)}}function Oo(e){const t=[],n=i=>{try{e({reason:i})}catch(r){console.error("[Lifecycle] dispose failed from page lifecycle",{reason:i,error:r})}};if(typeof window.addEventListener=="function"){const i=o=>{o!=null&&o.persisted||n("pagehide")};window.addEventListener("pagehide",i),t.push(()=>window.removeEventListener("pagehide",i));const r=()=>{n("beforeunload")};window.addEventListener("beforeunload",r),t.push(()=>window.removeEventListener("beforeunload",r))}if(typeof(document==null?void 0:document.addEventListener)=="function"){const i=()=>{document.visibilityState==="hidden"?Bn({reason:"visibilitychange"}):document.visibilityState==="visible"&&on({reason:"visibilitychange"})};document.addEventListener("visibilitychange",i),t.push(()=>document.removeEventListener("visibilitychange",i))}return()=>{for(;t.length;){const i=t.pop();try{i()}catch(r){console.error("[Lifecycle] Failed to remove page lifecycle hook",r)}}}}const ot=window[ut];if(ot&&typeof ot.dispose=="function"){try{ot.dispose({reason:"reinit"})}catch(e){console.error("[Lifecycle] Failed to dispose previous app instance",e)}if(typeof ot.teardown=="function")try{ot.teardown()}catch(e){console.error("[Lifecycle] Failed to teardown previous app hooks",e)}}let Te=null,dt=null,Mt=()=>{},gt=()=>{},Bt=!1,yt=!0;function Io(e={}){Te=oo("toosmart:init"),Sn(Te);try{dt=Do()}catch(n){console.error("[Lifecycle] init() failed",{error:n,context:e}),dt=null}Mt=S(window,"load",()=>{le({elementChanged:!0})},void 0,{module:"layout.metrics",target:"window"}),le({force:!Be})}function Wn(e={}){const t=e&&typeof e=="object"?e:{reason:String(e)};try{typeof dt=="function"&&dt(t)}catch(n){console.error("[Lifecycle] init cleanup failed",{error:n,cleanupReason:t})}dt=null;try{typeof Mt=="function"&&Mt()}catch(n){console.error("[Lifecycle] Failed to remove load listener",n)}if(Mt=()=>{},Te)try{Te.disposeAll()}catch(n){console.error("[Lifecycle] disposeAll failed",{error:n,cleanupReason:t})}Te=null,Sn(null)}function Ke(e,t){const n=He.snapshot();return console.info(`[Lifecycle] ${e}`,{payload:t,activeResources:n.total,byKind:n.byKind}),n}function Bn(e={}){Bt||yt||(Ke("pause:start",e),yt=!0,Wn(e),Ke("pause:complete",e))}function on(e={}){Bt||!yt&&Te||(Ke("resume:start",e),yt=!1,Io(e),Ke("resume:complete",e))}function Qt(e={}){Bt||(Ke("dispose:start",e),Bt=!0,yt=!0,gt(),gt=()=>{},Wn(e),Ke("dispose:complete",e))}gt=Oo(Qt);const it=co(He);window.DEBUG_METRICS_OVERLAY&&it.start();document.visibilityState!=="hidden"&&on({reason:"init"});Nn();const Wo={dispose:Qt,pause:Bn,resume:on,teardown(){gt(),gt=()=>{}},getResources(){return Te?Te.report():[]},getResourceDiagnostics(){return He.snapshot()},logResourceDiagnostics(e){return He.logSnapshot(e)},getFlyoutDiagnostics(){return{initTimeline:[...yn],setActiveSectionTimeline:[...wn],bridge:Qn()}},destroy(e="destroy"){try{this.teardown()}catch(t){console.error("[Lifecycle] Failed to teardown before destroy",t)}if(Qt({reason:e}),window[ut]===this)try{delete window[ut]}catch{window[ut]=void 0}},audit:"2024-12-20"};window[ut]=Wo;const Pt=window.__TOOSMART_RESOURCES__||{};Pt.summary=()=>He.snapshot();Pt.log=e=>He.logSnapshot(e);Pt.overlay={toggle:()=>it.toggle(),show:()=>it.start(),hide:()=>it.stop(),isActive:()=>it.isActive()};window.__TOOSMART_RESOURCES__=Pt;window.toggleModeDebug=function(e){var t,n;if(typeof e=="boolean"?window.DEBUG_MODE_DETECTION=e:window.DEBUG_MODE_DETECTION=!window.DEBUG_MODE_DETECTION,window.DEBUG_MODE_DETECTION){console.log("[DEBUG] Mode detection logging enabled ‚úì"),console.log("[DEBUG] Current state:",{mode:E,input:ae});const i={visualViewportWidth:(t=window.visualViewport)==null?void 0:t.width,rootClientWidth:X==null?void 0:X.clientWidth,innerWidth:window.innerWidth,outerWidth:window.outerWidth,screenWidth:(n=window.screen)==null?void 0:n.width};console.log("[DEBUG] Width sources (priority order):",i);const r=[i.visualViewportWidth,i.rootClientWidth,i.innerWidth,i.outerWidth,i.screenWidth];let o=null,l=null;const a=["visualViewportWidth","rootClientWidth","innerWidth","outerWidth","screenWidth"];for(let w=0;w<r.length;w++){const g=r[w];if(typeof g=="number"&&Number.isFinite(g)&&g>0){o=g,l=a[w];break}}console.log("[DEBUG] Width used for detection:",o,`(from ${l})`);const c=An(),u=Tn(c);console.log("[DEBUG] Detected state:",{mode:u,input:c}),console.log("[DEBUG] State mismatch:",{mode:E!==u,input:ae!==c}),console.log("[DEBUG] Now resize the window to see automatic mode/input changes...")}else console.log("[DEBUG] Mode detection logging disabled")};
