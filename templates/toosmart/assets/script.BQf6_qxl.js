import{i as Bn}from"./legal-modals.HlgFiOUJ.js";const Ae=typeof document<"u"?document:null,dt=Ae?Ae.documentElement:null,Ve={MOBILE_MAX:767,TABLET_MIN:768,TABLET_MAX:899,DESKTOP_MIN:900,DESKTOP_MAX:1279,DESKTOP_WIDE_MIN:1280};function Ee(e){return typeof e=="number"&&isFinite(e)}function dn(e,t){if(!e||typeof e.matchMedia!="function")return!1;try{return e.matchMedia(t).matches}catch{return!1}}function fn(e){const t=e||window,n=dn(t,"(any-pointer: coarse)"),i=t&&t.navigator?t.navigator:null,o=(i&&typeof i.maxTouchPoints=="number"?i.maxTouchPoints:0)>0;return n||o?"touch":"pointer"}function Jt(e,t){return t==="touch"?e<Ve.TABLET_MIN?"mobile":e<Ve.DESKTOP_MIN?"tablet":"desktop":e<Ve.TABLET_MIN?"mobile":e<Ve.DESKTOP_MIN?"tablet":e<Ve.DESKTOP_WIDE_MIN?"desktop":"desktop-wide"}function pn(e,t){const n=e||window,i=t||dt;return[{source:"visualViewportWidth",value:n&&n.visualViewport&&Ee(n.visualViewport.width)&&n.visualViewport.width>0?n.visualViewport.width:null},{source:"rootClientWidth",value:i&&Ee(i.clientWidth)&&i.clientWidth>0?i.clientWidth:null},{source:"innerWidth",value:n&&Ee(n.innerWidth)&&n.innerWidth>0?n.innerWidth:null},{source:"outerWidth",value:n&&Ee(n.outerWidth)&&n.outerWidth>0?n.outerWidth:null},{source:"screenWidth",value:n&&n.screen&&Ee(n.screen.width)&&n.screen.width>0?n.screen.width:null}]}function mn(e,t,n){const i=e||window,o=pn(i,t||dt);for(let a=0;a<o.length;a+=1){const c=o[a],u=c?c.value:null;if(Ee(u)&&u>0)return Jt(u,n)}const l=[["mobile","(max-width: 767px)"],["tablet","(min-width: 768px) and (max-width: 899px)"],["desktop","(min-width: 900px) and (max-width: 1279px)"],["desktop-wide","(min-width: 1280px)"]];for(let a=0;a<l.length;a+=1){const c=l[a];if(dn(i,c[1]))return c[0]}return"desktop"}function Pn(e,t){const n=e||window,i=t||Ae,r=i&&i.documentElement?i.documentElement:dt;let o=null;n&&Ee(n.innerWidth)&&n.innerWidth>0?o=n.innerWidth:r&&Ee(r.clientWidth)&&r.clientWidth>0&&(o=r.clientWidth);const l=fn(n);let a="desktop";return Ee(o)&&o>0?a=Jt(o,l):a=mn(n,r,l),{mode:a,input:l}}function Un(e,t){const n=e||Ae;return!n||!n.body?!1:(n.body.dataset.mode=t,!0)}function Hn(e,t){const n=e||Ae;if(!n||!n.body||!t)return!1;const i=n.body;return t.mode&&(i.dataset.mode=t.mode),t.input&&(i.dataset.input=t.input),!0}const hn={BREAKPOINTS:Ve,classifyMode:(e,t)=>Jt(e,t),detectInput:e=>fn(e||window),detectMode:(e,t,n)=>mn(e||window,t||dt,n),getWidthSources:(e,t)=>pn(e||window,t||dt),detectInitialState:(e,t)=>Pn(e||window,t||Ae),applyModeToBody:(e,t)=>Un(e||Ae,t),applyStateToBody:(e,t)=>Hn(e||Ae,t)};typeof window<"u"&&(window.ModeUtils=hn);(function(){const e=window.location.pathname;(e==="/"||e==="/index.html")&&document.cookie.split(";").some(t=>t.trim().startsWith("premium_access=1"))&&window.location.replace("/premium/")})();const ft=window.ModeUtils||hn;if(!ft)throw new Error("ModeUtils module is required for responsive mode detection.");const X=document.documentElement,h=document.body,zn=typeof window.__INITIAL_MODE__=="string",Rn=typeof window.__INITIAL_INPUT__=="string",gn=qn(h),Yn=gn.mode,Gt=gn.input;zn&&delete window.__INITIAL_MODE__;Rn&&delete window.__INITIAL_INPUT__;let R=null,ue=null,K=null,q=null,it=null,J=null,Xe=null,rn=null,B=null,A=null,$=[],rt=null,le=null,Ge=!1,E=h.dataset.mode||Yn||"desktop",se=h.dataset.input||Gt||"pointer";!h.dataset.input&&typeof Gt=="string"&&(h.dataset.input=Gt);var un;let Ct=((un=$[0])==null?void 0:un.id)??null,pe=null,st=null,Tt=null,xt=()=>{},Vt=null,V=null,ye=[],j=null,De=[],at=null,Be={suppress:()=>{},setMode:()=>{},detach:()=>{}},We=!1,pt=!1,we=null,ve=null,me=!1;const Pe=$n({body:h,handles:[K,J]});function Me(e){if(e)for(;e.firstChild;)e.removeChild(e.firstChild)}function Ke(){return!!(R||q)}function qn(e){const{body:t}=document,n=e||t,i=typeof window.__INITIAL_MODE__=="string"?window.__INITIAL_MODE__:n==null?void 0:n.dataset.mode,r=typeof window.__INITIAL_INPUT__=="string"?window.__INITIAL_INPUT__:n==null?void 0:n.dataset.input;if(!(!i||!r))return{mode:i,input:r};const l=ft.detectInitialState(window,document),a=i||l.mode,c=r||l.input;return n&&(n.dataset.mode||(n.dataset.mode=a),n.dataset.input||(n.dataset.input=c)),{mode:a,input:c}}function $n({body:e,handles:t=[]}={}){const n=t.filter(p=>p instanceof HTMLElement),i=new Set;let r=!!(e!=null&&e.classList.contains("menu-open"));function o(p){return p?!!(p.offsetWidth||p.offsetHeight||p.getClientRects().length):!1}function l(){const p=String(r);for(const v of n)v&&(o(v)?v.setAttribute("aria-expanded",p):v.removeAttribute("aria-expanded"))}function a(){e&&e.classList.toggle("menu-open",r),l()}function c(){for(const p of i)try{p(r)}catch(v){console.error("[MenuState] Listener failed",v)}}function u(p,{silent:v=!1}={}){const F=!!p;return r!==F?(r=F,a(),v||c()):a(),r}function w(p){return typeof p!="function"?()=>{}:(i.add(p),()=>{i.delete(p)})}function g({silent:p=!1}={}){const v=!!(e!=null&&e.classList.contains("menu-open")),F=v!==r;return r=v,a(),F&&!p&&c(),r}return a(),{isOpen:()=>r,setOpen:u,open:p=>u(!0,p),close:p=>u(!1,p),toggle:p=>u(!r,p),subscribe:w,sync:g,refreshHandles:l}}const Xt=window.DEBUG_MODE_DETECTION||!1,Gn=typeof window.DEBUG_FLYOUT=="boolean"?window.DEBUG_FLYOUT:!1,St=typeof window.DEBUG_FLYOUT_LOGGER=="object"&&window.DEBUG_FLYOUT_LOGGER?window.DEBUG_FLYOUT_LOGGER:console,Vn=25,yn=[],wn=[];let te=null,jt=!1,lt=null,Ft=null;const Te=new Map;let Xn=0,Yt=0;function ie(...e){Gn&&typeof(St==null?void 0:St.log)=="function"&&St.log(...e)}function vn(e=5){try{throw new Error("stack-capture")}catch(t){return t!=null&&t.stack?t.stack.split(`
`).slice(2,2+e).map(n=>n.trim()):void 0}}function bn(e,t){for(e.push(t);e.length>Vn;)e.shift();return t}function jn(e={}){const t=bn(yn,{timestamp:Date.now(),mode:E,sections:$.length,...e,stack:vn(6)});return ie("[FLYOUT] init trace",t),t}function re(e,t={}){const n=bn(wn,{type:e,timestamp:Date.now(),...t,stack:vn(6)});return ie("[FLYOUT] setActiveSection event",n),n}function Kn(e){const t=typeof window.setActiveSection=="function"?window.setActiveSection:null;jt||(jt=!0,lt=t,re("capture-original",{reason:e,hasOriginal:!!t,name:(t==null?void 0:t.name)||null})),t&&t!==te&&t!==lt&&(Ft=t,re("external-override-detected",{reason:e,name:(t==null?void 0:t.name)||null}));const n=Ft||lt||Bt;if(te||(te=function(r){if(typeof te.base=="function")try{te.base(r)}catch(o){console.error("[FLYOUT] base setActiveSection invocation failed",o)}re("invoke",{id:r});for(const o of Te.values())try{o.callback(r),re("listener-invoke",{label:o.label,id:r})}catch(l){console.error("[FLYOUT] setActiveSection listener failed",{label:o.label,error:l})}}),te.base=n,window.setActiveSection!==te)try{window.setActiveSection=te,re("bridge-apply",{reason:e,baseName:(n==null?void 0:n.name)||null})}catch(i){console.error("[FLYOUT] Failed to apply setActiveSection bridge",i),re("bridge-apply-error",{reason:e,error:(i==null?void 0:i.message)||String(i)})}else re("bridge-refresh",{reason:e,baseName:(n==null?void 0:n.name)||null});return n}function en(e){if(te){if(Te.size>0){re("bridge-retained",{reason:e,listeners:Te.size});return}if(window.setActiveSection===te){const t=Ft||lt;if(t)window.setActiveSection=t;else try{delete window.setActiveSection}catch{window.setActiveSection=void 0}re("bridge-release",{reason:e,restored:!!t})}else re("bridge-release-skipped",{reason:e,replaced:!0});Te.size===0&&(te=null)}}function Zn(e,t){if(typeof t!="function")return()=>{};Kn(`listener:${e}`);const n=++Xn;return Te.set(n,{label:e,callback:t}),re("listener-register",{label:e,id:n}),()=>{Te.has(n)&&(Te.delete(n),re("listener-unregister",{label:e,id:n}),en(`listener:${e}:dispose`))}}function Qn(){return{hasBridge:!!te,listeners:Array.from(Te.values()).map(e=>e.label),capturedOriginal:jt,hasOriginal:!!lt,hasExternal:!!Ft}}let Se=null,be=null,_t=null,Dt=null,Lt=!1;function Jn(){const e=[".text-box",".article__content","main article","article",".article",".content","#content","main"];for(const t of e){const n=document.querySelector(t);if(n)return{element:n,selector:t,matchedTextBox:t===".text-box"}}return{element:document.body,selector:"body",matchedTextBox:!1}}function eo(e){if(!e)return"visible";try{const t=getComputedStyle(e);return t.overflowY||t.overflow||"visible"}catch(t){return console.warn("[ProgressWidget] Failed to read overflowY",{error:t,element:e}),"visible"}}function to(e){let t=e;for(;t&&t!==document.body&&t!==document.documentElement;){const i=eo(t);if((i==="auto"||i==="scroll")&&t.scrollHeight>t.clientHeight+1)return{element:t,mode:"element"};t=t.parentElement}return{element:document.scrollingElement||document.documentElement||window,mode:"document"}}const ct="__TOOSMART_APP__";function no(){const e=new Map,t=[];let n=0;const i=()=>typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now();function r(a={}){const c=++n,u={id:c,createdAt:i(),disposedAt:null,meta:{...a}};e.set(c,u);let w=!1;function g(v){w||(w=!0,v&&typeof v=="object"&&(u.meta={...u.meta,...v}),u.disposedAt=i(),e.delete(c),t.push({...u}),t.length>40&&t.shift())}function p(v){!v||typeof v!="object"||(u.meta={...u.meta,...v})}return{id:c,release:g,updateMeta:p,get meta(){return u.meta}}}function o(){const a=Array.from(e.values()).map(u=>({id:u.id,createdAt:u.createdAt,meta:{...u.meta}})),c=a.reduce((u,w)=>{var p;const g=((p=w.meta)==null?void 0:p.kind)||"unknown";return u[g]=(u[g]||0)+1,u},{});return{total:a.length,byKind:c,resources:a,recentDisposals:t.slice(-10),timestamp:i()}}function l(a="Active resources"){const c=o(),u=i();if(console.groupCollapsed(`[Diagnostics] ${a}: ${c.total}`),c.resources.length){const w=c.resources.map(g=>{const p=g.meta||{};return{id:g.id,kind:p.kind??"unknown",label:p.label??p.event??p.target??"-",lifecycle:p.lifecycle??"n/a",ageMs:Math.round(u-g.createdAt)}});console.table(w)}else console.log("No active resources.");if(console.log("[Diagnostics] Count by kind",c.byKind),c.recentDisposals.length){const w=c.recentDisposals.map(g=>{var p,v;return{id:g.id,kind:((p=g.meta)==null?void 0:p.kind)??"unknown",lifecycle:((v=g.meta)==null?void 0:v.lifecycle)??"n/a",releasedAgoMs:g.disposedAt?Math.round(u-g.disposedAt):null}});console.log("[Diagnostics] Recent disposals",w)}return console.groupEnd(),c}return{register:r,snapshot:o,logSnapshot:l,getActiveCount(){return e.size}}}const Ue=no();function oo(e){const t=[];function n(o,l={}){if(typeof o!="function")return()=>{};const a={meta:{label:e,...l},active:!0,dispose:null};return a.dispose=()=>{if(a.active){a.active=!1;try{o()}catch(c){console.error("[Lifecycle] Failed to dispose resource",{label:e,meta:a.meta,error:c})}}},t.push(a),()=>a.dispose()}function i(){for(let o=t.length-1;o>=0;o-=1)t[o].dispose()}function r(){return t.map(o=>({...o.meta,active:o.active}))}return{track:n,disposeAll:i,report:r,label:e}}let En=null;function io(){return En}function Sn(e){En=e}function C(e){return e?e===window?"window":e===document?"document":e===document.documentElement?"documentElement":e===document.body?"body":e instanceof Element?e.id?`#${e.id}`:e.classList&&e.classList.length?`${e.tagName.toLowerCase()}.${Array.from(e.classList).join(".")}`:e.tagName?e.tagName.toLowerCase():"element":String(e):"unknown"}function ro(e){if(e!==void 0){if(e===null)return null;if(typeof e=="boolean")return{capture:e};if(typeof e=="object"){const t={};return"capture"in e&&(t.capture=!!e.capture),"once"in e&&(t.once=!!e.once),"passive"in e&&(t.passive=!!e.passive),"signal"in e&&(t.signal=!0),t}return e}}function G(e,t){if(typeof e!="function")return()=>{};const n=io(),i=t&&typeof t=="object"?t:{},r=Ue.register({...i,lifecycle:(n==null?void 0:n.label)??"detached"});function o(l){try{e==null||e()}catch(a){console.error(`[Lifecycle] Disposer failed${l?` (${l})`:""}`,{meta:t,error:a})}finally{r.release()}}return n?n.track(()=>o(),{...i,resourceId:r.id}):()=>o("outside lifecycle")}function S(e,t,n,i,r={}){if(!e||typeof e.addEventListener!="function")return()=>{};let o=null,l=i,a=!1;if(typeof AbortController=="function"){o=new AbortController,l=so(i,o.signal);try{e.addEventListener(t,n,l),a=!0}catch{o=null,l=i}}return a||e.addEventListener(t,n,i),G(()=>{if(o){o.abort(),o=null;return}e&&typeof e.removeEventListener=="function"&&e.removeEventListener(t,n,i)},{kind:"event",event:t,target:C(e),options:ro(l??i),...r})}function so(e,t){return t?e===void 0?{signal:t}:typeof e=="boolean"?{capture:e,signal:t}:e&&typeof e=="object"?"signal"in e?e:{...e,signal:t}:e:e}function qt(e,t,n={}){if(!e||typeof t!="function")return()=>{};let i=null;return typeof e.addEventListener=="function"?(e.addEventListener("change",t),i=()=>{typeof e.removeEventListener=="function"&&e.removeEventListener("change",t)}):typeof e.addListener=="function"&&(e.addListener(t),i=()=>{typeof e.removeListener=="function"&&e.removeListener(t)}),i?G(()=>{i(),i=null},{kind:"media-query",target:"(media query)",...n}):()=>{}}function ao(e,t,n={}){let i=!1;const r=()=>{i||(i=!0,e())},o=window.setTimeout(r,t);return G(()=>{i||(i=!0,window.clearTimeout(o))},{kind:"timeout",delay:t,...n})}function Ln(e,t,n={}){const i=window.setInterval(e,t);let r=!1;return G(()=>{r||(r=!0,window.clearInterval(i))},{kind:"interval",delay:t,...n})}function kn(e,t={}){return!e||typeof e.disconnect!="function"?()=>{}:G(()=>{e.disconnect()},{kind:"observer",...t})}function lo(e={}){const t=new Map,n=new Map;let i=new WeakSet,r=null;const o=typeof window<"u"&&typeof window.IntersectionObserver=="function";let l=!1;const a=Array.isArray(e.threshold)||typeof e.threshold=="number"?e.threshold:.2,c=typeof e.rootMargin=="string"?e.rootMargin:"0px 0px -10% 0px";function u(L){return typeof L!="string"||!L.trim()?[]:L.split(/[\s,]+/).map(M=>M.trim()).filter(Boolean)}function w(){return o?r||(r=new IntersectionObserver(g,{threshold:a,rootMargin:c}),r):null}function g(L){var M,N,T;for(const k of L){const U=u((N=(M=k.target)==null?void 0:M.dataset)==null?void 0:N.lazy);if(U.length===0)continue;let H=n.get(k.target);H||(H=new Map,n.set(k.target,H));for(const W of U){const P=t.get(W);if(!P)continue;let _=H.get(W);if(_||(_={active:!1,cleanup:null},H.set(W,_)),k.isIntersecting){if(_.active)continue;_.active=!0;let z=null;try{z=(T=P.onEnter)==null?void 0:T.call(P,{id:W,element:k.target,entry:k})}catch(Y){console.error("[LazyFeatures] Activation failed",{id:W,error:Y})}_.cleanup=typeof z=="function"?z:null}else if(_.active){if(P!=null&&P.sticky)continue;if(_.active=!1,typeof P.onExit=="function")try{P.onExit({id:W,element:k.target,entry:k,cleanup:_.cleanup})}catch(z){console.error("[LazyFeatures] onExit handler failed",{id:W,error:z})}if(typeof _.cleanup=="function")try{_.cleanup()}catch(z){console.error("[LazyFeatures] Cleanup failed",{id:W,error:z})}H.delete(W),H.size===0&&n.delete(k.target),_.cleanup=null}}}}function p(L){var T,k;const M=u((T=L==null?void 0:L.dataset)==null?void 0:T.lazy);if(M.length===0)return;l||(l=!0,console.warn("[LazyFeatures] IntersectionObserver is not supported ‚Äî activating features immediately"));let N=n.get(L);N||(N=new Map,n.set(L,N));for(const U of M){const H=t.get(U);if(!H)continue;const W=N.get(U);if(W!=null&&W.active)continue;let P=null;try{P=(k=H.onEnter)==null?void 0:k.call(H,{id:U,element:L,entry:null})}catch(_){console.error("[LazyFeatures] Activation failed (fallback)",{id:U,error:_})}N.set(U,{active:!0,cleanup:typeof P=="function"?P:null})}}function v(L){if(!(L instanceof Element)||i.has(L))return;i.add(L);const M=w();if(M){M.observe(L);return}p(L)}function F(L,M={}){var N;if(!L)return()=>{};if(t.set(L,M),!o)for(const T of n.keys())u((N=T==null?void 0:T.dataset)==null?void 0:N.lazy).includes(L)&&p(T);return()=>{t.delete(L)}}function I(L=document){!L||typeof L.querySelectorAll!="function"||L.querySelectorAll("[data-lazy]").forEach(M=>v(M))}function Z(){r&&r.disconnect();for(const[L,M]of n.entries())for(const[N,T]of M.entries())if(T.active&&typeof T.cleanup=="function")try{T.cleanup()}catch(k){console.error("[LazyFeatures] Cleanup during disconnect failed",{id:N,error:k})}n.clear(),i=new WeakSet,r=null}return{register:F,observeAll:I,observeElement:v,disconnect:Z}}const mt=lo({threshold:[0,.2],rootMargin:"0px 0px -10% 0px"});function co(e){const t=document.createElement("div");t.dataset.devOverlay="resource-metrics",Object.assign(t.style,{position:"fixed",top:"16px",right:"16px",zIndex:"9999",background:"rgba(0, 0, 0, 0.75)",color:"#fff",padding:"8px 12px",borderRadius:"8px",fontFamily:'SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace',fontSize:"12px",lineHeight:"1.4",pointerEvents:"none",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.35)",minWidth:"160px",whiteSpace:"nowrap",opacity:"0",transition:"opacity 120ms ease-in-out"}),t.hidden=!0;const n=document.createElement("div"),i=document.createElement("div"),r=document.createElement("div");t.appendChild(n),t.appendChild(i),t.appendChild(r);let o=!1,l=!1,a=null;const c=()=>typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now();let u=c(),w=u,g=0,p=0,v=0;const F=1e3/60;function I(){if(o)return;const k=()=>{!document.body||o||(document.body.appendChild(t),o=!0)};document.body?k():document.addEventListener("DOMContentLoaded",k,{once:!0})}function Z(k){const U=k-u;u=k,g+=1,v=v?v*.85+U*.15:U,k-w>=500&&(p=Math.round(g*1e3/(k-w)),g=0,w=k);const H=Math.min(100,Math.max(0,v/F*100)),W=e==null?void 0:e.snapshot(),P=(W==null?void 0:W.total)??0;if(n.textContent=`FPS: ${String(p).padStart(2,"0")}`,i.textContent=`Frame: ${v.toFixed(1)}ms (${H.toFixed(0)}% load)`,W){const _=Object.entries(W.byKind||{}).map(([z,Y])=>`${z}:${Y}`).join(" ");r.textContent=`Resources: ${P}${_?` [${_}]`:""}`}else r.textContent="Resources: n/a"}function L(k){Z(k),l&&(a=requestAnimationFrame(L))}function M(){l||(I(),l=!0,t.hidden=!1,t.style.opacity="1",u=c(),w=u,g=0,a=requestAnimationFrame(L))}function N(){l&&(l=!1,a!==null&&(cancelAnimationFrame(a),a=null),t.style.opacity="0",t.hidden=!0)}function T(){return l?N():M(),l}return{start:M,stop:N,toggle:T,isActive:()=>l,element:t}}function Oe(e){const t=Number.parseFloat(e);return Number.isFinite(t)?t:0}function An(){const e=ft.detectInput(window);return window.DEBUG_MODE_DETECTION&&console.log("[DEBUG] detectInput():",{result:e}),e}function Tn(e){const t=ft.getWidthSources(window,X),n=ft.detectMode(window,X,e);if(window.DEBUG_MODE_DETECTION){let i=null;if(Array.isArray(t)){for(const o of t)if(o&&typeof o.value=="number"&&Number.isFinite(o.value)&&o.value>0){i=o;break}}const r={inputType:e,result:n};i&&(r.width=i.value,r.widthSource=i.source),console.log("[DEBUG] detectMode():",r)}return n}function sn(e=le){const t=(ue==null?void 0:ue.offsetHeight)??0,n=Math.max(0,t+16);X.style.setProperty("--stack-top",`${n}px`);const i=Math.max(0,t+24);X.style.setProperty("--section-scroll-margin",`${i}px`);const r=e instanceof HTMLElement?e:le;if(!(r instanceof HTMLElement)){le=null;return}le=r;const o=window.getComputedStyle(r);let l=r.offsetHeight;o.position==="sticky"?l+=Oe(o.bottom):l+=Oe(o.marginBottom),h.dataset.mode==="mobile"?xn(r):(r.style.removeProperty("--pw-float-left"),r.style.removeProperty("--pw-float-bottom")),l=Math.max(0,Math.round(l)),X.style.setProperty("--pw-footprint",`${l}px`),uo()}let $t=!1,an=null;function uo(){clearTimeout(an),an=setTimeout(()=>{fo()},100)}function fo(){const e=document.querySelector(".stack");if(!e||$t)return;if(!(E==="desktop"||E==="desktop-wide")){Ge&&(e.classList.remove("stack--inline"),Ge=!1);return}const n=document.querySelector(".text-box");if(!n)return;const i=document.documentElement.clientWidth,r=n.getBoundingClientRect(),o=i-r.right,l=window.getComputedStyle(e),a=Oe(l.minWidth)||220,c=20,u=10,w=80,g=a+c+u,p=Ge?g+w:g,v=o<p;console.log("[StackDebug]",{viewportWidth:i,textBoxRight:r.right,availableRight:o,minStackWidth:a,requiredSpace:g,threshold:p,shouldInline:v,lastStackInline:Ge}),v!==Ge&&(e.classList.toggle("stack--inline",v),Ge=v,$t=!0,setTimeout(()=>{$t=!1},250))}let kt=null;function xn(e){var a,c;if(!(e instanceof HTMLElement)||h.dataset.mode!=="mobile")return;const n=[J,K].filter(u=>u instanceof HTMLElement).find(u=>u.getClientRects().length>0&&u.offsetWidth>0);if(!n&&kt){e.style.setProperty("--pw-float-left",`${kt.left}px`),e.style.setProperty("--pw-float-bottom",`${kt.bottom}px`);return}if(!n)return;const i=window.innerWidth||((a=document.documentElement)==null?void 0:a.clientWidth)||0,r=window.innerHeight||((c=document.documentElement)==null?void 0:c.clientHeight)||0,o=n.getBoundingClientRect(),l=window.getComputedStyle(e);if(i>0&&o.width>0){const u=Math.max(e.offsetWidth||0,Oe(l.width)),w=Math.max(0,Math.min(o.left,i-u));e.style.setProperty("--pw-float-left",`${Math.round(w)}px`)}if(r>0){const w=o.top>0?Math.max(10,Math.round(r-o.top+10)):Math.max(10,Math.round(Oe(l.bottom))||10);e.style.setProperty("--pw-float-bottom",`${w}px`)}kt={left:Oe(e.style.getPropertyValue("--pw-float-left")),bottom:Oe(e.style.getPropertyValue("--pw-float-bottom"))}}function ae({force:e=!1,modeChanged:t=!1,viewportChanged:n=!1,elementChanged:i=!1}={}){return!e&&!t&&!n&&!i?!1:(po(),!0)}function po(){if(!We){sn(le),We=!0;return}Se===null&&(Se=requestAnimationFrame(()=>{Se=null,sn(le)}))}function ln(e){return typeof e!="number"||!Number.isFinite(e)?null:Math.round(e*1e3)}function mo(e){if(!e)return!1;const t=ln(e.width),n=ln(e.height);return t===_t&&n===Dt?!1:(_t=t,Dt=n,!0)}function tt(e){const t=mo(e);return t&&(pt=!0),t}function ho(){if(typeof Be.setMode=="function"){const e=E==="mobile"||E==="tablet";Be.setMode(e)}}function Mn(){var l,a;const e=An(),t=Tn(e),n=E,i=se,r=n!==t,o=i!==e;return!r&&!o?{modeChanged:r,inputChanged:o}:(E=t,se=e,h.dataset.mode=t,h.dataset.input=e,ho(),window.DEBUG_MODE_DETECTION&&(r||o)&&console.log("[MODE CHANGE] üîÑ",{mode:{from:n,to:t},input:{from:i,to:e},viewport:{visualViewportWidth:(l=window.visualViewport)==null?void 0:l.width,rootClientWidth:X==null?void 0:X.clientWidth,innerWidth:window.innerWidth,outerWidth:window.outerWidth,screenWidth:(a=window.screen)==null?void 0:a.width}}),r&&(h.classList.remove("is-slid"),Pe.setOpen(!1,{silent:!0}),q&&(q.removeAttribute("role"),q.removeAttribute("aria-modal")),Ot(),pe&&document.body.contains(pe)&&(pe.focus({preventScroll:!0}),pe=null),me&&(Cn(),Wt()),Kt(),In(),h.offsetHeight),Pe.refreshHandles(),tn(),{modeChanged:r,inputChanged:o})}function He(){if(typeof xt=="function")try{xt()}catch(e){console.error("[Observer] Failed to dispose section observer",e)}xt=()=>{},Tt=null,Se!==null&&(cancelAnimationFrame(Se),Se=null)}function Cn(){if(!me){He(),B&&(Me(B),B.hidden=!0);return}if(!B)return;Me(B);const e=(E==="desktop"||E==="desktop-wide")&&$.length>=2;if(B.hidden=!e,!e){He();return}$.forEach(t=>{const n=document.createElement("button");n.type="button",n.className="dots-rail__dot",n.setAttribute("aria-label",t.dataset.section||t.id),n.addEventListener("click",()=>{t.scrollIntoView({behavior:"smooth",block:"start"})}),B.appendChild(n)}),Fn(),_n()}function Fn(){if(He(),!("IntersectionObserver"in window)){console.warn("IntersectionObserver not supported, dots navigation may not update automatically");return}if(E!=="desktop"&&E!=="desktop-wide"||$.length<2)return;const e=(ue==null?void 0:ue.offsetHeight)??0;Tt=new IntersectionObserver(()=>{const t=go(),n=$[t];n&&Bt(n.id)},{root:null,threshold:[0,.25,.5,.75,1],rootMargin:`-${e}px 0px -35% 0px`}),xt=kn(Tt,{label:"section-progress",target:".text-section"}),$.forEach(t=>Tt.observe(t))}function Bt(e){!e||e===Ct||(Ct=e,_n())}function _n(){if(E!=="desktop"&&E!=="desktop-wide"||!B)return;B.querySelectorAll(".dots-rail__dot").forEach((t,n)=>{const i=$[n];if(!i)return;const r=i.id===Ct;t.setAttribute("aria-current",r?"true":"false")})}function go(){let e=0,t=Number.POSITIVE_INFINITY;const n=window.innerHeight||X.clientHeight,i=(ue==null?void 0:ue.offsetHeight)??0,r=Math.max(0,n-i),o=i+r*.35;return $.forEach((l,a)=>{const c=l.getBoundingClientRect();if(c.top<=o&&c.bottom>=o){e=a,t=-1;return}const u=c.top>o?c.top-o:o-c.bottom;u<t&&(t=u,e=a)}),e}function Dn(e){return e?Array.from(e.querySelectorAll('a[href], button:not([disabled]), textarea, input, select, [tabindex]:not([tabindex="-1"])')):[]}function yo(e){if(!(E!=="desktop"&&h.classList.contains("menu-open"))||e.key!=="Tab")return;const n=Dn(R);if(n.length===0){e.preventDefault();return}const i=n[0],r=n[n.length-1];e.shiftKey?document.activeElement===i&&(e.preventDefault(),r.focus()):document.activeElement===r&&(e.preventDefault(),i.focus())}function wo(){st||(st=S(document,"keydown",yo,void 0,{module:"menu.focusTrap"}))}function Ot(){typeof st=="function"&&(st(),st=null)}function It({focusOrigin:e=K}={}){if(!Ke())return!1;if((E==="mobile"||E==="tablet")&&(h.removeAttribute("data-scroll"),Be.suppress(!0)),h.classList.remove("is-slid"),Pe.setOpen(!0),(E==="mobile"||E==="tablet")&&requestAnimationFrame(()=>{h.removeAttribute("data-scroll")}),pe=document.activeElement instanceof HTMLElement?document.activeElement:null,E!=="desktop"){q&&(q.setAttribute("role","dialog"),q.setAttribute("aria-modal","true"));let n=Dn(R).find(i=>i!==e);!n&&q instanceof HTMLElement&&(n=q),n&&typeof n.focus=="function"&&requestAnimationFrame(()=>n.focus({preventScroll:!0})),wo()}return tn(),!0}function Ne({focusOrigin:e=K}={}){return Ke()?(Pe.setOpen(!1),h.classList.remove("is-slid"),q&&(q.removeAttribute("role"),q.removeAttribute("aria-modal")),Ot(),tn(),(E==="mobile"||E==="tablet")&&Be.suppress(!1),pe?(pe.focus({preventScroll:!0}),pe=null):e&&e instanceof HTMLElement&&e.focus({preventScroll:!0}),!0):!1}function cn(e){return Ke()?Pe.isOpen()?Ne({focusOrigin:e}):It({focusOrigin:e}):!1}function tn(){const e=h.classList.contains("menu-open"),t=h.dataset.lock==="scroll";e&&!t?(Yt=window.scrollY||X.scrollTop||0,h.dataset.lock="scroll",X.dataset.lock="scroll",h.style.position="fixed",h.style.inset="0",h.style.width="100%",h.style.top=`-${Yt}px`):!e&&t&&(delete h.dataset.lock,delete X.dataset.lock,h.style.position="",h.style.inset="",h.style.width="",h.style.top="",typeof window.scrollTo=="function"&&window.scrollTo(0,Yt))}function vo(){me&&Cn()}function On(e){if(!e)return;if("scrollBehavior"in document.documentElement.style){e.scrollIntoView({behavior:"smooth",block:"start"});return}const t=e.getBoundingClientRect().top+window.pageYOffset,n=window.pageYOffset,i=t-n,r=600;let o=null;function l(a){o===null&&(o=a);const c=a-o,u=Math.min(c/r,1),w=u<.5?2*u*u:1-Math.pow(-2*u+2,2)/2;window.scrollTo(0,n+i*w),c<r&&requestAnimationFrame(l)}requestAnimationFrame(l)}function bo(e){if(typeof e!="string")return;const t=e.trim();if(!t||t==="#")return;const n=t.startsWith("#")?t:`#${t}`;if(window.location.hash!==n){try{if(typeof history.pushState=="function"){history.pushState(null,"",n);return}}catch(i){console.warn("[MenuLinks] Failed to pushState for hash update",i)}window.location.hash=n}}function Ie(){if(ye.length!==0){for(const e of ye)try{e()}catch(t){console.error("[FLYOUT] Failed to dispose listener",t)}ye=[],typeof V=="function"&&(V(),V=null)}}function Wt(){if(!me){if(typeof j=="function")try{j()}catch(a){console.error("[FLYOUT] Failed to dispose setActiveSection listener during idle state",a)}j=null,Ie(),A&&(Me(A),A.setAttribute("hidden",""),A.classList.add("is-hidden")),en("dotsFlyout.lazy-inactive");return}if(ie("[FLYOUT] initDotsFlyout START",{dotsRail:!!B,dotFlyout:!!A,currentMode:E,sectionsLength:$.length}),jn({mode:E,sections:$.length}),!B||!A){console.error("[FLYOUT] ERROR: dotsRail or dotFlyout not found!",{dotsRail:!!B,dotFlyout:!!A});return}const e=(E==="desktop"||E==="desktop-wide")&&$.length>=2;if(ie("[FLYOUT] Should enable?",{currentMode:E,shouldEnable:e,sectionsCount:$.length,isDesktopOrWide:E==="desktop"||E==="desktop-wide",hasEnoughSections:$.length>=2}),!e){if(ie("[FLYOUT] Disabled - hiding"),A.setAttribute("hidden",""),A.classList.add("is-hidden"),Ie(),typeof j=="function"){try{j()}catch(a){console.error("[FLYOUT] Failed to detach setActiveSection listener while disabling",a)}j=null}return}function t(){Me(A),$.forEach((a,c)=>{var g;const u=document.createElement("button");u.type="button",u.className="dot-flyout__item",u.dataset.index=String(c),u.dataset.sectionId=a.id;const w=a.dataset.section||((g=a.querySelector("h2"))==null?void 0:g.textContent)||`–†–∞–∑–¥–µ–ª ${c+1}`;u.textContent=w.trim(),u.setAttribute("aria-controls",a.id),A.appendChild(u)}),ie("[FLYOUT] Built menu with",$.length,"items")}function n(){ie("[FLYOUT] ‚≠ê showFlyout called!"),typeof V=="function"&&(V(),V=null),A.removeAttribute("hidden"),A.classList.remove("is-hidden"),ie("[FLYOUT] hidden attribute removed and is-hidden class removed")}function i(){ie("[FLYOUT] hideFlyout called"),typeof V=="function"&&(V(),V=null),V=ao(()=>{A.setAttribute("hidden",""),A.classList.add("is-hidden"),V=null,ie("[FLYOUT] hidden attribute set and is-hidden class added")},120,{module:"dotsFlyout",detail:"hide delay"})}function r(a){const c=a.target.closest(".dot-flyout__item");if(!c)return;const u=c.dataset.sectionId,w=document.getElementById(u);w&&(On(w),Bt(u))}function o(a){if(A.hasAttribute("hidden")||A.classList.contains("is-hidden"))return;const c=Array.from(A.querySelectorAll(".dot-flyout__item"));if(c.length===0)return;const u=document.activeElement,w=c.indexOf(u);if(a.key==="ArrowDown"){a.preventDefault();const g=w<c.length-1?w+1:0;c[g].focus()}else if(a.key==="ArrowUp"){a.preventDefault();const g=w>0?w-1:c.length-1;c[g].focus()}else if(a.key==="Escape"&&(a.preventDefault(),i(),B)){const g=B.querySelector(".dots-rail__dot");g&&g.focus()}}function l(){if(A.hasAttribute("hidden")||A.classList.contains("is-hidden"))return;A.querySelectorAll(".dot-flyout__item").forEach(c=>{const u=c.dataset.sectionId===Ct;c.classList.toggle("is-active",u),c.setAttribute("aria-current",u?"true":"false")})}Ie(),t(),ye.push(S(B,"mouseenter",n,void 0,{module:"dotsFlyout",target:C(B)})),ye.push(S(B,"mouseleave",i,void 0,{module:"dotsFlyout",target:C(B)})),ye.push(S(A,"mouseenter",n,void 0,{module:"dotsFlyout",target:C(A)})),ye.push(S(A,"mouseleave",i,void 0,{module:"dotsFlyout",target:C(A)})),ye.push(S(A,"click",r,void 0,{module:"dotsFlyout",target:C(A)})),ye.push(S(document,"keydown",o,void 0,{module:"dotsFlyout",target:"document"})),ie("[FLYOUT] ‚úÖ Event listeners attached successfully!"),ie("[FLYOUT] Try hovering over dots now..."),typeof j=="function"&&j(),j=Zn("dotsFlyout.active-sync",l),G(()=>{try{typeof j=="function"&&j()}catch(a){console.error("[FLYOUT] Failed to dispose setActiveSection listener",a)}j=null},{module:"dotsFlyout",kind:"global",detail:"setActiveSection listener"}),l(),G(()=>{Ie(),A&&(A.setAttribute("hidden",""),A.classList.add("is-hidden"))},{module:"dotsFlyout",kind:"cleanup"})}function Eo(){const e=document.createElement("div");e.style.cssText="backdrop-filter: blur(1px); -webkit-backdrop-filter: blur(1px);";const t=!!e.style.backdropFilter||!!e.style.webkitBackdropFilter;return t?Xt&&console.log("[FEATURE] backdrop-filter supported ‚úì"):(X.classList.add("no-backdrop-filter"),Xt&&console.log("[FEATURE] backdrop-filter not supported, using fallback")),t}function So(){be=null;const{modeChanged:e}=Mn();e&&(me&&(E==="desktop"||E==="desktop-wide")?(Fn(),Wt()):(He(),A&&(A.setAttribute("hidden",""),A.classList.add("is-hidden")),me&&Wt())),ae({force:!We,modeChanged:e,viewportChanged:pt}),pt=!1}function At(){be===null&&(be=requestAnimationFrame(So))}function Lo(){if(K&&S(K,"click",()=>cn(K),void 0,{module:"menu.interactions"}),R&&(S(R,"wheel",t=>{if((t==null?void 0:t.target)instanceof HTMLElement&&R.contains(t.target)){if(q&&typeof t.deltaY=="number"){const n=Math.max(0,q.scrollHeight-q.clientHeight);if(n>0){const i=Math.min(n,Math.max(0,q.scrollTop+t.deltaY));q.scrollTop=i}}t.preventDefault(),t.stopPropagation()}},{passive:!1},{module:"menu.interactions",target:C(R),detail:"scrollIsolation"}),S(R,"mouseenter",()=>{se==="pointer"&&h.classList.add("is-slid")},void 0,{module:"menu.interactions",target:C(R)}),S(R,"mouseleave",()=>{se==="pointer"&&h.classList.remove("is-slid")},void 0,{module:"menu.interactions",target:C(R)}),S(R,"focusin",()=>{se==="pointer"&&h.classList.add("is-slid")},void 0,{module:"menu.interactions",target:C(R)}),S(R,"focusout",t=>{if(se!=="pointer"||h.classList.contains("menu-open"))return;const n=t.relatedTarget;n&&R.contains(n)||h.classList.remove("is-slid")},void 0,{module:"menu.interactions",target:C(R)})),Xe){const e=C(Xe);S(Xe,"mouseenter",()=>{se==="pointer"&&h.classList.remove("is-slid")},void 0,{module:"menu.interactions",target:e}),S(Xe,"focusin",()=>{se==="pointer"&&h.classList.remove("is-slid")},void 0,{module:"menu.interactions",target:e})}J&&S(J,"click",()=>{E==="mobile"&&cn(J)},void 0,{module:"menu.interactions",target:C(J)}),it&&S(it,"click",()=>{if(!h.classList.contains("menu-open"))return;Ne({focusOrigin:E==="mobile"?J:K})},void 0,{module:"menu.interactions",target:C(it)}),rt&&S(rt,"click",()=>{E==="mobile"&&h.classList.contains("menu-open")&&Ne({focusOrigin:J})},void 0,{module:"menu.interactions",target:C(rt)}),S(document,"keydown",e=>{e.key==="Escape"&&h.classList.contains("menu-open")&&(e.preventDefault(),Ne({focusOrigin:E==="mobile"?J:K}))},void 0,{module:"menu.interactions",target:"document"}),G(()=>{h.classList.remove("is-slid")},{module:"menu.interactions",kind:"state-reset"})}function In(){if(E!=="tablet"||!Ke()||at)return;const e=30;Vt=t=>{E==="tablet"&&t.clientX<=e&&!h.classList.contains("menu-open")&&It({focusOrigin:K})},at=S(document,"click",Vt,void 0,{module:"menu.edgeGesture",target:"document"})}function Kt(){typeof at=="function"&&(at(),at=null),Vt=null}function ko(){if(se!=="touch"||!Ke()||De.length>0)return;let e=0,t=0,n=0,i=0,r=!1,o=null,l=!1,a=!1;const c=60,u=80,w=80,g=50,p=120,v=15;function F(T){e=T.changedTouches[0].clientX,t=T.changedTouches[0].clientY,r=!1,o=null,l=!1;const k=T.target;a=k&&(k.classList.contains("menu-rail__cap")||k.closest(".menu-rail__cap"))}function I(T){if(!r){const k=Math.abs(T.changedTouches[0].clientX-e),U=Math.abs(T.changedTouches[0].clientY-t);if(k>v||U>v){r=!0,o=k>U?"horizontal":"vertical";const H=T.changedTouches[0].clientX,W=T.changedTouches[0].clientY,P=H-e,_=W-t,z=window.innerHeight;if(E==="mobile"&&o==="vertical"){const Y=_<0&&t>z-w&&!h.classList.contains("menu-open"),Ce=_>0&&h.classList.contains("menu-open")&&(a||t<p);l=Y||Ce}if(E==="tablet"&&o==="horizontal"){const Y=P>0&&e<=g&&!h.classList.contains("menu-open"),Ce=P<0&&h.classList.contains("menu-open");l=Y||Ce}}}l&&T.preventDefault()}function Z(T){n=T.changedTouches[0].clientX,i=T.changedTouches[0].clientY,l&&L(),r=!1,o=null,l=!1,a=!1}function L(){const T=n-e,k=i-t,U=window.innerHeight;if(E==="mobile"){if(k<-c&&t>U-w&&!h.classList.contains("menu-open")){It({focusOrigin:J});return}if(k>u&&h.classList.contains("menu-open")&&(a||t<p)){Ne({focusOrigin:J});return}}if(E==="tablet"){if(T>c&&e<=g&&!h.classList.contains("menu-open")){It({focusOrigin:K});return}if(T<-u&&h.classList.contains("menu-open")){Ne({focusOrigin:K});return}}}const M=h||document.documentElement||document,N=C(M)||"body";De.push(S(M,"touchstart",F,{passive:!0},{module:"menu.swipes",target:N})),De.push(S(M,"touchmove",I,{passive:!1},{module:"menu.swipes",target:N})),De.push(S(M,"touchend",Z,{passive:!0},{module:"menu.swipes",target:N})),G(()=>{Zt()},{module:"menu.swipes",kind:"cleanup"})}function Zt(){if(De.length!==0){for(const e of De)try{e()}catch(t){console.error("[MenuSwipes] Failed to dispose listener",t)}De=[]}}function Ao(){if(!R||!Ke())return;const e=R.querySelectorAll('a[href^="#"]');if(e.length===0)return;const t=[];e.forEach(n=>{const i=r=>{if(r.defaultPrevented||r.button!==0||r.metaKey||r.ctrlKey||r.shiftKey||r.altKey)return;r.preventDefault();const o=n.getAttribute("href");if(!o||o==="#")return;const l=document.querySelector(o);l instanceof HTMLElement&&(On(l),bo(o),l.id&&Bt(l.id)),(E==="mobile"||E==="tablet")&&Ne({focusOrigin:E==="mobile"?J:K})};t.push(S(n,"click",i,void 0,{module:"menu.links",target:C(n)}))}),G(()=>{for(;t.length;){const n=t.pop();try{n()}catch(i){console.error("[MenuLinks] Failed to dispose listener",i)}}},{module:"menu.links",kind:"cleanup"})}function To(){const e=document.querySelector(".stack");if(!e)return;const t=e.querySelector("[data-stack-deck]");if(!t)return;const n=e.querySelector("[data-stack-mobile-hint]"),i=Array.from(e.querySelectorAll("[data-stack-prev], [data-stack-next]")),r="/shared/recommendations.json",o=4e3;let l=[],a=[],c=0,u=!1,w=null,g=null;const p=new Set,v=[],F=[];let I=!1;const Z=N(t);k(Z),fetch(r).then(s=>{if(!s.ok)throw new Error(`HTTP ${s.status}`);return s.json()}).then(s=>{const d=Array.isArray(s)?s.map((y,b)=>M(y,b)):[];d.length>0?k(d):ae({elementChanged:!0})}).catch(s=>{console.warn("[StackCarousel] –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:",s),ze(),ae({elementChanged:!0})});function L(s){return typeof s!="string"?"":s.trim()}function M(s,d){if(!s)return null;const y=(s.title||s.name||"").trim(),b=(s.description||s.excerpt||"").trim(),x=typeof s.slug=="string"?s.slug:"",O=typeof s.url=="string"&&s.url?s.url:x?`/recommendations/${x}.html`:"";return{id:x||s.id||`card-${d}`,slug:x,title:y||x||"–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è",description:b||"",cover:L(s.cover||s.image||""),url:O}}function N(s){if(!s)return[];const d=Array.from(s.querySelectorAll("[data-stack-card]"));return d.length?d.map((y,b)=>{var x,O,ee;return M({id:y.dataset.cardId||y.dataset.slug,slug:y.dataset.slug,title:y.dataset.title||((x=y.querySelector(".stack-card__title"))==null?void 0:x.textContent),description:y.dataset.description||((O=y.querySelector(".stack-card__description"))==null?void 0:O.textContent),cover:y.dataset.cover||((ee=y.querySelector(".stack-card__emoji"))==null?void 0:ee.textContent),url:y.dataset.url||(y instanceof HTMLAnchorElement?y.getAttribute("href"):"")},b)}).filter(Boolean):[]}function T(){for(;F.length;){const s=F.pop();try{s==null||s()}catch(d){console.error("[StackCarousel] Failed to dispose card listener",d)}}}function k(s){if(T(),Me(t),l=Array.isArray(s)?s.map((y,b)=>M(y,b)).filter(Boolean):[],a=[],!l.length){e.classList.add("stack--empty"),e.style.display="none",Re();return}e.classList.remove("stack--empty"),e.style.display="",l.forEach((y,b)=>{const x=H(y,b);a.push(x),t.appendChild(x)}),c=0,w=null,u=!1,Y(),ze(),ae({elementChanged:!0})}function U(s){const d=document.createElement("div");d.className="stack-card__cover";const y=L(s.cover);if(!y){const O=document.createElement("span");return O.className="stack-card__emoji",O.textContent="‚ú®",d.appendChild(O),d}if(/^https?:\/\//i.test(y)||y.startsWith("/")){const O=document.createElement("img");return O.src=y,O.alt=s.title||"–ò–ª–ª—é—Å—Ç—Ä–∞—Ü–∏—è",O.loading="lazy",d.classList.add("stack-card__cover--image"),d.appendChild(O),d}const x=document.createElement("span");return x.className="stack-card__emoji",x.textContent=y,d.appendChild(x),d}function H(s,d){const y=!!s.url,b=document.createElement(y?"a":"div");b.className="stack-card",y&&(b.href=s.url),b.dataset.cardId=s.id||`card-${d}`,b.setAttribute("data-analytics","recommendation-card");const x=document.createElement("div");x.className="stack-card__inner",x.appendChild(U(s));const O=document.createElement("h3");O.className="stack-card__title",O.textContent=s.title||"–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è",x.appendChild(O);const ee=document.createElement("div");ee.className="stack-card__meta";const ke=document.createElement("span");ke.className="stack-card__bar";const ge=document.createElement("p");return ge.className="stack-card__description",ge.textContent=s.description||"",ee.appendChild(ke),ee.appendChild(ge),x.appendChild(ee),b.appendChild(x),W(b,d),b}function W(s,d){F.push(S(s,"mouseenter",()=>{var y;!de()||ne()||(w=((y=l[d])==null?void 0:y.id)||s.dataset.cardId||"",Y())},void 0,{module:"stackCarousel",target:C(s)})),F.push(S(s,"mouseleave",()=>{!de()||ne()||(w=null,Y())},void 0,{module:"stackCarousel",target:C(s)})),F.push(S(s,"click",y=>{P(y,d,s)},void 0,{module:"stackCarousel",target:C(s)}))}function P(s,d,y){if(!a.length)return;if(!(z(d)===0)){s.preventDefault(),_(d);return}y instanceof HTMLAnchorElement&&typeof y.href=="string"&&y.href.length>0||(s.preventDefault(),_(c+1))}function _(s,d={}){const{fromAutoplay:y=!1}=d;if(!a.length)return;const b=a.length,x=(s%b+b)%b;x===c&&y||(c=x,Y(),y||ze())}function z(s){const d=a.length;return d?(s-c+d)%d:0}function Y(){const s=ne(),d=de();(!d||s)&&(u=!1,w=null),e.classList.toggle("stack--mobile",s),e.classList.toggle("stack--hover",u&&d&&!s),e.classList.toggle("stack--expanded",u&&d&&!s),n&&(n.hidden=!s);const y=a.length;fe(y<=1),a.forEach((b,x)=>{const O=Ce(x,s);Ut(b,O),b.dataset.active=O.offset===0?"true":"false"})}function Ce(s,d){var D;const y=a.length;if(!y)return{pointerEvents:"none",offset:0};const b=z(s),x=d?0:14,O=d?24:0,ee=.05,ke=b*x,ge=b*O,Ht=1-b*ee,zt=d?0:Math.max(0,(b-1)*x),wt=d?Math.max(0,(b-1)*O):0,vt=Math.min(1,1-(b-1)*ee),Je=u&&((D=l[s])==null?void 0:D.id)===w,f={"--x-from":`${ge}px`,"--y-from":`${ke}px`,"--x-to":`${wt}px`,"--y-to":`${zt}px`,"--s-from":`${Ht}`,"--s-to":`${vt}`,"--z-start":`-${b}px`,"--z-end":`-${Math.max(0,b-1)}px`};let m={offset:b,vars:f,zIndex:Je?100:50-b,pointerEvents:b===0||u&&!d?"auto":"none",opacity:"",transform:"",transition:"",animation:"",boxShadow:""};if(d)if(b===0)m.transform="translate3d(0, 0, 0) scale(1)",m.opacity=1,m.animation="none";else if(b===y-1)m.zIndex=60,m.animation="flyOutMobile 800ms cubic-bezier(0.32, 0.72, 0, 1) forwards";else{const Q=c%2===0?"stackApproachEven":"stackApproachOdd";m.zIndex=40-b,m.animation=`${Q} var(--stack-animation-duration) linear forwards`}else if(u){const Q=`calc(${b} * ((100vh - 460px) / 3))`;m.transform=`translate3d(0, ${Q}, 0) scale(1)`,m.opacity=1,m.transition="transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94), box-shadow 0.3s ease",m.boxShadow=Je?"0 30px 60px -12px rgba(0,0,0,0.25)":"0 10px 40px -10px rgba(0,0,0,0.05)"}else if(b===0)m.transform="translate3d(0, 0, 0) scale(1)",m.opacity=1,m.transition="none";else{const Q=c%2===0?"stackRiseEven":"stackRiseOdd";m.animation=`${Q} var(--stack-animation-duration) linear forwards`}return m}function Ut(s,d){d.vars&&Object.entries(d.vars).forEach(([b,x])=>{s.style.setProperty(b,x)}),s.style.zIndex=d.zIndex!=null?String(d.zIndex):"",s.style.pointerEvents=d.pointerEvents||"auto",s.style.opacity=d.opacity!==""?String(d.opacity):"",s.style.transform=d.transform||"",s.style.transition=d.transition||"",s.style.boxShadow=d.boxShadow||"";const y=d.animation&&d.animation!=="none";s.style.animation="none",y&&(s.offsetWidth,s.style.animation=d.animation)}function Ze(){Re(),!(p.size>0||a.length<=1)&&(g=Ln(()=>{_(c+1,{fromAutoplay:!0})},o,{module:"stackCarousel",detail:"autoplay"}))}function ze(){Ze()}function Re(){g&&(g(),g=null)}function Fe(s){!s||p.has(s)||(p.add(s),Re())}function he(s){!s||!p.has(s)||(p.delete(s),Ze())}function ne(){return E==="mobile"||E==="tablet"||(e==null?void 0:e.classList.contains("stack--inline"))}function de(){return se==="pointer"}function fe(s){i.forEach(d=>{d instanceof HTMLButtonElement&&(d.disabled=s,d.setAttribute("aria-disabled",s?"true":"false"))})}const ce=()=>{requestAnimationFrame(()=>Y())};v.push(S(t,"mouseenter",()=>{!de()||ne()||(u=!0,Fe("hover"),Y())},void 0,{module:"stackCarousel",target:C(t)})),v.push(S(t,"mouseleave",()=>{!de()||ne()||(u=!1,w=null,he("hover"),Y())},void 0,{module:"stackCarousel",target:C(t)}));let Le=0,Ye=0,oe=null;const qe=50,Qe=10;v.push(S(t,"touchstart",s=>{!s.changedTouches||!s.changedTouches.length||(Le=s.changedTouches[0].clientX,Ye=s.changedTouches[0].clientY,oe=null,Fe("touch"))},{passive:!0},{module:"stackCarousel",target:C(t)})),v.push(S(t,"touchmove",s=>{if(ne()){if(!oe){const d=Math.abs(s.changedTouches[0].clientX-Le),y=Math.abs(s.changedTouches[0].clientY-Ye);(d>Qe||y>Qe)&&(oe=d>y?"horizontal":"vertical")}oe==="horizontal"&&s.preventDefault()}},{passive:!1},{module:"stackCarousel",target:C(t)})),v.push(S(t,"touchend",s=>{if(!s.changedTouches||!s.changedTouches.length){he("touch");return}if(ne()&&oe==="horizontal"){const d=s.changedTouches[0].clientX,y=Le-d;Math.abs(y)>=qe&&_(y>0?c+1:c-1)}oe=null,he("touch")},{passive:!0},{module:"stackCarousel",target:C(t)})),v.push(S(t,"touchcancel",()=>{oe=null,he("touch")},{passive:!0},{module:"stackCarousel",target:C(t)})),i.forEach(s=>{const d=s.hasAttribute("data-stack-next");v.push(S(s,"click",y=>{y.preventDefault(),!s.disabled&&_(d?c+1:c-1)},void 0,{module:"stackCarousel",target:C(s)}))}),v.push(S(window,"resize",ce,void 0,{module:"stackCarousel",target:"window"})),v.push(S(window,"orientationchange",ce,void 0,{module:"stackCarousel",target:"window"})),Y(),ze();const yt=()=>{if(!I)for(I=!0,Re(),p.clear(),T();v.length;){const s=v.pop();try{s()}catch(d){console.error("[StackCarousel] Failed to dispose listener",d)}}},$e=G(()=>{yt()},{module:"stackCarousel",kind:"cleanup"});return()=>{yt();try{$e==null||$e()}catch(s){console.error("[StackCarousel] Failed to deregister lifecycle cleanup",s)}}}function xo(){let e=window.pageYOffset||document.documentElement.scrollTop,t=!1;const n=10,i=100;let r=E==="mobile"||E==="tablet",o=!1,l=null;const a=()=>{e=window.pageYOffset||document.documentElement.scrollTop},c=()=>{h.hasAttribute("data-scroll")&&h.removeAttribute("data-scroll")};function u(){if(!r){c(),t=!1,a();return}if(o||h.classList.contains("menu-open")){c(),t=!1,a();return}const F=window.pageYOffset||document.documentElement.scrollTop,I=F-e;if(Math.abs(I)<n){t=!1;return}I>0&&F>i?h.dataset.scroll!=="down"&&(h.dataset.scroll="down"):I<0&&h.dataset.scroll!=="up"&&(h.dataset.scroll="up"),F<=i&&h.removeAttribute("data-scroll"),e=F,t=!1}function w(){t||(requestAnimationFrame(u),t=!0)}function g(F){const I=!!F;if(r===I){I||(c(),a());return}r=I,c(),a(),r||(o=!1)}function p(F){const I=!!F;if(o===I){I&&(c(),a());return}o=I,c(),a()}function v(){typeof l=="function"&&(l(),l=null),c(),t=!1}l=S(window,"scroll",w,{passive:!0},{module:"scroll.hideHeader",target:"window"}),Be={suppress:p,setMode:g,detach:v},g(r),G(()=>{v(),Be={suppress:()=>{},setMode:()=>{},detach:()=>{}}},{module:"scroll.hideHeader",kind:"cleanup"})}function Mo(){const e=Jn(),t=to(e.element),n=e.element,i=t.element,r=t.mode==="document"||i===window;e.matchedTextBox||console.warn("[ProgressWidget] .text-box not found, using fallback container",{selector:e.selector,scrollMode:t.mode});let o=le instanceof HTMLElement?le:document.getElementById("pw-root");o||(o=document.createElement("aside"),o.id="pw-root",o.setAttribute("role","button"),o.setAttribute("tabindex","0"),o.setAttribute("aria-disabled","true"),o.setAttribute("aria-label","–ü—Ä–æ–≥—Ä–µ—Å—Å —á—Ç–µ–Ω–∏—è: 0%")),le=o;let l=n.querySelector(".pw-slot"),a=!1;l||(l=document.createElement("div"),l.className="pw-slot",n.appendChild(l),a=!0);const c=document.body.contains(l)?l:document.body.contains(n)?n:document.body;o.parentElement!==c?c.appendChild(o):c.contains(o)||c.appendChild(o),o.dataset.pwContainer=e.selector,o.dataset.pwScrollMode=t.mode;const u=(l==null?void 0:l.dataset.buttonText)||(n==null?void 0:n.dataset.buttonText)||"–î–∞–ª–µ–µ";Me(o);const w=document.createElement("div");w.className="pw-visual";const g=document.createElement("div");g.className="pw-dot";const p=document.createElement("div");p.className="pw-pill";const v=document.createElement("div");v.className="pw-pct";const F=document.createElement("span");F.id="pwPct",F.textContent="0%",v.appendChild(F);const I=document.createElement("div");I.className="pw-next",I.textContent=u,w.appendChild(g),w.appendChild(p),w.appendChild(v),w.appendChild(I),o.appendChild(w);const Z=v,L=I,M=typeof window.matchMedia=="function"?window.matchMedia("(prefers-reduced-motion: reduce)").matches:!1,N=95;function T(f){return f<0?0:f>1?1:f}function k(){const f=n.getBoundingClientRect(),m=window.innerHeight,D=Math.max(n.scrollHeight,f.height)-m;if(D<=0)return 1;const Q=Math.min(Math.max(-f.top,0),D);return T(Q/D)}function U(){const f=Math.max(i.scrollHeight,n.scrollHeight)-i.clientHeight;if(f<=0)return 1;const m=i.scrollTop;return T(m/f)}function H(){return r?k():U()}function W(){const f=document.querySelector(".text-box"),m=(f==null?void 0:f.dataset.nextPage)||document.body.dataset.nextPage||o.getAttribute("data-next-url");if(m&&m!=="#")return m;const D=document.querySelector("link[rel=next][href]");if(D)return D.getAttribute("href");const Q=document.querySelector("a[rel=next][href], a.next[href], nav .next a[href]");if(Q)return Q.getAttribute("href");const bt=Array.from(document.querySelectorAll("a[href]")),et=["–¥–∞–ª–µ–µ","—Å–ª–µ–¥—É—é—â–∞—è","—Å–ª–µ–¥—É—é—â–∏–π","next","more"];for(const _e of bt){const Et=(_e.textContent||"").trim().toLowerCase();if(Et&&et.some(Rt=>Et.includes(Rt)))return _e.getAttribute("href")}return"#"}const P=W(),_=document.querySelector("article[data-page-type]"),z=(_==null?void 0:_.dataset.pageType)||"unknown",Y=z==="free"||z==="intro-free",Ce=z==="recommendation",Ut=z==="premium"||z==="intro-premium";Y&&o.setAttribute("data-free-version","true");const Ze="toosmart_last_premium_position";function ze(){if(Ut&&typeof localStorage<"u")try{localStorage.setItem(Ze,window.location.pathname)}catch(f){console.warn("[ProgressWidget] –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–æ–∑–∏—Ü–∏—é:",f)}}function Re(){if(Ce&&typeof localStorage<"u")try{const f=localStorage.getItem(Ze);if(f&&f.includes("/premium/"))return f}catch(f){console.warn("[ProgressWidget] –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –ø–æ–∑–∏—Ü–∏—é:",f)}return P}let Fe=null,he=null,ne=null,de=null,fe=!1,ce=!1,Le=null,Ye=!1;const oe="cubic-bezier(0.25, 0.6, 0.4, 1)",qe="cubic-bezier(0.7, 0, 0.25, 1)";function Qe(f){return typeof f!="string"?[]:f.split(",").map(m=>m.trim()).map(m=>{if(m.endsWith("ms"))return parseFloat(m);if(m.endsWith("s"))return parseFloat(m)*1e3;const D=parseFloat(m);return Number.isFinite(D)?D:0}).filter(m=>Number.isFinite(m)&&m>=0)}function yt(f){if(!(f instanceof HTMLElement))return null;const m=window.getComputedStyle(f),D=Qe(m.transitionDuration),Q=Qe(m.transitionDelay),bt=Math.max(D.length,Q.length);if(!bt)return null;let et=0;for(let _e=0;_e<bt;_e+=1){const Et=D[_e%D.length]??0,Rt=Q[_e%Q.length]??0;et=Math.max(et,Et+Rt)}return et}function $e(){return h.dataset.mode==="mobile"}function s(){$e()?o.classList.add("is-floating"):o.classList.remove("is-floating")}s();function d(){h.classList.contains("menu-open")?o.classList.add("is-menu-covered"):o.classList.remove("is-menu-covered")}d();let y=()=>{};if(typeof MutationObserver=="function"){const f=new MutationObserver(m=>{for(const D of m)if(D.attributeName==="class"){d();break}});f.observe(h,{attributes:!0,attributeFilter:["class"]}),y=kn(f,{module:"progressWidget",target:"body[class] mutation"})}else{let f=h.classList.contains("menu-open");y=Ln(()=>{const D=h.classList.contains("menu-open");D!==f&&(f=D,d())},250,{module:"progressWidget",target:"body[class] poll"})}function b(){for(const f of[Fe,he,ne,de])try{f&&f.cancel()}catch{}Fe=he=ne=de=null}function x(f){const m=!!f;Z.style.opacity=m?"0":"1",L.style.opacity=m?"1":"0"}function O(){const f="translate(var(--pw-dot-translate-x), -50%)",m="translate(var(--pw-dot-translate-x), -50%)",D="translate(var(--pw-dot-translate-x), calc(-50% + 8px))";if(M){g.style.opacity="0",p.style.opacity="1",p.style.transform="translate(-50%,-50%) scaleX(1)",x(!0),Z.style.transform=D,L.style.transform="translateY(0)",L.style.letterSpacing="0px";return}b(),Fe=g.animate([{transform:`${f} scale(1)`,opacity:1},{transform:`${f} scale(1.08)`,opacity:.85,offset:.18},{transform:`${f} scale(0.82)`,opacity:.45,offset:.48},{transform:`${f} scale(0.6)`,opacity:0}],{duration:500,easing:oe,fill:"forwards"}),he=p.animate([{transform:"translate(-50%,-50%) scaleX(0.001)",opacity:0},{transform:"translate(-50%,-50%) scaleX(0.72)",opacity:1,offset:.42},{transform:"translate(-50%,-50%) scaleX(1.08)",opacity:1,offset:.72},{transform:"translate(-50%,-50%) scaleX(1)",opacity:1}],{duration:500,easing:oe,fill:"forwards"}),ne=Z.animate([{transform:m,offset:0},{transform:D,offset:.45}],{duration:500,easing:oe,fill:"forwards"}),de=L.animate([{transform:"translateY(8px)",letterSpacing:"0.4px",offset:.55},{transform:"translateY(0)",letterSpacing:"0px",offset:1}],{duration:500,easing:oe,fill:"forwards"})}function ee(){const f="translate(var(--pw-dot-translate-x), -50%)",m="translate(var(--pw-dot-translate-x), -50%)",D="translate(var(--pw-dot-translate-x), calc(-50% - 6px))";if(M){g.style.opacity="1",g.style.transform=`${f} scale(1)`,p.style.opacity="0",p.style.transform="translate(-50%,-50%) scaleX(0.001)",Z.style.opacity="1",Z.style.transform=m,L.style.opacity="0",L.style.transform="translateY(6px)",L.style.letterSpacing="0.4px";return}b(),Fe=g.animate([{transform:`${f} scale(0.62)`,opacity:0},{transform:`${f} scale(0.92)`,opacity:.55,offset:.28},{transform:`${f} scale(1.04)`,opacity:.85,offset:.58},{transform:`${f} scale(1)`,opacity:1}],{duration:500,easing:qe,fill:"forwards"}),he=p.animate([{transform:"translate(-50%,-50%) scaleX(1)",opacity:1},{transform:"translate(-50%,-50%) scaleX(0.66)",opacity:1,offset:.32},{transform:"translate(-50%,-50%) scaleX(0.001)",opacity:0}],{duration:500,easing:qe,fill:"forwards"}),ne=Z.animate([{transform:D,offset:.35},{transform:m,offset:.8}],{duration:500,easing:qe,fill:"forwards"}),de=L.animate([{transform:"translateY(0)",letterSpacing:"0px",offset:0},{transform:"translateY(6px)",letterSpacing:"0.4px",offset:.3}],{duration:500,easing:qe,fill:"forwards"})}function ke(){Le!==null&&(clearTimeout(Le),Le=null)}function ge(){fe||(ce=!1,ke(),fe=!0,x(!0),o.classList.remove("is-centering"),o.classList.add("is-done"),o.setAttribute("aria-disabled","false"),o.setAttribute("aria-label","–ö–Ω–æ–ø–∫–∞: –î–∞–ª–µ–µ"),O(),ae({elementChanged:!0}))}function Ht(f){if(fe){o.setAttribute("aria-disabled","false"),o.setAttribute("aria-label","–ö–Ω–æ–ø–∫–∞: –î–∞–ª–µ–µ");return}if($e()){if(ce)return;ce=!0,o.classList.add("is-centering"),o.classList.remove("is-done"),o.setAttribute("aria-disabled","true"),o.setAttribute("aria-label","–ü—Ä–æ–≥—Ä–µ—Å—Å —á—Ç–µ–Ω–∏—è: "+f+"%"),ae({elementChanged:!0}),ke();const m=M?0:yt(o)??500;m===0?requestAnimationFrame(()=>ge()):Le=window.setTimeout(()=>{ce&&ge()},Math.max(0,Math.round(m+40)));return}fe=!0,x(!0),o.classList.remove("is-centering"),o.classList.add("is-done"),o.setAttribute("aria-disabled","false"),o.setAttribute("aria-label","–ö–Ω–æ–ø–∫–∞: –î–∞–ª–µ–µ"),O(),ae({elementChanged:!0})}function zt(f){if(!fe&&!ce&&!o.classList.contains("is-centering")){o.setAttribute("aria-disabled","true"),o.setAttribute("aria-label","–ü—Ä–æ–≥—Ä–µ—Å—Å —á—Ç–µ–Ω–∏—è: "+f+"%");return}const m=fe||ce||o.classList.contains("is-centering");ce=!1,ke(),fe=!1,x(!1),o.classList.remove("is-done","is-centering"),o.setAttribute("aria-disabled","true"),o.setAttribute("aria-label","–ü—Ä–æ–≥—Ä–µ—Å—Å —á—Ç–µ–Ω–∏—è: "+f+"%"),m&&(ee(),ae({elementChanged:!0}))}S(o,"transitionend",f=>{ce&&f.target===o&&(f.propertyName!=="left"&&f.propertyName!=="transform"||ge())},void 0,{module:"progressWidget",target:C(o)});function wt(){Ye||(Ye=!0,requestAnimationFrame(vt))}function vt(){Ye=!1,s();const f=H(),m=Math.round(f*100);if(F.textContent=m+"%",m>=N){Ht(m);return}zt(m)}S(o,"click",f=>{if(fe)if(Y&&typeof window.openPaymentModal=="function")f.preventDefault(),window.openPaymentModal();else{const m=Re();m&&m!=="#"?(ze(),window.location.href=m):console.warn("Progress Widget: —Å–ª–µ–¥—É—é—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞")}else if(r){const m=n.getBoundingClientRect(),D=window.scrollY+(m.bottom-window.innerHeight+1);window.scrollTo({top:D,behavior:"smooth"})}else{const m=Math.max(i.scrollHeight-i.clientHeight,0);typeof i.scrollTo=="function"?i.scrollTo({top:m,behavior:"smooth"}):i.scrollTop=m}},{passive:!1},{module:"progressWidget",target:C(o)}),S(o,"keydown",f=>{(f.key==="Enter"||f.key===" ")&&(f.preventDefault(),o.click())},void 0,{module:"progressWidget",target:C(o)}),S(window,"scroll",wt,{passive:!0},{module:"progressWidget",target:"window"}),!r&&i&&i!==window&&S(i,"scroll",wt,{passive:!0},{module:"progressWidget",target:C(i)}),g.style.opacity="1",p.style.opacity="0",p.style.transform="translate(-50%,-50%) scaleX(0.001)",x(!1),xn(o),vt(),ae({elementChanged:!0});const Je=G(()=>{b();try{y()}catch(f){console.error("[ProgressWidget] Failed to disconnect menu observer",f)}if(o.classList.remove("is-done","is-menu-covered","is-floating","is-centering"),o.isConnected&&typeof o.remove=="function"?o.remove():o.parentElement&&o.parentElement.removeChild(o),le=null,a&&l&&l.parentElement)try{l.remove()}catch{l.parentElement.removeChild(l)}},{module:"progressWidget",kind:"cleanup"});return()=>{if(typeof Je=="function")try{Je()}catch(f){console.error("[ProgressWidget] Failed to dispose via lazy cleanup",f)}}}function Co(){if(me)return()=>{};nn(),me=!0;try{vo(),Wt()}catch(e){console.error("[LazyFeatures] Failed to initialize dots navigation",e)}return()=>{me=!1;try{He()}catch(e){console.error("[LazyFeatures] Failed to teardown section observer",e)}if(typeof j=="function")try{j()}catch(e){console.error("[LazyFeatures] Failed to dispose flyout listener",e)}j=null,Ie(),A&&(Me(A),A.setAttribute("hidden",""),A.classList.add("is-hidden")),B&&(Me(B),B.hidden=!0),en("dotsFlyout.lazy-cleanup")}}function Fo(){if(typeof we=="function")return()=>{};let e=null;try{e=To()}catch(t){console.error("[LazyFeatures] Failed to initialize stack carousel",t),e=null}return typeof e=="function"?(we=e,()=>{if(typeof we=="function")try{we()}catch(t){console.error("[LazyFeatures] Failed to cleanup stack carousel",t)}we=null}):(we=null,()=>{})}function _o(){if(typeof ve=="function")return()=>{};const e=document.querySelector("article[data-page-type]"),t=(e==null?void 0:e.dataset.pageType)||"unknown",n=!!document.querySelector(".premium-teaser");if(t==="free"||t==="paywall"||n)return()=>{};nn();let r=null;try{r=Mo()}catch(o){console.error("[LazyFeatures] Failed to initialize progress widget",o),r=null}return typeof r=="function"?(ve=r,()=>{if(typeof ve=="function")try{ve()}catch(o){console.error("[LazyFeatures] Failed to cleanup progress widget",o)}ve=null}):(ve=null,()=>{})}mt.register("dots-nav",{onEnter:()=>Co()});mt.register("stack-carousel",{sticky:!0,onEnter:()=>Fo()});mt.register("progress-widget",{sticky:!0,onEnter:()=>_o()});function nn(){R||(R=document.querySelector(".menu-rail")),ue||(ue=document.querySelector(".header")),K||(K=document.querySelector(".menu-handle")),q||(q=document.querySelector(".site-menu")),it||(it=document.querySelector(".backdrop")),J||(J=document.querySelector(".dock-handle")),Xe||(Xe=document.querySelector(".panel")),rn||(rn=document.querySelector(".main")),B||(B=document.querySelector(".dots-rail")),A||(A=document.querySelector(".dot-flyout")),rt||(rt=document.querySelector(".menu-rail__cap")),le||(le=document.getElementById("pw-root")),$.length===0&&$.push(...Array.from(document.querySelectorAll(".text-section")))}function Do(){nn(),Eo();const e=Mn();if(Lo(),In(),ko(),xo(),Ao(),mt.observeAll(),ae({force:!We,modeChanged:e==null?void 0:e.modeChanged}),S(window,"resize",()=>{tt(window.visualViewport),At()},void 0,{module:"layout.mode",target:"window"}),(()=>{if(Lt)return window.DEBUG_MODE_DETECTION&&console.log("[layout.mode] visualViewport listeners already bound, skipping duplicate subscription"),!0;const r=window.visualViewport;return!r||typeof r.addEventListener!="function"?(window.DEBUG_MODE_DETECTION&&console.log("[layout.mode] visualViewport unsupported, relying on window resize/orientation listeners"),!1):(Lt=!0,tt(r),S(r,"resize",()=>{tt(r)&&At()},void 0,{module:"layout.mode",target:"visualViewport"}),window.DEBUG_MODE_DETECTION&&console.log("[layout.mode] visualViewport listeners attached"),!0)})(),S(window,"orientationchange",()=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{tt(window.visualViewport),At()})})},void 0,{module:"layout.mode",target:"window"}),window.matchMedia){const r=window.matchMedia("(min-width: 1024px)"),o=window.matchMedia("(min-width: 1280px)"),l=window.matchMedia("(min-width: 1440px)"),a=()=>{requestAnimationFrame(()=>{tt(window.visualViewport),At()})};qt(r,a,{module:"layout.mode",query:"(min-width: 1024px)"}),qt(o,a,{module:"layout.mode",query:"(min-width: 1280px)"}),qt(l,a,{module:"layout.mode",query:"(min-width: 1440px)"})}return G(He,{module:"sections.observer"}),G(()=>{typeof V=="function"&&(V(),V=null)},{module:"dotsFlyout",detail:"cancel hide timeout"}),G(()=>{Kt(),Zt(),Ot(),Ie()},{module:"menu.lifecycle",kind:"detach"}),G(()=>{pe=null,Pe.setOpen(!1,{silent:!0}),h.classList.remove("is-slid"),h.removeAttribute("data-scroll"),delete h.dataset.lock,delete X.dataset.lock,Pe.refreshHandles()},{module:"menu.lifecycle",kind:"state-reset"}),G(()=>{Se!==null&&(cancelAnimationFrame(Se),Se=null),be!==null&&(cancelAnimationFrame(be),be=null),_t=null,Dt=null,Lt=!1,pt=!1,We=!1},{module:"layout.metrics",kind:"raf"}),r=>{if(mt.disconnect(),Kt(),Zt(),Ot(),Ie(),be!==null&&(cancelAnimationFrame(be),be=null),_t=null,Dt=null,Lt=!1,pt=!1,We=!1,typeof we=="function")try{we()}catch(o){console.error("[Lifecycle] Failed to cleanup stack carousel",{error:o,reason:r})}if(we=null,typeof ve=="function")try{ve()}catch(o){console.error("[Lifecycle] Failed to cleanup progress widget",{error:o,reason:r})}ve=null,me=!1,He(),Be.detach(),typeof V=="function"&&(V(),V=null),pe=null,r&&Xt&&console.log("[Lifecycle] init() cleanup invoked",r)}}function Oo(e){const t=[],n=i=>{try{e({reason:i})}catch(r){console.error("[Lifecycle] dispose failed from page lifecycle",{reason:i,error:r})}};if(typeof window.addEventListener=="function"){const i=o=>{o!=null&&o.persisted||n("pagehide")};window.addEventListener("pagehide",i),t.push(()=>window.removeEventListener("pagehide",i));const r=()=>{n("beforeunload")};window.addEventListener("beforeunload",r),t.push(()=>window.removeEventListener("beforeunload",r))}if(typeof(document==null?void 0:document.addEventListener)=="function"){const i=()=>{document.visibilityState==="hidden"?Nn({reason:"visibilitychange"}):document.visibilityState==="visible"&&on({reason:"visibilitychange"})};document.addEventListener("visibilitychange",i),t.push(()=>document.removeEventListener("visibilitychange",i))}return()=>{for(;t.length;){const i=t.pop();try{i()}catch(r){console.error("[Lifecycle] Failed to remove page lifecycle hook",r)}}}}const nt=window[ct];if(nt&&typeof nt.dispose=="function"){try{nt.dispose({reason:"reinit"})}catch(e){console.error("[Lifecycle] Failed to dispose previous app instance",e)}if(typeof nt.teardown=="function")try{nt.teardown()}catch(e){console.error("[Lifecycle] Failed to teardown previous app hooks",e)}}let xe=null,ut=null,Mt=()=>{},ht=()=>{},Nt=!1,gt=!0;function Io(e={}){xe=oo("toosmart:init"),Sn(xe);try{ut=Do()}catch(n){console.error("[Lifecycle] init() failed",{error:n,context:e}),ut=null}Mt=S(window,"load",()=>{ae({elementChanged:!0})},void 0,{module:"layout.metrics",target:"window"}),ae({force:!We})}function Wn(e={}){const t=e&&typeof e=="object"?e:{reason:String(e)};try{typeof ut=="function"&&ut(t)}catch(n){console.error("[Lifecycle] init cleanup failed",{error:n,cleanupReason:t})}ut=null;try{typeof Mt=="function"&&Mt()}catch(n){console.error("[Lifecycle] Failed to remove load listener",n)}if(Mt=()=>{},xe)try{xe.disposeAll()}catch(n){console.error("[Lifecycle] disposeAll failed",{error:n,cleanupReason:t})}xe=null,Sn(null)}function je(e,t){const n=Ue.snapshot();return console.info(`[Lifecycle] ${e}`,{payload:t,activeResources:n.total,byKind:n.byKind}),n}function Nn(e={}){Nt||gt||(je("pause:start",e),gt=!0,Wn(e),je("pause:complete",e))}function on(e={}){Nt||!gt&&xe||(je("resume:start",e),gt=!1,Io(e),je("resume:complete",e))}function Qt(e={}){Nt||(je("dispose:start",e),Nt=!0,gt=!0,ht(),ht=()=>{},Wn(e),je("dispose:complete",e))}ht=Oo(Qt);const ot=co(Ue);window.DEBUG_METRICS_OVERLAY&&ot.start();document.visibilityState!=="hidden"&&on({reason:"init"});Bn();const Wo={dispose:Qt,pause:Nn,resume:on,teardown(){ht(),ht=()=>{}},getResources(){return xe?xe.report():[]},getResourceDiagnostics(){return Ue.snapshot()},logResourceDiagnostics(e){return Ue.logSnapshot(e)},getFlyoutDiagnostics(){return{initTimeline:[...yn],setActiveSectionTimeline:[...wn],bridge:Qn()}},destroy(e="destroy"){try{this.teardown()}catch(t){console.error("[Lifecycle] Failed to teardown before destroy",t)}if(Qt({reason:e}),window[ct]===this)try{delete window[ct]}catch{window[ct]=void 0}},audit:"2024-12-20"};window[ct]=Wo;const Pt=window.__TOOSMART_RESOURCES__||{};Pt.summary=()=>Ue.snapshot();Pt.log=e=>Ue.logSnapshot(e);Pt.overlay={toggle:()=>ot.toggle(),show:()=>ot.start(),hide:()=>ot.stop(),isActive:()=>ot.isActive()};window.__TOOSMART_RESOURCES__=Pt;window.toggleModeDebug=function(e){var t,n;if(typeof e=="boolean"?window.DEBUG_MODE_DETECTION=e:window.DEBUG_MODE_DETECTION=!window.DEBUG_MODE_DETECTION,window.DEBUG_MODE_DETECTION){console.log("[DEBUG] Mode detection logging enabled ‚úì"),console.log("[DEBUG] Current state:",{mode:E,input:se});const i={visualViewportWidth:(t=window.visualViewport)==null?void 0:t.width,rootClientWidth:X==null?void 0:X.clientWidth,innerWidth:window.innerWidth,outerWidth:window.outerWidth,screenWidth:(n=window.screen)==null?void 0:n.width};console.log("[DEBUG] Width sources (priority order):",i);const r=[i.visualViewportWidth,i.rootClientWidth,i.innerWidth,i.outerWidth,i.screenWidth];let o=null,l=null;const a=["visualViewportWidth","rootClientWidth","innerWidth","outerWidth","screenWidth"];for(let w=0;w<r.length;w++){const g=r[w];if(typeof g=="number"&&Number.isFinite(g)&&g>0){o=g,l=a[w];break}}console.log("[DEBUG] Width used for detection:",o,`(from ${l})`);const c=An(),u=Tn(c);console.log("[DEBUG] Detected state:",{mode:u,input:c}),console.log("[DEBUG] State mismatch:",{mode:E!==u,input:se!==c}),console.log("[DEBUG] Now resize the window to see automatic mode/input changes...")}else console.log("[DEBUG] Mode detection logging disabled")};
