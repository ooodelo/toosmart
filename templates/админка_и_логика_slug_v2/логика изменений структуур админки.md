Сводим в одну схему и сразу закрываем вопрос с дублями заголовков.

------

## 1. Семантические роли (как ты их задал)

Одна «единица контента» (урок, вводная, рекомендации, приложение и т.п.) опирается на такие поля:

- **H1 (`h1`)** — заголовок в самом MD-файле (то, что логично видеть в премиум-версии как заголовок урока).
- **SEO-заголовок (`seotitle`)** — альтернатива `h1`, когда `h1` слишком техничен; используется как H1 в free/paywall, а также может участвовать в SEO.
- **Title (`title`)** — текст для `<title>` (вкладка браузера / заголовок в поисковой выдаче).
- **Меню (`menu`)** — как пункт называется внутри сайта (навигация, оглавление, ссылки внутри курса).
- **Slug (`slug`)** — «имя» сущности без пути (только хвост URL; путь собирается хардкодом по типу раздела).

------

## 2. Модель данных для MD-сущности

Для каждого MD-файла (кроме легала и картинок):

- В **MD**:
  - есть `h1` (первая строка `# …`),
  - есть тело текста.
- В **админке / JSON** для этого же файла:
  - `slug` — строка-ключ без папок, например `kitchen-fat-basics`;
  - `menu` — подпись пункта меню (если нужно); по умолчанию может = `h1`;
  - `seotitle` — строка для SEO-заголовка (для free/paywall). Если не задан, можно брать `h1`;
  - `title` — `<title>` вкладки/поиска; если не задан, можно собирать автоматически: `seotitle + " — название проекта"`.

Тип сущности (урок, вводная, рекомендации, приложение и т.п.) задаётся отдельно (флагом `type` в том же JSON).

------

## 3. Поведение по типам страниц

### 3.1. Уроки: free + paywall и премиум (вариант 1 по философии)

Исходим из того, что **один и тот же MD** формирует обе версии.

1. **Премиум-урок**

- URL строится по `slug` + префикс премиум-раздела (жёстко зашит в логике).
- H1 на странице:
  - берём `h1` из MD (читаемый рабочий заголовок).
- `<title>`:
  - `title` из админки.
- Меню:
  - текст из `menu` (если пусто — используем `h1`).
- Free/paywall здесь никак не участвует.

1. **Free + paywall для того же урока**

- URL строится по `slug` + префикс free-раздела (или тот же URL, но другой шаблон в зависимости от доступа — это уже техническая реализация).
- H1 на странице:
  - **не из MD**, а из `seotitle`
    (то есть H1 free-версии = SEO-заголовок, и он сознательно может отличаться от премиумного `h1`).
- `<title>`:
  - `title` (может совпадать с `seotitle`, но не обязан).
- Меню:
  - то же самое, что и у премиум (один `menu` на MD-файл, повторно используемый).

Итого:
у урока один `h1` для премиум, один `seotitle` для free/paywall, один `title` для `<title>`, один `menu` и один `slug`.

------

### 3.2. Приложения

- Логика = как у премиум-разделов:
  - есть только премиум-страница;
  - H1 = `h1` из MD;
  - `<title>` = `title`;
  - `menu`/`slug` по той же схеме.
- Free-версии у приложений нет → `seotitle` здесь либо игнорируется, либо вообще не задаётся.

------

### 3.3. Рекомендации

- H1 и SEO-заголовок совпадают:
  - `h1` в MD = `seotitle` по смыслу.
- На странице:
  - `<h1>` = `h1` из MD;
  - `<title>` = `title`;
  - `menu` задаётся отдельно (если рекомендации где-то всплывают в навигации); иначе можно без меню.
- По сути: один слой, без paywall.

------

### 3.4. Вводная (индекс-страница курса)

- `h1` в MD = одновременно `seotitle` (SEO-заголовок).
- На странице:
  - `<h1>` = `h1`;
  - `<title>` = `title`;
- Меню:
  - вводную из меню убираем (это индексная страница, на неё переходы по другим механикам).
- `slug` задаётся как имя (без пути), путь собирается хардкодом типа `/course/` + `slug`.

------

### 3.5. Легал (модалки)

- Меню:
  - статично и захардкожено (например, список ссылок «Публичная оферта», «Политика конфиденциальности»).
- Модалка:
  - в модальном окне нужен **один** заголовок — достаточно взять это же имя из статичного меню или из `h1`в MD.
  - SEO-блок в принципе не нужен:
    - нет отдельной индексируемой страницы;
    - `title` и `seotitle` не задаём, `slug` не нужен.
- Главное: для легала **не выводить второй заголовок из шаблона**, а использовать только один источник (либо `h1` из MD, либо текст пункта меню).

------

### 3.6. Картинки / иллюстрации

Отдельный SEO-блок на сущность картинки:

- `slug` — имя картинки (ключ);
- `alt` — корректный alt-текст;
- `description` — более подробное описание/подпись.

Эти поля используются в `<img>` и в возможных картах сайта под изображения.

------

## 4. Как решается проблема дублей заголовков

Ключевая идея: **во всех шаблонах H1 должен рисоваться только один раз из “правильного” поля**, а H1 из MD при необходимости вырезается из тела HTML.

Алгоритм сборки MD:

1. Парсер читает MD:
   - находит первую строку `# …` → сохраняет её текст в `h1`;
   - эту строку **удаляет** из HTML-версии тела (`bodyHtml`), чтобы внутри `bodyHtml` больше не было H1.
2. Дальше уже шаблоны решают, что делать:
   - **Премиум-урок / приложение:**
     - `<h1>` берётся из `h1` (из MD);
     - в тело вставляется `bodyHtml` (где H1 уже нет).
       → Дубликатов нет: H1 только один — тот, что вывел шаблон.
   - **Free + paywall:**
     - `<h1>` берётся из `seotitle` (или из `h1`, если `seotitle` пустой);
     - в тело вставляется опять же `bodyHtml` без H1.
       → MD-шный H1 физически есть в данных (для премиум), но **не попадает** во free-страницу → нет второго заголовка.
   - **Рекомендации / вводная:**
     - можно либо:
       - вести себя как премиум (H1 = `h1`), либо
       - как «H1 = seotitle», если хочешь полный контроль;
     - в любом случае: H1 берётся **из поля**, а `bodyHtml` уже без заголовка.
       → один H1.
   - **Легал-модалки:**
     - вариант 1: **вообще не резать H1** в MD, а внутри модалки использовать `bodyHtml` как есть, но тогда в шаблоне модалки не добавлять свой `<h1>`, а только обёртку;
     - вариант 2: резать так же, как для уроков, и выводить H1 из `h1` явно в шапке модалки.
       → в любом случае, модалка получает только один заголовок.

Итого:
дубли пропадают, потому что:

- H1 из MD **не живёт** «сам по себе» в `fullHtml` — он превращается в поле `h1`, а из тела вырезается;
- free/premium/прочие шаблоны **каждый рисуют один H1 из своего источника** (`h1` или `seotitle`), не накладывая его поверх другого H1 из Markdown.

------

Если нужно, дальше можно зафиксировать это в виде маленькой таблички «Тип страницы → откуда берём `h1`, `seotitle`, `title`, `menu`, `slug`» и/или набросать структуру JSON-записи для урока/рекомендаций/легала/картинки.