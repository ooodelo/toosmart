<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –±–∏–ª–¥–∞</title>
  <style>
    :root {
      --primary: #2563eb;
      --primary-hover: #1d4ed8;
      --success: #16a34a;
      --warning: #ea580c;
      --danger: #dc2626;
      --bg: #f8fafc;
      --card-bg: #ffffff;
      --text: #1e293b;
      --text-muted: #64748b;
      --border: #e2e8f0;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    header {
      text-align: center;
      margin-bottom: 30px;
      padding: 20px;
      background: var(--card-bg);
      border-radius: 12px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    header h1 {
      font-size: 1.8rem;
      margin-bottom: 10px;
    }

    header p {
      color: var(--text-muted);
    }

    .status-bar {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 15px;
      justify-content: center;
    }

    .status-indicator {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--success);
    }

    .status-indicator.loading {
      background: var(--warning);
      animation: pulse 1s infinite;
    }

    .status-indicator.error {
      background: var(--danger);
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }

    .card {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    .card h2 {
      font-size: 1.1rem;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 2px solid var(--primary);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .form-group {
      margin-bottom: 15px;
    }

    .form-group:last-child {
      margin-bottom: 0;
    }

    label {
      display: block;
      font-size: 0.85rem;
      font-weight: 600;
      margin-bottom: 5px;
      color: var(--text-muted);
    }

    input, select, textarea {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 0.95rem;
      transition: border-color 0.2s;
    }

    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--primary);
    }

    input[type="number"] {
      -moz-appearance: textfield;
    }

    input[type="checkbox"] {
      width: auto;
      margin-right: 8px;
    }

    .checkbox-label {
      display: flex;
      align-items: center;
      cursor: pointer;
    }

    .row {
      display: flex;
      gap: 10px;
    }

    .row .form-group {
      flex: 1;
    }

    .build-actions {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }

    .build-actions h2 {
      font-size: 1.1rem;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 2px solid var(--success);
    }

    .build-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .btn {
      padding: 12px 20px;
      border: none;
      border-radius: 8px;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .btn-primary {
      background: var(--primary);
      color: white;
    }

    .btn-primary:hover:not(:disabled) {
      background: var(--primary-hover);
    }

    .btn-success {
      background: var(--success);
      color: white;
    }

    .btn-success:hover:not(:disabled) {
      background: #15803d;
    }

    .btn-warning {
      background: var(--warning);
      color: white;
    }

    .btn-warning:hover:not(:disabled) {
      background: #c2410c;
    }

    .btn-outline {
      background: transparent;
      border: 2px solid var(--primary);
      color: var(--primary);
    }

    .btn-outline:hover:not(:disabled) {
      background: var(--primary);
      color: white;
    }

    .save-section {
      text-align: center;
      padding: 20px;
      background: var(--card-bg);
      border-radius: 12px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }

    .save-section .btn {
      font-size: 1.1rem;
      padding: 15px 40px;
    }

    .logs-section {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    .logs-section h2 {
      font-size: 1.1rem;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .logs-content {
      background: #1e293b;
      color: #e2e8f0;
      padding: 15px;
      border-radius: 8px;
      font-family: 'Monaco', 'Menlo', monospace;
      font-size: 0.85rem;
      max-height: 300px;
      overflow-y: auto;
      white-space: pre-wrap;
      word-break: break-all;
    }

    .logs-content:empty::before {
      content: '–õ–æ–≥–∏ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ —Å–±–æ—Ä–∫–∏...';
      color: var(--text-muted);
    }

    .toast {
      position: fixed;
      bottom: 20px;
      right: 20px;
      padding: 15px 20px;
      border-radius: 8px;
      color: white;
      font-weight: 600;
      transform: translateY(100px);
      opacity: 0;
      transition: all 0.3s;
      z-index: 1000;
    }

    .toast.show {
      transform: translateY(0);
      opacity: 1;
    }

    .toast.success {
      background: var(--success);
    }

    .toast.error {
      background: var(--danger);
    }

    .toast.info {
      background: var(--primary);
    }

    .hint {
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-top: 4px;
    }

    .file-upload {
      border: 2px dashed var(--border);
      border-radius: 8px;
      padding: 20px;
      text-align: center;
      cursor: pointer;
      transition: border-color 0.2s;
    }

    .file-upload:hover {
      border-color: var(--primary);
    }

    .file-upload input {
      display: none;
    }

    .file-list {
      margin-top: 10px;
      font-size: 0.85rem;
    }

    .file-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px;
      background: var(--bg);
      border-radius: 4px;
      margin-bottom: 5px;
    }

    .icon {
      font-size: 1.2rem;
    }

    @media (max-width: 768px) {
      .grid {
        grid-template-columns: 1fr;
      }

      .build-buttons {
        flex-direction: column;
      }

      .btn {
        width: 100%;
        justify-content: center;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>‚öôÔ∏è –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∏–ª–¥–æ–º</h1>
      <p>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏ –∑–∞–ø—É—Å–∫ —Å–±–æ—Ä–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞</p>
      <div class="status-bar">
        <div class="status-indicator" id="statusIndicator"></div>
        <span id="statusText">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
      </div>
    </header>

    <!-- –ë–ª–æ–∫ –∑–∞–ø—É—Å–∫–∞ —Å–±–æ—Ä–æ–∫ -->
    <section class="build-actions">
      <h2>üöÄ –ó–∞–ø—É—Å–∫ —Å–±–æ—Ä–∫–∏</h2>
      <div class="build-buttons">
        <button class="btn btn-success" onclick="runBuild('free')" id="btnFree">
          <span class="icon">üì¶</span> –°–æ–±—Ä–∞—Ç—å Free –≤–µ—Ä—Å–∏—é
        </button>
        <button class="btn btn-primary" onclick="runBuild('premium')" id="btnPremium">
          <span class="icon">‚≠ê</span> –°–æ–±—Ä–∞—Ç—å Premium –≤–µ—Ä—Å–∏—é
        </button>
        <button class="btn btn-warning" onclick="runBuild('recommendations')" id="btnRecommendations">
          <span class="icon">üìö</span> –°–æ–±—Ä–∞—Ç—å –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
        </button>
        <button class="btn btn-outline" onclick="runBuild('all')" id="btnAll">
          <span class="icon">üîÑ</span> –°–æ–±—Ä–∞—Ç—å –≤—Å—ë
        </button>
      </div>
    </section>

    <!-- –°–µ—Ç–∫–∞ —Å —Ñ–æ—Ä–º–∞–º–∏ -->
    <div class="grid">
      <!-- –¶–µ–Ω—ã -->
      <div class="card">
        <h2><span class="icon">üí∞</span> –¶–µ–Ω—ã</h2>
        <div class="row">
          <div class="form-group">
            <label for="originalAmount">–°—Ç–∞—Ä–∞—è —Ü–µ–Ω–∞</label>
            <input type="number" id="originalAmount" min="0" step="1">
          </div>
          <div class="form-group">
            <label for="currentAmount">–ù–æ–≤–∞—è —Ü–µ–Ω–∞</label>
            <input type="number" id="currentAmount" min="0" step="1">
          </div>
        </div>
        <div class="form-group">
          <label for="currency">–í–∞–ª—é—Ç–∞</label>
          <select id="currency">
            <option value="RUB">RUB (‚ÇΩ)</option>
            <option value="USD">USD ($)</option>
            <option value="EUR">EUR (‚Ç¨)</option>
          </select>
        </div>
      </div>

      <!-- –¢–µ–∫—Å—Ç—ã CTA -->
      <div class="card">
        <h2><span class="icon">‚úçÔ∏è</span> –¢–µ–∫—Å—Ç—ã CTA</h2>
        <div class="form-group">
          <label for="ctaEnterFull">Free ‚Üí –û–ø–ª–∞—Ç–∞ (enterFull)</label>
          <input type="text" id="ctaEnterFull">
          <div class="hint">–ö–Ω–æ–ø–∫–∞ –Ω–∞ free-—Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö, –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –º–æ–¥–∞–ª–∫—É –æ–ø–ª–∞—Ç—ã</div>
        </div>
        <div class="form-group">
          <label for="ctaNext">Premium ‚Üí –î–∞–ª–µ–µ (next)</label>
          <input type="text" id="ctaNext">
          <div class="hint">–ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤ premium</div>
        </div>
        <div class="form-group">
          <label for="ctaGoToCourse">Appendix ‚Üí –ö—É—Ä—Å (goToCourse)</label>
          <input type="text" id="ctaGoToCourse">
          <div class="hint">–í–æ–∑–≤—Ä–∞—Ç –∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∫ –∫—É—Ä—Å—É</div>
        </div>
        <div class="form-group">
          <label for="ctaOpenCourse">–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ ‚Üí –°—Ç–∞—Ä—Ç (openCourse)</label>
          <input type="text" id="ctaOpenCourse">
          <div class="hint">–ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ intro –∏–ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é –ø–æ–∑–∏—Ü–∏—é</div>
        </div>
      </div>

      <!-- –§—É—Ç–µ—Ä -->
      <div class="card">
        <h2><span class="icon">üìã</span> –§—É—Ç–µ—Ä</h2>
        <div class="form-group">
          <label for="companyName">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏</label>
          <input type="text" id="companyName">
        </div>
        <div class="row">
          <div class="form-group">
            <label for="inn">–ò–ù–ù</label>
            <input type="text" id="inn" maxlength="12">
          </div>
          <div class="form-group">
            <label for="year">–ì–æ–¥ –∫–æ–ø–∏—Ä–∞–π—Ç–∞</label>
            <input type="number" id="year" min="2000" max="2100">
          </div>
        </div>
        <div class="form-group">
          <label>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã —Ñ—É—Ç–µ—Ä–∞</label>
          <div class="file-upload" onclick="document.getElementById('footerFiles').click()">
            <input type="file" id="footerFiles" multiple accept=".md,.html,.txt">
            <p>üìÅ –ù–∞–∂–º–∏—Ç–µ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤</p>
            <div class="hint">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è: .md, .html, .txt</div>
          </div>
          <div class="file-list" id="footerFileList"></div>
        </div>
      </div>

      <!-- –†–æ–±–æ–∫–∞—Å—Å–∞ -->
      <div class="card">
        <h2><span class="icon">üí≥</span> –†–æ–±–æ–∫–∞—Å—Å–∞</h2>
        <div class="form-group">
          <label for="merchantLogin">–õ–æ–≥–∏–Ω –º–∞–≥–∞–∑–∏–Ω–∞</label>
          <input type="text" id="merchantLogin">
        </div>
        <div class="row">
          <div class="form-group">
            <label for="password1">–ü–∞—Ä–æ–ª—å #1</label>
            <input type="password" id="password1">
          </div>
          <div class="form-group">
            <label for="password2">–ü–∞—Ä–æ–ª—å #2</label>
            <input type="password" id="password2">
          </div>
        </div>
        <div class="form-group">
          <label for="invoicePrefix">–ü—Ä–µ—Ñ–∏–∫—Å —Å—á–µ—Ç–∞</label>
          <input type="text" id="invoicePrefix">
        </div>
        <div class="form-group">
          <label class="checkbox-label">
            <input type="checkbox" id="isTest">
            –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º
          </label>
          <div class="hint">–í–∫–ª—é—á–∏—Ç–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –±–µ–∑ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π</div>
        </div>
      </div>

      <!-- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–∞–π—Ç–∞ -->
      <div class="card">
        <h2><span class="icon">üåê</span> –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–∞–π—Ç–∞</h2>
        <div class="form-group">
          <label for="domain">–î–æ–º–µ–Ω</label>
          <input type="text" id="domain" placeholder="example.com">
        </div>
        <div class="form-group">
          <label for="wordsPerMinute">–°–∫–æ—Ä–æ—Å—Ç—å —á—Ç–µ–Ω–∏—è (—Å–ª–æ–≤/–º–∏–Ω)</label>
          <input type="number" id="wordsPerMinute" min="100" max="400">
          <div class="hint">–î–ª—è —Ä–∞—Å—á–µ—Ç–∞ –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–æ—á—Ç–µ–Ω–∏—è —Ä–∞–∑–¥–µ–ª–∞</div>
        </div>
      </div>

      <!-- Legal –¥–æ–∫—É–º–µ–Ω—Ç—ã -->
      <div class="card">
        <h2><span class="icon">üìÑ</span> Legal –¥–æ–∫—É–º–µ–Ω—Ç—ã</h2>
        <div class="form-group">
          <label for="legalTerms">–§–∞–π–ª —É—Å–ª–æ–≤–∏–π/–æ—Ñ–µ—Ä—Ç—ã</label>
          <input type="text" id="legalTerms" placeholder="01-legal-terms.md">
          <div class="hint">–ò–º—è —Ñ–∞–π–ª–∞ –≤ content/legal/</div>
        </div>
        <div class="form-group">
          <label for="legalPrivacy">–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</label>
          <input type="text" id="legalPrivacy" placeholder="02-privacy.md">
        </div>
        <div class="form-group">
          <label for="legalOffer">–ü—É–±–ª–∏—á–Ω–∞—è –æ—Ñ–µ—Ä—Ç–∞</label>
          <input type="text" id="legalOffer" placeholder="03-offer.md">
        </div>
      </div>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è -->
    <section class="save-section">
      <button class="btn btn-primary" onclick="saveConfig()" id="btnSave">
        üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
      </button>
    </section>

    <!-- –õ–æ–≥–∏ -->
    <section class="logs-section">
      <h2>
        üìù –õ–æ–≥–∏ —Å–±–æ—Ä–∫–∏
        <button class="btn btn-outline" onclick="clearLogs()" style="padding: 5px 10px; font-size: 0.8rem;">
          –û—á–∏—Å—Ç–∏—Ç—å
        </button>
      </h2>
      <div class="logs-content" id="logsContent"></div>
    </section>
  </div>

  <!-- Toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
  <div class="toast" id="toast"></div>

  <script>
    const API_URL = 'http://localhost:3001';
    let currentConfig = null;

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.addEventListener('DOMContentLoaded', () => {
      loadConfig();
    });

    // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
    async function loadConfig() {
      setStatus('loading', '–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏...');

      try {
        const response = await fetch(`${API_URL}/api/config`);
        if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏');

        currentConfig = await response.json();
        populateForm(currentConfig);
        setStatus('success', '–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
      } catch (error) {
        setStatus('error', '–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É');
        showToast('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω.', 'error');
      }
    }

    // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
    function populateForm(config) {
      // –¶–µ–Ω—ã
      document.getElementById('originalAmount').value = config.pricing?.originalAmount || 0;
      document.getElementById('currentAmount').value = config.pricing?.currentAmount || 0;
      document.getElementById('currency').value = config.pricing?.currency || 'RUB';

      // CTA —Ç–µ–∫—Å—Ç—ã
      document.getElementById('ctaEnterFull').value = config.ctaTexts?.enterFull || '';
      document.getElementById('ctaNext').value = config.ctaTexts?.next || '';
      document.getElementById('ctaGoToCourse').value = config.ctaTexts?.goToCourse || '';
      document.getElementById('ctaOpenCourse').value = config.ctaTexts?.openCourse || '';

      // –§—É—Ç–µ—Ä
      document.getElementById('companyName').value = config.footer?.companyName || '';
      document.getElementById('inn').value = config.footer?.inn || '';
      document.getElementById('year').value = config.footer?.year || new Date().getFullYear();

      // –†–æ–±–æ–∫–∞—Å—Å–∞
      document.getElementById('merchantLogin').value = config.robokassa?.merchantLogin || '';
      document.getElementById('password1').value = config.robokassa?.password1 || '';
      document.getElementById('password2').value = config.robokassa?.password2 || '';
      document.getElementById('invoicePrefix').value = config.robokassa?.invoicePrefix || '';
      document.getElementById('isTest').checked = config.robokassa?.isTest !== false;

      // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–∞–π—Ç–∞
      document.getElementById('domain').value = config.domain || '';
      document.getElementById('wordsPerMinute').value = config.build?.wordsPerMinute || 180;

      // Legal
      document.getElementById('legalTerms').value = config.legal?.terms || '';
      document.getElementById('legalPrivacy').value = config.legal?.privacy || '';
      document.getElementById('legalOffer').value = config.legal?.offer || '';
    }

    // –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ñ–æ—Ä–º—ã
    function collectFormData() {
      return {
        domain: document.getElementById('domain').value,
        pricing: {
          originalAmount: parseInt(document.getElementById('originalAmount').value) || 0,
          currentAmount: parseInt(document.getElementById('currentAmount').value) || 0,
          currency: document.getElementById('currency').value
        },
        ctaTexts: {
          enterFull: document.getElementById('ctaEnterFull').value,
          next: document.getElementById('ctaNext').value,
          goToCourse: document.getElementById('ctaGoToCourse').value,
          openCourse: document.getElementById('ctaOpenCourse').value
        },
        footer: {
          companyName: document.getElementById('companyName').value,
          inn: document.getElementById('inn').value,
          year: parseInt(document.getElementById('year').value) || new Date().getFullYear()
        },
        legal: {
          terms: document.getElementById('legalTerms').value,
          privacy: document.getElementById('legalPrivacy').value,
          offer: document.getElementById('legalOffer').value
        },
        robokassa: {
          merchantLogin: document.getElementById('merchantLogin').value,
          password1: document.getElementById('password1').value,
          password2: document.getElementById('password2').value,
          isTest: document.getElementById('isTest').checked,
          invoicePrefix: document.getElementById('invoicePrefix').value,
          successUrl: currentConfig?.robokassa?.successUrl || '/success.php',
          failUrl: currentConfig?.robokassa?.failUrl || '/fail.php',
          resultUrl: currentConfig?.robokassa?.resultUrl || '/robokassa-callback.php'
        },
        build: {
          wordsPerMinute: parseInt(document.getElementById('wordsPerMinute').value) || 180
        }
      };
    }

    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
    async function saveConfig() {
      const btn = document.getElementById('btnSave');
      btn.disabled = true;
      btn.textContent = '‚è≥ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...';

      try {
        const config = collectFormData();
        const response = await fetch(`${API_URL}/api/config`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(config)
        });

        if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');

        currentConfig = config;
        showToast('–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!', 'success');
      } catch (error) {
        showToast('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ' + error.message, 'error');
      } finally {
        btn.disabled = false;
        btn.textContent = 'üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é';
      }
    }

    // –ó–∞–ø—É—Å–∫ —Å–±–æ—Ä–∫–∏
    async function runBuild(target) {
      const btnId = target === 'all' ? 'btnAll' : `btn${target.charAt(0).toUpperCase() + target.slice(1)}`;
      const btn = document.getElementById(btnId);
      const originalText = btn.innerHTML;

      btn.disabled = true;
      btn.innerHTML = '‚è≥ –°–±–æ—Ä–∫–∞...';

      appendLog(`\n[${new Date().toLocaleTimeString()}] –ó–∞–ø—É—Å–∫ —Å–±–æ—Ä–∫–∏: ${target}\n${'‚îÄ'.repeat(50)}\n`);

      try {
        const response = await fetch(`${API_URL}/api/build`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ target })
        });

        const result = await response.json();

        if (result.success) {
          appendLog(result.output || '–°–±–æ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ\n');
          showToast(`–°–±–æ—Ä–∫–∞ ${target} –∑–∞–≤–µ—Ä—à–µ–Ω–∞!`, 'success');
        } else {
          appendLog(`–û–®–ò–ë–ö–ê: ${result.error}\n${result.output || ''}`);
          showToast(`–û—à–∏–±–∫–∞ —Å–±–æ—Ä–∫–∏: ${result.error}`, 'error');
        }
      } catch (error) {
        appendLog(`–û–®–ò–ë–ö–ê: ${error.message}\n`);
        showToast('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É', 'error');
      } finally {
        btn.disabled = false;
        btn.innerHTML = originalText;
      }
    }

    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ –ª–æ–≥–∏
    function appendLog(text) {
      const logsContent = document.getElementById('logsContent');
      logsContent.textContent += text;
      logsContent.scrollTop = logsContent.scrollHeight;
    }

    // –û—á–∏—Å—Ç–∫–∞ –ª–æ–≥–æ–≤
    function clearLogs() {
      document.getElementById('logsContent').textContent = '';
    }

    // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
    function setStatus(status, text) {
      const indicator = document.getElementById('statusIndicator');
      const statusText = document.getElementById('statusText');

      indicator.className = 'status-indicator';
      if (status === 'loading') indicator.classList.add('loading');
      if (status === 'error') indicator.classList.add('error');

      statusText.textContent = text;
    }

    // –ü–æ–∫–∞–∑ toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    function showToast(message, type = 'info') {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.className = `toast ${type} show`;

      setTimeout(() => {
        toast.classList.remove('show');
      }, 3000);
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤ —Ñ—É—Ç–µ—Ä–∞
    document.getElementById('footerFiles').addEventListener('change', function(e) {
      const fileList = document.getElementById('footerFileList');
      fileList.innerHTML = '';

      Array.from(e.target.files).forEach(file => {
        const item = document.createElement('div');
        item.className = 'file-item';
        item.innerHTML = `
          <span>üìÑ ${file.name}</span>
          <span>${(file.size / 1024).toFixed(1)} KB</span>
        `;
        fileList.appendChild(item);
      });
    });
  </script>
</body>
</html>
